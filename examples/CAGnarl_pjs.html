<!DOCTYPE html>
<html lang="en">
<head>
	<title>Toxiclibs.js -- Cellular Automata</title>
	<script type="text/javascript" src="js/processing.js"></script>
	<script src="js/require.js"></script>
	<script>
	var CAMatrix, CAWolfram1D, CARule2D;
	require.config({
		paths: {
			domReady: 'js/domReady',
			toxi: '../lib/toxi'
		}
	});
	require([
		'domReady',
		'toxi/sim/automata/CARule2D',
		'toxi/sim/automata/CAMatrix',
		'toxi/sim/automata/CAWolfram1D'
	], function( domReady, _CARule2D, _CAMatrix, _CAWolfram1D ){

		domReady(function(){
			CARule2D = _CARule2D;
			CAMatrix = _CAMatrix;
			CAWolfram1D = _CAWolfram1D;
			var scripts = document.getElementsByTagName("script");
			var canvasArray = Array.prototype.slice.call(document.getElementsByTagName("canvas"));
			var canvas;
			for (var i = 0, j = 0; i < scripts.length; i++) {
				if (scripts[i].type == "application/processing") {
					var src = scripts[i].getAttribute("target");
					if (src && src.indexOf("#") > -1) {
				  		canvas = document.getElementById(src.substr(src.indexOf("#") + 1));
				  		if (canvas) {
							new Processing(canvas, scripts[i].text);
							for (var k = 0; k< canvasArray.length; k++)
							{
								if (canvasArray[k] === canvas) {
									// remove the canvas from the array so we dont override it in the else
									canvasArray.splice(k,1);
								}
							}
						}
					} else {    
						if (canvasArray.length >= j) {
							new Processing(canvasArray[j], scripts[i].text);          
						}
						j++;
					}       
			  	}
			}
		});
	});
	</script>
</head>
<body>
<h1>Cellular Automata</h1>

<script type="application/processing">
CAMatrix ca;
CARule2D rule;

void setup() {
  size(200, 200);
  ca = new CAMatrix(width, height);
  //rule = new CARule2d( [3], [2,3], 2 true );               // Conway's Game of Life
  //rule = new CARule2D( [1], [1], 2, true );                // Gnarl
  //rule = new CARule2D( [2,3,4], [], 2, true );             // Serviets
  //rule = new CARule2D( [3], [0,1,2,3,4,5,6,7,8], 2, true ) // Life without Death

  rule = new CARule2D( [3], [1,2,3,4,5], 2, true );          // Maze
  ca.setRule(rule);
  seedPattern();
  frameRate(10);
}

void draw() {
  ca.update();
  int[] m = ca.getMatrix();
  background(255);
  loadPixels();

  for(int i = 0; i < m.length; i++) {
    color c = (m[i] > 0) ? color(0) : color(255);
    pixels[i] = c;
  }
  updatePixels();
}

void keyPressed() {
  if (key == 'n') {
    ca.reset();
    ca.addNoise(0.9);
  }
  if (key == 'p') {
    ca.reset();
    seedPattern(); 
  }
  if (key == 'r') {
    ca.reset();
    seedPattern();
    rule.randomize();
  }
}

void seedPattern() {
  ca.setStateAt(width/2 + 1, height/2 + 1, 1);
  ca.setStateAt(width/2, height/2, 1);
  ca.setStateAt(width/2 - 1, height/2 - 1, 1);
  ca.setStateAt(width/2, height/2 - 1, 1);
  ca.setStateAt(width/2 - 1, height/2 - 1, 1);


}

</script>

<canvas id="myCanvas" width="200" height="200">
	Your browser doesnt support canvas.
</canvas>
<p>Example demo of the cellular automata functions in the sim library. 
<br />
Controls:<br />
p : resets the simulation<br />
n : resets the simulation and adds random noise<br />
r : resets the simulation and randomizes the rule<br />
<br />

</p>
</body>
</html>
