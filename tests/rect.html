<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>QUnit Test Suite</title>
	<link rel="stylesheet" href="qunit/qunit.css" type="text/css" media="screen">
	<script type="text/javascript" src="qunit/qunit.js"></script>
	<script src="../build/toxiclibs.js"></script>
</head>
<body>
	<h1 id="qunit-header">QUnit Test Suite</h1>
	<h2 id="qunit-banner"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup</div>
	<script type="text/javascript">
	
	var Rect = toxi.geom.Rect,
		Ray2D = toxi.geom.Ray2D,
		Vec2D = toxi.geom.Vec2D;

	module("Construction of Rect");
	test("Rect w/ 2 Vec2Ds", function(){
		var r = new Rect(new Vec2D(10,10), new Vec2D(100,100));
		ok(r.x === 10 && r.y === 10, "correct position");
		ok(r.width === 100-r.x && r.height === 100-r.y,"correct dimensions: "+r.width+","+r.height);
	});	
	test("Rect with 4 numbers",function(){
		var r = new Rect(10,10,100,100);
		ok(r.x === 10 && r.y === 10, "correct position");
		ok(r.width === 100 && r.height === 100,"correct dimensions: "+r.width+","+r.height);
	});
	module("public methods");
	test("intersectsRay",function(){
		var r = new Rect(30,50,100,100);
		var ray2d = new Ray2D(60,70,new Vec2D(Math.PI/1.5,0));
		var intersect = r.intersectsRay(ray2d,0,3.4028235E38);
		var invDir = ray2d.getDirection().reciprocal();
		var signDirX = invDir.x < 0;
		var signDirY = invDir.y < 0;
		var min = r.getTopLeft();
		var max = r.getBottomRight();
		var minDist = 0;
		var maxDist = 3.4028235E38;
		console.log(signDirX+ "," + signDirY);
		var bbox = signDirX ? max : min;
		console.log("bbox: "+bbox);
		var tmin = (bbox.x - ray2d.x) * invDir.x;
		bbox = signDirX ? min : max;
		console.log("bbox: "+bbox);
		var tmax = (bbox.x - ray2d.x) * invDir.x;
		bbox = signDirY ? max : min;
		console.log("bbox: "+bbox);
		var tymin = (bbox.y - ray2d.y) * invDir.y;
		console.log("bbox: "+bbox);
		bbox = signDirY ? min : max;
		var tymax = (bbox.y - ray2d.y) * invDir.y;
		console.log("intersect: "+intersect);
		console.log("invDir: "+invDir);
		console.log("tmin: "+tmin+",tmax: "+tmax);
		console.log("tymin: "+tymin+ ", tymax: "+tymax);
				if((tmin > tymax) || (tymin > tmax)){
			console.log("BIG TIME FAIL");
		}
		if(tymin > tmin){
			tmin = tymin;
		}
		if (tymax < tmax) {
            tmax = tymax;
        }
        if ((tmin < maxDist) && (tmax > minDist)) {
            console.log("final: "+ray2d.getPointAtDistance(tmin)); 
        }
		//ok(intersect.x == 30,"intersects: "+r+", "+ray2d);
		
	});
	</script>
	
</body>
</html>
