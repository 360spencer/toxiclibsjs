/**
 * almond 0.1.1 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
Using David Bau's seedrandom.js for PerlinNoise#noiseSeed functionality

 seedrandom.js version 2.0.
 Author: David Bau 4/2/2011

 Defines a method Math.seedrandom() that, when called, substitutes
 an explicitly seeded RC4-based algorithm for Math.random().  Also
 supports automatic seeding from local or network sources of entropy.

 Usage:

   <script src=http:davidbau.com/encode/seedrandom-min.js></script>

   Math.seedrandom('yipee'); Sets Math.random to a function that is
                             initialized using the given explicit seed.

   Math.seedrandom();        Sets Math.random to a function that is
                             seeded using the current time, dom state,
                             and other accumulated local entropy.
                             The generated seed string is returned.

   Math.seedrandom('yowza', true);
                             Seeds using the given explicit seed mixed
                             together with accumulated entropy.

   <script src="http:bit.ly/srandom-512"></script>
                             Seeds using physical random bits downloaded
                             from random.org.

   <script src="https:jsonlib.appspot.com/urandom?callback=Math.seedrandom">
   </script>                 Seeds using urandom bits from call.jsonlib.com,
                             which is faster than random.org.

 Examples:

   Math.seedrandom("hello");             Use "hello" as the seed.
   document.write(Math.random());        Always 0.5463663768140734
   document.write(Math.random());        Always 0.43973793770592234
   var rng1 = Math.random;               Remember the current prng.

   var autoseed = Math.seedrandom();     New prng with an automatic seed.
   document.write(Math.random());        Pretty much unpredictable.

   Math.random = rng1;                   Continue "hello" prng sequence.
   document.write(Math.random());        Always 0.554769432473455

   Math.seedrandom(autoseed);            Restart at the previous seed.
   document.write(Math.random());        Repeat the 'unpredictable' value.

 Notes:

 Each time seedrandom('arg') is called, entropy from the passed seed
 is accumulated in a pool to help generate future seeds for the
 zero-argument form of Math.seedrandom, so entropy can be injected over
 time by calling seedrandom with explicit data repeatedly.

 On speed - This javascript implementation of Math.random() is about
 3-10x slower than the built-in Math.random() because it is not native
 code, but this is typically fast enough anyway.  Seeding is more expensive,
 especially if you use auto-seeding.  Some details (timings on Chrome 4):

 Our Math.random()            - avg less than 0.002 milliseconds per call
 seedrandom('explicit')       - avg less than 0.5 milliseconds per call
 seedrandom('explicit', true) - avg less than 2 milliseconds per call
 seedrandom()                 - avg about 38 milliseconds per call

 LICENSE (BSD):

 Copyright 2010 David Bau, all rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:
 
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.

   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
 
   3. Neither the name of this module nor the names of its contributors may
      be used to endorse or promote products derived from this software
      without specific prior written permission.
 
 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

var toxi={};(function(){var requirejs,require,define;(function(undef){function normalize(name,baseName){var baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"]||{},nameParts,nameSegment,mapValue,foundMap,i,j,part;if(name&&name.charAt(0)==="."&&baseName){baseParts=baseParts.slice(0,baseParts.length-1),name=baseParts.concat(name.split("/"));for(i=0;part=name[i];i++)if(part===".")name.splice(i,1),i-=1;else if(part===".."){if(i===1&&(name[2]===".."||name[0]===".."))return!0;i>0&&(name.splice(i-1,2),i-=2)}name=name.join("/")}if((baseParts||starMap)&&map){nameParts=name.split("/");for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts)for(j=baseParts.length;j>0;j-=1){mapValue=map[baseParts.slice(0,j).join("/")];if(mapValue){mapValue=mapValue[nameSegment];if(mapValue){foundMap=mapValue;break}}}foundMap=foundMap||starMap[nameSegment];if(foundMap){nameParts.splice(0,i,foundMap),name=nameParts.join("/");break}}}return name}function makeRequire(relName,forceSync){return function(){return req.apply(undef,aps.call(arguments,0).concat([relName,forceSync]))}}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(depName){return function(value){defined[depName]=value}}function callDep(name){if(waiting.hasOwnProperty(name)){var args=waiting[name];delete waiting[name],defining[name]=!0,main.apply(undef,args)}if(!defined.hasOwnProperty(name))throw new Error("No "+name);return defined[name]}function makeMap(name,relName){var prefix,plugin,index=name.indexOf("!");return index!==-1?(prefix=normalize(name.slice(0,index),relName),name=name.slice(index+1),plugin=callDep(prefix),plugin&&plugin.normalize?name=plugin.normalize(name,makeNormalize(relName)):name=normalize(name,relName)):name=normalize(name,relName),{f:prefix?prefix+"!"+name:name,n:name,p:plugin}}function makeConfig(name){return function(){return config&&config.config&&config.config[name]||{}}}var defined={},waiting={},config={},defining={},aps=[].slice,main,req;main=function(name,deps,callback,relName){var args=[],usingExports,cjsModule,depName,ret,map,i;relName=relName||name;if(typeof callback=="function"){deps=!deps.length&&callback.length?["require","exports","module"]:deps;for(i=0;i<deps.length;i++){map=makeMap(deps[i],relName),depName=map.f;if(depName==="require")args[i]=makeRequire(name);else if(depName==="exports")args[i]=defined[name]={},usingExports=!0;else if(depName==="module")cjsModule=args[i]={id:name,uri:"",exports:defined[name],config:makeConfig(name)};else if(defined.hasOwnProperty(depName)||waiting.hasOwnProperty(depName))args[i]=callDep(depName);else if(map.p)map.p.load(map.n,makeRequire(relName,!0),makeLoad(depName),{}),args[i]=defined[depName];else if(!defining[depName])throw new Error(name+" missing "+depName)}ret=callback.apply(defined[name],args);if(name)if(cjsModule&&cjsModule.exports!==undef&&cjsModule.exports!==defined[name])defined[name]=cjsModule.exports;else if(ret!==undef||!usingExports)defined[name]=ret}else name&&(defined[name]=callback)},requirejs=require=req=function(deps,callback,relName,forceSync){return typeof deps=="string"?callDep(makeMap(deps,callback).f):(deps.splice||(config=deps,callback.splice?(deps=callback,callback=relName,relName=null):deps=undef),callback=callback||function(){},forceSync?main(undef,deps,callback,relName):setTimeout(function(){main(undef,deps,callback,relName)},15),req)},req.config=function(cfg){return config=cfg,req},define=function(name,deps,callback){deps.splice||(callback=deps,deps=[]),waiting[name]=[name,deps,callback]},define.amd={jQuery:!0}})(),define("almond",function(){}),define.unordered=!0,define("almondSettings",function(){}),define("toxi/math/mathUtils",["require","exports","module"],function(require,exports,module){MathUtils={},MathUtils.SQRT2=Math.sqrt(2),MathUtils.SQRT3=Math.sqrt(3),MathUtils.LOG2=Math.log(2),MathUtils.PI=3.141592653589793,MathUtils.INV_PI=1/MathUtils.PI,MathUtils.HALF_PI=MathUtils.PI/2,MathUtils.THIRD_PI=MathUtils.PI/3,MathUtils.QUARTER_PI=MathUtils.PI/4,MathUtils.TWO_PI=MathUtils.PI*2,MathUtils.THREE_HALVES_PI=MathUtils.TWO_PI-MathUtils.HALF_PI,MathUtils.PI_SQUARED=MathUtils.PI*MathUtils.PI,MathUtils.EPS=1.1920928955078125e-7,MathUtils.DEG2RAD=MathUtils.PI/180,MathUtils.RAD2DEG=180/MathUtils.PI,MathUtils.SHIFT23=1<<23,MathUtils.INV_SHIFT23=1/MathUtils.SHIFT23,MathUtils.SIN_A=-4/(MathUtils.PI*MathUtils.PI),MathUtils.SIN_B=4/MathUtils.PI,MathUtils.SIN_P=.225,MathUtils.abs=Math.abs,MathUtils.ceilPowerOf2=function(x){var pow2=1;while(pow2<x)pow2<<=1;return pow2},MathUtils.clip=function(a,_min,_max){return a<_min?_min:a>_max?_max:a},MathUtils.clipNormalized=function(a){return a<0?0:a>1?1:a},MathUtils.cos=Math.cos,MathUtils.degrees=function(radians){return radians*this.RAD2DEG},MathUtils.fastCos=function(x){return MathUtils.fastSin(x+(x>MathUtils.HALF_PI?-MathUtils.THREE_HALVES_PI:MathUtils.HALF_PI))},MathUtils.fastSin=function(x){return x=MathUtils.SIN_B*x+MathUtils.SIN_A*x*Math.abs(x),MathUtils.SIN_P*(x*Math.abs(x)-x)+x},MathUtils.flipCoin=function(rnd){return Math.random()<.5},MathUtils.floor=function(x){var y=parseInt(x,10);return x<0&&x!=y&&y--,y},MathUtils.floorPowerOf2=function(x){return parseInt(Math.pow(2,parseInt(Math.log(x)/MathUtils.LOG2,10)),10)},MathUtils.max=function(a,b,c){return c?a>b?a>c?a:c:b>c?b:c:Math.max(a,b)},MathUtils.min=function(a,b,c){return c?a<b?a<c?a:c:b<c?b:c:Math.min(a,b)},MathUtils.normalizedRandom=function(){return Math.random()*2-1},MathUtils.radians=function(degrees){return degrees*MathUtils.DEG2RAD},MathUtils.random=function(rand,min,max){return arguments.length==2&&(max=min,min=rand,rand=Math.random),!min&&!max?Math.random():max?rand()*(max-min)+min:(max=min,rand()*max)},MathUtils.reduceAngle=function(theta){return theta%=MathUtils.TWO_PI,Math.abs(theta)>MathUtils.PI&&(theta-=MathUtils.TWO_PI),Math.abs(theta)>MathUtils.HALF_PI&&(theta=MathUtils.PI-theta),theta},MathUtils.sign=function(x){return x<0?-1:x>0?1:0},MathUtils.sin=function(theta){return theta=MathUtils.reduceAngle(theta),Math.abs(theta)<=MathUtils.QUARTER_PI?MathUtils.fastSin(theta):MathUtils.fastCos(MathUtils.HALF_PI-theta)},module.exports=MathUtils}),define("toxi/internals",["require","exports","module"],function(require,exports,module){var ifUndefinedElse=function(_if,_else){return typeof _if!="undefined"?_if:_else};module.exports.extend=function(childClass,superClass){childClass.prototype=new superClass,childClass.constructor=childClass,childClass.prototype.parent=superClass.prototype};var isArray=Array.isArray||function(a){return a.toString()=="[object Array]"};module.exports.isArray=isArray;var hasProperties=function(subject,properties){if(subject===undefined||typeof subject!="object")return!1;var i=0,len=properties.length,prop;for(i=0;i<len;i++){prop=properties[i];if(!(prop in subject))return!1}return!0};module.exports.hasProperties=hasProperties,module.exports.tests={hasXY:function(o){return hasProperties(o,["x","y"])},hasXYZ:function(o){return hasProperties(o,["x","y","z"])},hasXYWidthHeight:function(o){return hasProperties(o,["x","y","width","height"])},isArray:isArray,isAABB:function(o){return hasProperties(o,["setExtent","getNormalForPoint"])},isCircle:function(o){return hasProperties(o,["getCircumference","getRadius","intersectsCircle"])},isLine2D:function(o){return hasProperties(o,["closestPointTo","intersectLine","getLength"])},isMatrix4x4:function(o){return hasProperties(o,["identity","invert","setFrustrum"])},isRect:function(o){return hasProperties(o,["x","y","width","height","getArea","getCentroid","getDimensions"])},isSphere:function(o){return hasProperties(o,["x","y","z","radius","toMesh"])},isTColor:function(o){return hasProperties(o,["rgb","cmyk","hsv"])},isParticleBehavior:function(o){return hasProperties(o,["applyBehavior","configure"])},isVerletParticle2D:function(o){return hasProperties(o,["x","y","weight"])}};var breaker={};module.exports.each=function(obj,iterator,context){if(obj==null)return;if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++)if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(hasOwnProperty.call(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return},module.exports.removeItemFrom=function(item,array){var index=array.indexOf(item);return index>-1?array.splice(index,1):undefined},module.exports.mixin=function(destination,source){module.exports.each(source,function(val,key){destination[key]=val})},module.exports.numberCompare=function(f1,f2){if(f1==f2)return 0;if(f1<f2)return-1;if(f1>f2)return 1},module.exports.Int32Array=typeof Int32Array!="undefined"?Int32Array:Array,module.exports.Float32Array=typeof Float32Array!="undefined"?Float32Array:Array;var ArrayIterator=function(collection){this.__it=collection.slice(0)};ArrayIterator.prototype={hasNext:function(){return this.__it.length>0},next:function(){return this.__it.shift()}};var ObjectIterator=function(object){this.__obj={},this.__keys=[];for(var prop in object)this.__obj[prop]=object[prop],this.__keys.push(prop);this.__it=new ArrayIterator(this.__keys)};ObjectIterator.prototype={hasNext:function(){return this.__it.hasNext()},next:function(){var key=this.__it.next();return this.__obj[key]}};var Iterator=function(collection){return module.exports.isArray(collection)?new ArrayIterator(collection):new ObjectIterator(collection)};module.exports.Iterator=Iterator}),define("toxi/geom/Vec3D",["require","exports","module","./Vec2D","../math/mathUtils","../internals"],function(require,exports,module){var internals=require("../internals"),Vec2D,AABB;require(["./Vec2D","./AABB"],function(v2,AB){Vec2D=v2,AABB=AB});var mathUtils=require("../math/mathUtils"),Vec3D=function(x,y,z){internals.tests.hasXYZ(x)?(this.x=x.x,this.y=x.y,this.z=x.z):x===undefined?(this.x=0,this.y=0,this.z=0):(this.x=x,this.y=y,this.z=z)};Vec3D.prototype={abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},add:function(a,b,c){return internals.tests.hasXYZ(a)?new Vec3D(this.x+a.x,this.y+a.y,this.z+a.z):new Vec3D(this.x+a,this.y+b,this.z+c)},addSelf:function(a,b,c){return a!==undefined&&b!==undefined&&c!==undefined?(this.x+=a,this.y+=b,this.z+=c):(this.x+=a.x,this.y+=a.y,this.z+=a.z),this},angleBetween:function(vec,faceNormalizeBool){var theta;return faceNormalizeBool?theta=this.getNormalized().dot(vec.getNormalized()):theta=this.dot(vec),Math.acos(theta)},clear:function(){return this.x=this.y=this.z=0,this},compareTo:function(vec){return this.x==vec.x&&this.y==vec.y&&this.z==vec.z?0:this.magSquared()-vec.magSqaured()},constrain:function(box_or_min,max){var min;return internals.tests.isAABB(box_or_min)?(max=box_or_min.getMax(),min=box_or_min.getMin()):min=box_or_min,this.x=mathUtils.clip(this.x,min.x,max.x),this.y=mathUtils.clip(this.y,min.y,max.y),this.z=mathUtils.clip(this.z,min.z,max.z),this},copy:function(){return new Vec3D(this)},cross:function(vec){return new Vec3D(this.y*vec.z-vec.y*this.z,this.z*vec.x-vec.z*this.x,this.x*vec.y-vec.x*this.y)},crossInto:function(vec,vecResult){var vx=vec.x,vy=vec.y,vz=vec.z;return result.x=this.y*vz-vy*this.z,result.y=this.z*vx-vz*this.x,result.z=this.x*vy-vx*this.y,result},crossSelf:function(vec){var cx=this.y*vec.z-vec.y*this.z,cy=this.z*vec.x-vec.z*this.x;return this.z=this.x*vec.y-vec.x*this.y,this.y=cy,this.x=cx,this},distanceTo:function(vec){if(vec!==undefined){var dx=this.x-vec.x,dy=this.y-vec.y,dz=this.z-vec.z;return Math.sqrt(dx*dx+dy*dy+dz*dz)}return NaN},distanceToSquared:function(vec){if(vec!==undefined){var dx=this.x-vec.x,dy=this.y-vec.y,dz=this.z-vec.z;return dx*dx+dy*dy+dz*dz}return NaN},dot:function(vec){return this.x*vec.x+this.y*vec.y+this.z*vec.z},equals:function(vec){return internals.tests.hasXYZ(vec)?this.x==vec.x&&this.y==vec.y&&this.z==vec.z:!1},equalsWithTolerance:function(vec,tolerance){return Math.abs(this.x-vec.x)<tolerance&&Math.abs(this.y-vec.y)<tolerance&&Math.abs(this.z-vec.z)<tolerance?!0:!1},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},frac:function(){return this.x-=Math.floor(this.x),this.y-=Math.floor(this.y),this.z-=Math.floor(this.z),this},getAbs:function(){return(new Vec3D(this)).abs()},getComponent:function(id){typeof id=="number"&&(id===Vec3D.Axis.X?id=0:id===Vec3D.Axis.Y?id=1:id=2);switch(id){case 0:return this.x;case 1:return this.y;case 2:return this.z}},getConstrained:function(box){return(new Vec3D(this)).constrain(box)},getFloored:function(){return(new Vec3D(this)).floor()},getFrac:function(){return(new Vec3D(this)).frac()},getInverted:function(){return new Vec3D(-this.x,-this.y,-this.z)},getLimited:function(limit){return this.magSquared()>limit*limit?this.getNormalizedTo(limit):new Vec3D(this)},getNormalized:function(){return(new Vec3D(this)).normalize()},getNormalizedTo:function(length){return(new Vec3D(this)).normalizeTo(length)},getReciprocal:function(){return this.copy().reciprocal()},getReflected:function(normal){return this.copy().reflect(normal)},getRotatedAroundAxis:function(vec_axis,theta){return(new Vec3D(this)).rotateAroundAxis(vec_axis,theta)},getRotatedX:function(theta){return(new Vec3D(this)).rotateX(theta)},getRotatedY:function(theta){return(new Vec3D(this)).rotateY(theta)},getRotatedZ:function(theta){return(new Vec3D(this)).rotateZ(theta)},getSignum:function(){return(new Vec3D(this)).signum()},headingXY:function(){return Math.atan2(this.y,this.x)},headingXZ:function(){return Math.atan2(this.z,this.x)},headingYZ:function(){return Math.atan2(this.y,this.z)},immutable:function(){return this},interpolateTo:function(v,f,s){return s===undefined?new Vec3D(this.x+(v.x-this.x)*f,this.y+(v.y-this.y)*f,this.z+(v.z-this.z)*f):new Vec3D(s.interpolate(this.y,v.y,f),s.interpolate(this.y,v.y,f),s.interpolate(this.z,v.z,f))},interpolateToSelf:function(v,f,s){return s===undefined?(this.x+=(v.x-this.x)*f,this.y+=(v.y-this.y)*f,this.z+=(v.z-this.z)*f):(this.x=s.interpolate(this.x,v.x,f),this.y=s.interpolate(this.y,v.y,f),this.z=s.interpolate(this.z,v.z,f)),this},invert:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},isInAABB:function(box_or_origin,boxExtent){if(boxExtent){var w=boxExtent.x;if(this.x<box_or_origin.x-w||this.x>box_or_origin.x+w)return!1;w=boxExtent.y;if(this.y<box_or_origin.y-w||this.y>box_or_origin.y+w)return!1;w=boxExtent.y;if(this.z<box_or_origin.z-w||this.y>box_or_origin.z+w)return!1}return!0},isMajorAxis:function(tol){var ax=mathUtils.abs(this.x),ay=mathUtils.abs(this.y),az=mathUtils.abs(this.z),itol=1-tol;if(ax>itol){if(ay<tol)return az<tol}else if(ay>itol){if(ax<tol)return az<tol}else if(az>itol&&ax<tol)return ay<tol;return!1},isZeroVector:function(){return Math.abs(this.x)<mathUtils.EPS&&Math.abs(this.y)<mathUtils.EPS&&mathUtils.abs(this.z)<mathUtils.EPS},jitter:function(a,b,c){if(b===undefined||c===undefined)b=c=a;return this.x+=mathUtils.normalizedRandom()*a,this.y+=mathUtils.normalizedRandom()*b,this.z+=mathUtils.normalizedRandom()*c,this},limit:function(lim){return this.magSquared()>lim*lim?this.normalize().scaleSelf(lim):this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},magSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},maxSelf:function(vec){return this.x=Math.max(this.x,vec.x),this.y=Math.max(this.y,vec.y),this.z=Math.max(this.z,vec.z),this},minSelf:function(vec){return this.x=Math.min(this.x,vec.x),this.y=Math.min(this.y,vec.y),this.z=Math.min(this.z,vec.z),this},modSelf:function(basex,basey,basez){if(basey===undefined||basez===undefined)basey=basez=basex;return this.x%=basex,this.y%=basey,this.z%=basez,this},normalize:function(){var mag=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return mag>0&&(mag=1/mag,this.x*=mag,this.y*=mag,this.z*=mag),this},normalizeTo:function(length){var mag=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return mag>0&&(mag=length/mag,this.x*=mag,this.y*=mag,this.z*=mag),this},reciprocal:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},reflect:function(normal){return this.set(normal.scale(this.dot(normal)*2).subSelf(this))},rotateAroundAxis:function(vec_axis,theta){var ax=vec_axis.x,ay=vec_axis.y,az=vec_axis.z,ux=ax*this.x,uy=ax*this.y,uz=ax*this.z,vx=ay*this.x,vy=ay*this.y,vz=ay*this.z,wx=az*this.x,wy=az*this.y,wz=az*this.z;si=Math.sin(theta),co=Math.cos(theta);var xx=ax*(ux+vy+wz)+(this.x*(ay*ay+az*az)-ax*(vy+wz))*co+(-wy+vz)*si,yy=ay*(ux+vy+wz)+(this.y*(ax*ax+az*az)-ay*(ux+wz))*co+(wx-uz)*si,zz=az*(ux+vy+wz)+(this.z*(ax*ax+ay*ay)-az*(ux+vy))*co+(-vx+uy)*si;return this.x=xx,this.y=yy,this.z=zz,this},rotateX:function(theta){var co=Math.cos(theta),si=Math.sin(theta),zz=co*this.z-si*this.y;return this.y=si*this.z+co*this.y,this.z=zz,this},rotateY:function(theta){var co=Math.cos(theta),si=Math.sin(theta),xx=co*this.x-si*this.z;return this.z=si*this.x+co*this.z,this.x=xx,this},rotateZ:function(theta){var co=Math.cos(theta),si=Math.sin(theta),xx=co*this.x-si*this.y;return this.y=si*this.x+co*this.y,this.x=xx,this},roundToAxis:function(){return Math.abs(this.x)<.5?this.x=0:(this.x=this.x<0?-1:1,this.y=this.z=0),Math.abs(this.y)<.5?this.y=0:(this.y=this.y<0?-1:1,this.x=this.z=0),Math.abs(this.z)<.5?this.z=0:(this.z=this.z<0?-1:1,this.x=this.y=0),this},scale:function(a,b,c){if(internals.tests.hasXYZ(a))return new Vec3D(this.x*a.x,this.y*a.y,this.z*a.z);if(b===undefined||c===undefined)b=c=a;return new Vec3D(this.x*a,this.y*b,this.z*c)},scaleSelf:function(a,b,c){if(internals.tests.hasXYZ(a))return this.x*=a.x,this.y*=a.y,this.z*=a.z,this;if(b===undefined||c===undefined)b=c=a;return this.x*=a,this.y*=b,this.z*=c,this},set:function(a,b,c){if(internals.tests.hasXYZ(a))return this.x=a.x,this.y=a.y,this.z=a.z,this;if(b===undefined||c===undefined)b=c=a;return this.x=a,this.y=b,this.z=c,this},setXY:function(v){return this.x=v.x,this.y=v.y,this},shuffle:function(nIterations){var t;for(var i=0;i<nIterations;i++)switch(Math.floor(Math.random()*3)){case 0:t=this.x,this.x=this.y,this.z=t;break;case 1:t=this.x,this.x=this.z,this.z=t;break;case 2:t=this.y,this.y=this.z,this.z=t}return this},signum:function(){return this.x=this.x<0?-1:this.x===0?0:1,this.y=this.y<0?-1:this.y===0?0:1,this.z=this.z<0?-1:this.z===0?0:1,this},sub:function(a,b,c){if(internals.tests.hasXYZ(a))return new Vec3D(this.x-a.x,this.y-a.y,this.z-a.z);if(b===undefined||c===undefined)b=c=a;return new Vec3D(this.x-a,this.y-b,this.z-c)},subSelf:function(a,b,c){if(internals.tests.hasXYZ(a))return this.x-=a.x,this.y-=a.y,this.z-=a.z,this;if(b===undefined||c===undefined)b=c=a;return this.x-=a,this.y-=b,this.z-=c,this},to2DXY:function(){return new Vec2D(this.x,this.y)},to2DXZ:function(){return new Vec2D(this.x,this.z)},to2DYZ:function(){return new Vec2D(this.y,this.z)},toArray:function(){return[this.x,this.y,this.z]},toArray4:function(w){var ta=this.toArray();return ta[3]=w,ta},toCartesian:function(){var a=this.x*Math.cos(this.z),xx=a*Math.cos(this.y),yy=this.x*Math.sin(this.z),zz=a*Math.sin(this.y);return this.x=xx,this.y=yy,this.z=zz,this},toSpherical:function(){var xx=Math.abs(this.x)<=mathUtils.EPS?mathUtils.EPS:this.x,zz=this.z,radius=Math.sqrt(xx*xx+this.y*this.y+zz*zz);return this.z=Math.asin(this.y/radius),this.y=Math.atan(zz/xx)+(xx<0?Math.PI:0),this.x=radius,this},toString:function(){return"[ x: "+this.x+", y: "+this.y+", z: "+this.z+"]"}},Vec3D.MIN_VALUE=new Vec3D(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),Vec3D.MAX_VALUE=new Vec3D(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Vec3D.fromXYTheta=function(theta){return new Vec3D(Math.cos(theta),Math.sin(theta),0)},Vec3D.fromXZTheta=function(theta){return new Vec3D(Math.cos(theta),0,Math.sin(theta))},Vec3D.fromYZTheta=function(theta){return new Vec3D(0,Math.cos(theta),Math.sin(theta))},Vec3D.max=function(a,b){return new Vec3D(Math.max(a.x,b.x),Math.max(a.y,b.y),Math.max(a.z,b.z))},Vec3D.min=function(a,b){return new Vec3D(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.min(a.z,b.z))},Vec3D.randomVector=function(){var v=new Vec3D(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1);return v.normalize()},Vec3D.ZERO=new Vec3D(0,0,0),Vec3D.X_AXIS=new Vec3D(1,0,0),Vec3D.Y_AXIS=new Vec3D(0,1,0),Vec3D.Z_AXIS=new Vec3D(0,0,1),Vec3D.Axis={X:{getVector:function(){return Vec3D.X_AXIS},toString:function(){return"Vec3D.Axis.X"}},Y:{getVector:function(){return Vec3D.Y_AXIS},toString:function(){return"Vec3D.Axis.Y"}},Z:{getVector:function(){return Vec3D.Z_AXIS},toString:function(){return"Vec3D.Axis.Z"}}},module.exports=Vec3D}),define("toxi/geom/Vec2D",["require","exports","module","../math/mathUtils","./Vec3D","./Vec3D","./Vec3D","./Vec3D","../internals"],function(require,exports,module){var mathUtils=require("../math/mathUtils"),internals=require("../internals"),hasXY=internals.tests.hasXY,isRect=internals.tests.isRect,Vec2D=function(a,b){hasXY(a)?(b=a.y,a=a.x):(a===undefined&&(a=0),b===undefined&&(b=0)),this.x=a,this.y=b};Vec2D.Axis={X:{getVector:function(){return Vec2D.X_AXIS},toString:function(){return"Vec2D.Axis.X"}},Y:{getVector:function(){return Vec2D.Y_AXIS},toString:function(){return"Vec2D.Axis.Y"}}};var _getXY=function(a,b){return hasXY(a)?(b=a.y,a=a.x):a!==undefined&&b===undefined?b=a:a===undefined?a=0:b===undefined&&(b=0),{x:a,y:b}};Vec2D.prototype={abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},add:function(a,b){var v=new Vec2D(a,b);return v.x+=this.x,v.y+=this.y,v},addSelf:function(a,b){var v=_getXY(a,b);return this.x+=v.x,this.y+=v.y,this},angleBetween:function(v,faceNormalize){if(faceNormalize===undefined){var dot=this.dot(v);return Math.acos(this.dot(v))}var theta=faceNormalize?this.getNormalized().dot(v.getNormalized()):this.dot(v);return Math.acos(theta)},clear:function(){return this.x=this.y=0,this},compareTo:function(vec){return this.x==vec.x&&this.y==vec.y?0:this.magSquared()-vec.magSquared()},constrain:function(a,b){return hasXY(a)&&hasXY(b)?(this.x=mathUtils.clip(this.x,a.x,b.x),this.y=mathUtils.clip(this.y,a.y,b.y)):isRect(a)&&(this.x=mathUtils.clip(this.x,a.x,a.x+a.width),this.y=mathUtils.clip(this.y,a.y,a.y+a.height)),this},copy:function(){return new Vec2D(this)},cross:function(v){return this.x*v.y-this.y*v.x},distanceTo:function(v){if(v!==undefined){var dx=this.x-v.x,dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy)}return NaN},distanceToSquared:function(v){if(v!==undefined){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy}return NaN},dot:function(v){return this.x*v.x+this.y*v.y},equals:function(obj){return hasXY(obj)?this.x==obj.x&&this.y==obj.y:!1},equalsWithTolerance:function(v,tolerance){return mathUtils.abs(this.x-v.x)<tolerance&&mathUtils.abs(this.y-v.y)<tolerance?!0:!1},floor:function(){return this.x=mathUtils.floor(this.x),this.y=mathUtils.floor(this.y),this},frac:function(){return this.x-=mathUtils.floor(this.x),this.y-=mathUtils.floor(this.y),this},getAbs:function(){return(new Vec2D(this)).abs()},getComponent:function(id){return typeof id=="number"&&(id=id===0?Vec2D.Axis.X:Vec2D.Axis.Y),id==Vec2D.Axis.X?this.x:id==Vec2D.Axis.Y?this.y:0},getConstrained:function(r){return(new Vec2D(this)).constrain(r)},getFloored:function(){return(new Vec2D(this)).floor()},getFrac:function(){return(new Vec2D(this)).frac()},getInverted:function(){return new Vec2D(-this.x,-this.y)},getLimited:function(lim){return this.magSquared()>lim*lim?this.getNormalizedTo(lim):new Vec2D(this)},getNormalized:function(){return(new Vec2D(this)).normalize()},getNormalizedTo:function(len){return(new Vec2D(this)).normalizeTo(len)},getPerpendicular:function(){return(new Vec2D(this)).perpendicular()},getReciprocal:function(){return(new Vec2D(this)).reciprocal()},getReflected:function(normal){return(new Vec2D(this)).reflect(normal)},getRotated:function(theta){return(new Vec2D(this)).rotate(theta)},getSignum:function(){return(new Vec2D(this)).signum()},heading:function(){return Math.atan2(this.y,this.x)},interpolateTo:function(v,f,s){return s===undefined?new Vec2D(this.x+(v.x-this.x)*f,this.y+(v.y-this.y)*f):new Vec2D(s.interpolate(this.x,v.x,f),s.interpolate(this.y,v.y,f))},interpolateToSelf:function(v,f,s){return s===undefined?(this.x+=(v.x-this.x)*f,this.y+=(v.y-this.y)*f):(this.x=s.interpolate(this.x,v.x,f),this.y=s.interpolate(this.y,v.y,f)),this},invert:function(){return this.x*=-1,this.y*=-1,this},isInCircle:function(sO,sR){var d=this.sub(sO).magSquared();return d<=sR*sR},isInRectangle:function(rect){return this.x<rect.x||this.x>rect.x+rect.width?!1:this.y<rect.y||this.y>rect.y+rect.height?!1:!0},isInTriangle:function(a,b,c){var v1=this.sub(a).normalize(),v2=this.sub(b).normalize(),v3=this.sub(c).normalize(),total_angles=Math.acos(v1.dot(v2));return total_angles+=Math.acos(v2.dot(v3)),total_angles+=Math.acos(v3.dot(v1)),Math.abs(total_angles-mathUtils.TWO_PI)<=.005},isMajorAxis:function(tol){var ax=Math.abs(this.x),ay=Math.abs(this.y),itol=1-tol;return ax>itol?ay<tol:ay>itol?ax<tol:!1},isZeroVector:function(){return Math.abs(this.x)<mathUtils.EPS&&Math.abs(this.y)<mathUtils.EPS},jitter:function(a,b){var v=_getXY(a,b);return this.x+=mathUtils.normalizedRandom()*v.x,this.y+=mathUtils.normalizedRandom()*v.y,this},limit:function(lim){return this.magSquared()>lim*lim?this.normalize().scaleSelf(lim):this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magSquared:function(){return this.x*this.x+this.y*this.y},max:function(v){return new Vec2D(mathUtils.max(this.x,v.x),mathUtils.max(this.y,v.y))},maxSelf:function(v){return this.x=mathUtils.max(this.x,v.x),this.y=mathUtils.max(this.y,v.y),this},min:function(v){return new Vec2D(mathUtils.min(this.x,v.x),mathUtils.min(this.y,v.y))},minSelf:function(v){return this.x=mathUtils.min(this.x,v.x),this.y=mathUtils.min(this.y,v.y),this},normalize:function(){var mag=this.x*this.x+this.y*this.y;return mag>0&&(mag=1/Math.sqrt(mag),this.x*=mag,this.y*=mag),this},normalizeTo:function(len){var mag=Math.sqrt(this.x*this.x+this.y*this.y);return mag>0&&(mag=len/mag,this.x*=mag,this.y*=mag),this},perpendicular:function(){var t=this.x;return this.x=-this.y,this.y=t,this},positiveHeading:function(){var dist=Math.sqrt(this.x*this.x+this.y*this.y);return this.y>=0?Math.acos(this.x/dist):Math.acos(-this.x/dist)+mathUtils.PI},reciprocal:function(){return this.x=1/this.x,this.y=1/this.y,this},reflect:function(normal){return this.set(normal.scale(this.dot(normal)*2).subSelf(this))},rotate:function(theta){var co=Math.cos(theta),si=Math.sin(theta),xx=co*this.x-si*this.y;return this.y=si*this.x+co*this.y,this.x=xx,this},roundToAxis:function(){return Math.abs(this.x)<.5?this.x=0:(this.x=this.x<0?-1:1,this.y=0),Math.abs(this.y)<.5?this.y=0:(this.y=this.y<0?-1:1,this.x=0),this},scale:function(a,b){var v=_getXY(a,b);return new Vec2D(this.x*v.x,this.y*v.y)},scaleSelf:function(a,b){var v=_getXY(a,b);return this.x*=v.x,this.y*=v.y,this},set:function(a,b){var v=_getXY(a,b);return this.x=v.x,this.y=v.y,this},setComponent:function(id,val){return typeof id=="number"&&(id=id===0?Vec2D.Axis.X:Vec2D.Axis.Y),id===Vec2D.Axis.X?this.x=val:id===Vec2D.Axis.Y&&(this.y=val),this},signum:function(){return this.x=this.x<0?-1:this.x===0?0:1,this.y=this.y<0?-1:this.y===0?0:1,this},sub:function(a,b){var v=_getXY(a,b);return new Vec2D(this.x-v.x,this.y-v.y)},subSelf:function(a,b){var v=_getXY(a,b);return this.x-=v.x,this.y-=v.y,this},tangentNormalOfEllipse:function(eO,eR){var p=this.sub(eO),xr2=eR.x*eR.x,yr2=eR.y*eR.y;return(new Vec2D(p.x/xr2,p.y/yr2)).normalize()},toArray:function(){return[this.x,this.y]},toCartesian:function(){var xx=this.x*Math.cos(this.y);return this.y=this.x*Math.sin(this.y),this.x=xx,this},toPolar:function(){var r=Math.sqrt(this.x*this.x+this.y*this.y);return this.y=Math.atan2(this.y,this.x),this.x=r,this},toString:function(){var s="{x:"+this.x+", y:"+this.y+"}";return s}},Vec2D.prototype.bisect=function(b){var Vec3D=require("./Vec3D"),diff=this.sub(b),sum=this.add(b),dot=diff.dot(sum);return new Vec3D(diff.x,diff.y,-dot/2)},Vec2D.prototype.to3DXY=function(){var Vec3D=require("./Vec3D");return new Vec3D(this.x,this.y,0)},Vec2D.prototype.to3DXZ=function(){var Vec3D=require("./Vec3D");return new Vec3D(this.x,0,this.y)},Vec2D.prototype.to3DYZ=function(){var Vec3D=require("./Vec3D");return new Vec3D(0,this.x,this.y)},Vec2D.X_AXIS=new Vec2D(1,0),Vec2D.Y_AXIS=new Vec2D(0,1),Vec2D.ZERO=new Vec2D,Vec2D.MIN_VALUE=new Vec2D(Number.MIN_VALUE,Number.MIN_VALUE),Vec2D.MAX_VALUE=new Vec2D(Number.MAX_VALUE,Number.MAX_VALUE),Vec2D.fromTheta=function(theta){return new Vec2D(Math.cos(theta),Math.sin(theta))},Vec2D.max=function(a,b){return new Vec2D(mathUtils.max(a.x,b.x),mathUtils.max(a.y,b.y))},Vec2D.min=function(a,b){return new Vec2D(mathUtils.min(a.x,b.x),mathUtils.min(a.y,b.y))},Vec2D.randomVector=function(rnd){var v=new Vec2D(Math.random()*2-1,Math.random()*2-1);return v.normalize()},module.exports=Vec2D}),define("toxi/color/TColor",["require","exports","module","../math/mathUtils","../geom/Vec2D","../geom/Vec3D","../internals"],function(require,exports,module){var internals=require("../internals"),mathUtils=require("../math/mathUtils"),Vec2D=require("../geom/Vec2D"),Vec3D=require("../geom/Vec3D"),dec2hex=function(number){return number<0&&(number=4294967295+number+1),number.toString(16)},TColor=function(tcolor){this.rgb=[],this.hsv=[],this.cmyk=[],this._alpha=1;if(tcolor!==undefined){var buffer=tcolor.toCMYKAArray();this.cmyk=buffer.splice(0,4),this.hsv=tcolor.toHSVAArray().splice(0,3),this.rgb=tcolor.toRGBAArray().splice(0,3),this._alpha=tcolor._alpha}};TColor.prototype={add:function(c){return this.copy().addSelf(c)},addSelf:function(c){return this.rgb[0]=mathUtils.min(this.rgb[0]+c.rgb[0],1),this.rgb[1]=mathUtils.min(this.rgb[1]+c.rgb[1],1),this.rgb[2]=mathUtils.min(this.rgb[2]+c.rgb[2],1),this.setRGB(rgb)},adjustConstrast:function(amount){return this.hsv[2]<.5?this.darken(amount):this.lighten(amount)},adjustHSV:function(h,s,v){return this.setHSV([this.hsv[0]+h,this.hsv[1]+s,this.hsv[2]+v])},adjustRGB:function(r,g,b){return this.setRGB([this.rgb[0]+r,this.rgb[1]+g,this.rgb[2]+b])},alpha:function(){return this._alpha},analog:function(theta,delta){var angle=mathUtils.degrees(theta);return this.rotateRYB(angle*mathUtils.normalizedRandom()),this.hsv[1]+=delta*mathUtils.normalizedRandom(),this.hsv[2]+=delta*mathUtils.normalizedRandom(),this.setHSV(this.hsv)},black:function(){return this.cmyk[3]},blend:function(c,t){t===undefined&&(t=.5);var crgb=c.toRGBAArray();return this.rgb[0]+=(crgb[0]-this.rgb[0])*t,this.rgb[1]+=(crgb[1]-this.rgb[1])*t,this.rgb[2]+=(crgb[2]-this.rgb[2])*t,this._alpha+=(c.alpha()-this._alpha)*t,this.setRGB(this.rgb)},blue:function(){return this.rgb[2]},brightness:function(){return this.hsv[2]},complement:function(){return this.rotateRYB(180)},copy:function(){return new TColor(this)},cyan:function(){return this.cmyk[0]},darken:function(step){return this.hsv[2]=mathUtils.clip(this.hsv[2]-step,0,1),this.setHSV(this.hsv)},desaturate:function(step){return this.hsv[1]=mathUtils.clip(this.hsv[1]-step,0,1),this.setHSV(this.hsv)},differenceTo:function(c){return TColor.newRGB(Math.abs(this.rgb[0]-c.rgb[0]),Math.abs(this.rgb[1]-c.rgb[1]),Math.abs(this.rgb[2]-c.rgb[2]))},distanceToCMYK:function(c){var ccmyk=c.toCMYKAArray(),dc=this.cmyk[0]-ccmyk[0],dm=this.cmyk[1]-ccmyk[1],dy=this.cmyk[2]-ccmyk[2],dk=this.cmyk[3]-ccmyk[3];return Math.sqrt(dc*dc+dm*dm+dy*dy+dk*dk)},distanceToHSV:function(c){var hue=this.hsv[0]*mathUtils.TWO_PI,hue2=c.hue()*mathUtils.TWO_PI,v1=new Vec3D(Math.cos(hue)*this.hsv[1],Math.sin(hue)*this.hsv[1],this.hsv[2]),v2=new Vec3D(Math.cos(hue2)*c.saturation(),Math.sin(hue2)*c.saturation(),c.brightness());return v1.distanceTo(v2)},distanceToRGB:function(c){var crgb=c.toRGBAArray(),dr=this.rgb[0]-crgb[0],dg=this.rgb[1]-crgb[1],db=this.rgb[2]-crgb[2];return Math.sqrt(dr*dr+dg*dg+db*db)},equals:function(o){if(internals.tests.isTColor(o)){var c=o,dr=c.rgb[0]-this.rgb[0],dg=c.rgb[1]-this.rgb[1],db=c.rgb[2]-this.rgb[2],da=c.alpha()-this._alpha,d=Math.sqrt(dr*dr+dg*dg+db*db+da*da);return d<TColor.EPS}return!1},getAnalog:function(theta,delta){return(new TColor(this)).analog(theta,delta)},getBlended:function(c,t){return(new TColor(this)).blend(c,t)},getComplement:function(){return(new TColor(this)).complement()},getComponentValue:function(criteria){return criteria.getComponentValueFor(this)},getDarkened:function(step){return(new TColor(this)).darken(step)},getDesaturated:function(step){return(new TColor(this)).desaturate(step)},getDifferenceTo:function(c){return this.copy().differenceTo(c)},getInverted:function(){return(new TColor(this)).invert()},getLightened:function(step){return(new TColor(this)).lighten(step)},getRotatedRYB:function(theta){return(new TColor(this)).rotateRYB(theta)},getSaturated:function(step){return(new TColor(this)).saturate(step)},green:function(){return this.rgb[1]},hue:function(){return this.hsv[0]},invert:function(){return this.rgb[0]=1-this.rgb[0],this.rgb[1]=1-this.rgb[1],this.rgb[2]=1-this.rgb[2],this.setRGB(this.rgb)},isBlack:function(){return this.rgb[0]<=TColor.BLACK_POINT&&this.rgb[0]==this.rgb[1]&&this.rgb[0]==this.rgb[2]},isGrey:function(){return this.hsv[1]<TColor.GREY_THRESHOLD},isWhite:function(){return this.rgb[0]>=TColor.WHITE_POINT&&this.rgb[0]==this.rgb[1]&&this.rgb[0]==this.rgb[2]},lighten:function(step){return this.hsv[2]=mathUtils.clip(this.hsv[2]+step,0,1),this.setHSV(this.hsv)},luminance:function(){return this.rgb[0]*.299+this.rgb[1]*.587+this.rgb[2]*.114},magenta:function(){return this.cmyk[1]},red:function(){return this.rgb[0]},rotateRYB:function(theta){var deg=parseInt(mathUtils.degrees(theta),10),h=this.hsv[0]*360,i=0,p,q;theta%=360;var resultHue=0;for(i=0;i<TColor.RYB_WHEEL.length-1;i++){p=TColor.RYB_WHEEL[i],q=TColor.RYB_WHEEL[i+1],q.y<p.y&&(q.y+=360);if(p.y<=h&&h<=q.y){resultHue=p.x+(q.x-p.x)*(h-p.y)/(q.y-p.y);break}}resultHue=(resultHue+theta)%360;for(i=0;i<TColor.RYB_WHEEL.length-1;i++){p=TColor.RYB_WHEEL[i],q=TColor.RYB_WHEEL[i+1],q.y<p.y&&(q.y+=360);if(p.x<=resultHue&&resultHue<=q.x){h=p.y+(q.y-p.y)*(resultHue-p.x)/(q.x-p.x);break}}return this.hsv[0]=h%360/360,this.setHSV(this.hsv)},saturate:function(step){return this.hsv[1]=mathUtils.clip(this.hsv[1]+step,0,1),this.setHSV(this.hsv)},saturation:function(){return this.hsv[1]},setAlpha:function(alpha){return this._alpha=alpha,this},setARGB:function(argb){return this.setRGB((argb>>16&255)*TColor.INV8BIT,(argb>>8&255)*TColor.INV8BIT,(argb&255)*TColor.INV8BIT),this._alpha=(argb>>>24)*TColor.INV8BIT,this},setBlack:function(val){return this.cmyk[3]=val,this.setCMYK(cmyk)},setBlue:function(blue){return this.rgb[2]=blue,this.setRGB(this.rgb)},setBrightness:function(brightness){return this.hsv[2]=mathUtils.clip(brightness,0,1),this.setHSV(this.hsv)},setCMYK:function(c,m,y,k){return internals.tests.isArray(c)&&(m=c[1],y=c[2],k=c[3],c=c[0]),this.cmyk[0]=c,this.cmyk[1]=m,this.cmyk[2]=y,this.cmyk[3]=k,this.rgb=TColor.cmykToRGB(this.cmyk[0],this.cmyk[1],this.cmyk[2],this.cmyk[3]),this.hsv=TColor.rgbToHSV(this.rgb[0],this.rgb[1],this.rgb[2]),this},setCyan:function(val){return this.cmyk[0]=val,this.setCMYK(this.cmyk)},setGreen:function(green){return this.rgb[1]=green,this.setRGB(this.rgb)},setHSV:function(h,s,v){internals.tests.isArray(h)&&(s=h[1],v=h[2],h=h[0]);var newHSV=[h,s,v];return this.hsv[0]=newHSV[0]%1,this.hsv[0]<0&&this.hsv[0]++,this.hsv[1]=mathUtils.clip(newHSV[1],0,1),this.hsv[2]=mathUtils.clip(newHSV[2],0,1),this.rgb=TColor.hsvToRGB(this.hsv[0],this.hsv[1],this.hsv[2]),this.cmyk=TColor.rgbToCMYK(this.rgb[0],this.rgb[1],this.rgb[2]),this},setHue:function(hue){hue%=1,hue<0&&hue++,this.hsv[0]=hue,this.setHSV(this.hsv)},setMagenta:function(val){return this.cmyk[1]=val,this.setCMYK(this.cmyk)},setRed:function(red){return this.rgb[0]=red,this.setRGB(this.rgb)},setRGB:function(r,g,b){return internals.tests.isArray(r)&&(g=r[1],b=r[2],r=r[0]),this.rgb[0]=mathUtils.clip(r,0,1),this.rgb[1]=mathUtils.clip(g,0,1),this.rgb[2]=mathUtils.clip(b,0,1),this.cmyk=TColor.rgbToCMYK(this.rgb[0],this.rgb[1],this.rgb[2]),this.hsv=TColor.rgbToHSV(this.rgb[0],this.rgb[1],this.rgb[2]),this},setSaturation:function(saturation){return this.hsv[1]=mathUtils.clip(saturation,0,1),this.setHSV(this.hsv)},setYellow:function(val){return this.cmyk[2]=val,this.setCMYK(this.cmyk)},sub:function(c){return this.copy().subSelf(c)},subSelf:function(c){return this.rgb[0]=mathUtils.max(this.rgb[0]-c.rgb[0],0),this.rgb[1]=mathUtils.max(this.rgb[1]-c.rgb[1],0),this.rgb[2]=mathUtils.max(this.rgb[2]-c.rgb[2],0),this.setRGB(this.rgb)},toARGB:function(){var r=parseInt(this.rgb[0]*255,10),g=parseInt(this.rgb[1]*255,10),b=parseInt(this.rgb[2]*255,10),a=parseInt(this._alpha*255,10);return r<<16|g<<8|b|a<<24},toCMYKAArray:function(cmyka){return cmyka===undefined&&(cmyka=[]),cmyka[0]=this.cmyk[0],cmyka[1]=this.cmyk[1],cmyka[2]=this.cmyk[2],cmyka[3]=this.cmyk[3],cmyka[4]=this._alpha,cmyka},toHex:function(){var hex=dec2hex(this.toARGB());return hex.length>6&&(hex=hex.substring(2)),hex},toHSVAArray:function(hsva){return hsva===undefined&&(hsva=[]),hsva[0]=this.hsv[0],hsva[1]=this.hsv[1],hsva[2]=this.hsv[2],hsva[3]=this._alpha,hsva},toHSLACSS:function(){var hsva=this.toHSVAArray();return hsva[0]=Math.floor(hsva[0]*360),hsva[1]=Math.floor(hsva[1]*100),hsva[2]=Math.floor(hsva[2]*100),"hsla("+hsva[0]+","+hsva[1]+"%,"+hsva[2]+"%,"+hsva[3]+")"},toRGBAArray:function(rgba,offset){return rgba===undefined&&(rgba=[]),offset==undefined&&(offset=0),rgba[offset++]=this.rgb[0],rgba[offset++]=this.rgb[1],rgba[offset++]=this.rgb[2],rgba[offset]=this._alpha,rgba},toRGBACSS:function(asPercents){asPercents==asPercents||!1;var rgba=this.toRGBAArray();return asPercents?(rgba[0]=Math.floor(rgba[0]*100),rgba[1]=Math.floor(rgba[1]*100),rgba[2]=Math.floor(rgba[2]*100),"rgba("+rgba[0]+"%,"+rgba[1]+"%,"+rgba[2]+"%,"+rgba[3]+")"):(rgba[0]=Math.floor(rgba[0]*255),rgba[1]=Math.floor(rgba[1]*255),rgba[2]=Math.floor(rgba[2]*255),"rgba("+rgba[0]+","+rgba[1]+","+rgba[2]+","+rgba[3]+")")},toString:function(){return"TColor: rgb: "+this.rgb[0]+", "+this.rgb[1]+", "+this.rgb[2]+" hsv: "+this.hsv[0]+","+this.hsv[1]+","+this.hsv[2]+" cmyk: "+this.cmyk[0]+", "+this.cmyk[1]+","+this.cmyk[2]+","+this.cmyk[3]+" alpha: "+this._alpha},yellow:function(){return this.cmyk[2]}},TColor.INV60DEGREES=60/360,TColor.INV8BIT=1/255,TColor.EPS=.001,TColor.BLACK_POINT=.08,TColor.WHITE_POINT=1,TColor.GREY_THRESHOLD=.01,TColor.cmykToRGB=function(c,m,y,k,rgb){return rgb===undefined&&(rgb=[0,0,0]),rgb[0]=1-Math.min(1,c+k),rgb[1]=1-Math.min(1,m+k),rgb[2]=1-Math.min(1,y+k),rgb},TColor.hexToRGB=function(hexRGB,rgb){return rgb===undefined&&(rgb=[]),hexRGB=hexRGB.charAt(0)=="#"?hexRGB.substring(1,7):hexRGB,rgb[0]=parseInt(hexRGB.substring(0,2),16)*TColor.INV8BIT,rgb[1]=parseInt(hexRGB.substring(2,4),16)*TColor.INV8BIT,rgb[2]=parseInt(hexRGB.substring(4,6),16)*TColor.INV8BIT,rgb},TColor.hsvToRGB=function(h,s,v,rgb){rgb===undefined&&(rgb=[]);if(s===0)rgb[0]=rgb[1]=rgb[2]=v;else{h/=TColor.INV60DEGREES;var i=parseInt(h,10),f=h-i,p=v*(1-s),q=v*(1-s*f),t=v*(1-s*(1-f));i===0?(rgb[0]=v,rgb[1]=t,rgb[2]=p):i==1?(rgb[0]=q,rgb[1]=v,rgb[2]=p):i==2?(rgb[0]=p,rgb[1]=v,rgb[2]=t):i==3?(rgb[0]=p,rgb[1]=q,rgb[2]=v):i==4?(rgb[0]=t,rgb[1]=p,rgb[2]=v):(rgb[0]=v,rgb[1]=p,rgb[2]=q)}return rgb},TColor.labToRGB=function(l,a,b,rgb){rgb===undefined&&(rgb=[]);var y=(l+16)/116,x=a/500+y,z=y-b/200,i=0;rgb[0]=x,rgb[1]=y,rgb[2]=z;for(i=0;i<3;i++){var p=Math.pow(rgb[i],3);p>.008856?rgb[i]=p:rgb[i]=(rgb[i]-16/116)/7.787}x=rgb[0]*.95047,y=rgb[1],z=rgb[2]*1.08883,rgb[0]=x*3.2406+y*-1.5372+z*-0.4986,rgb[1]=x*-0.9689+y*1.8758+z*.0415,rgb[2]=x*.0557+y*-0.204+z*1.057;var tpow=1/2.4;for(i=0;i<3;i++)rgb[i]>.0031308?rgb[i]=1.055*Math.pow(rgb[i],tpow)-.055:rgb[i]=12.92*rgb[i];return rgb},TColor.newARGB=function(argb){return TColor.newRGBA((argb>>16&255)*TColor.INV8BIT,(argb>>8&255)*TColor.INV8BIT,(argb&255)*TColor.INV8BIT,(argb>>>24)*TColor.INV8BIT)},TColor.newCMYK=function(c,m,y,k){return TColor.newCMYKA(c,m,y,k,1)},TColor.newCMYKA=function(c,m,y,k,a){var col=new TColor;return col.setCMYK([c,m,y,k]),col.setAlpha(mathUtils.clip(a,0,1)),col},TColor.newGray=function(gray){return TColor.newGrayAlpha(gray,1)},TColor.newGrayAlpha=function(gray,alpha){var c=new TColor;return c.setRGB([gray,gray,gray]),c.setAlpha(alpha),c},TColor.newHex=function(hexRGB){var c=new TColor;return c.setRGB(TColor.hexToRGB(hexRGB)),c.setAlpha(1),c},TColor.newHSV=function(h,s,v){return TColor.newHSVA(h,s,v,1)},TColor.newHSVA=function(h,s,v,a){var c=new TColor;return c.setHSV(h,s,v),c.setAlpha(mathUtils.clip(a,0,1)),c},TColor.newRandom=function(){return TColor.newRGBA(Math.random(),Math.random(),Math.random(),1)},TColor.newRGB=function(r,g,b){return TColor.newRGBA(r,g,b,1)},TColor.newRGBA=function(r,g,b,a){var c=new TColor;return c.setRGB([r,g,b]),c.setAlpha(mathUtils.clip(a,0,1)),c},TColor.rgbToCMYK=function(r,g,b,cmyk){return cmyk===undefined&&(cmyk=[]),cmyk[0]=1-r,cmyk[1]=1-g,cmyk[2]=1-b,cmyk[3]=mathUtils.min(cmyk[0],cmyk[1],cmyk[2]),cmyk[0]=mathUtils.clip(cmyk[0]-cmyk[3],0,1),cmyk[1]=mathUtils.clip(cmyk[1]-cmyk[3],0,1),cmyk[2]=mathUtils.clip(cmyk[2]-cmyk[3],0,1),cmyk[3]=mathUtils.clip(cmyk[3],0,1),cmyk},TColor.rgbToHex=function(r,g,b){var hex=dec2hex(mathUtils.clip(r,0,1)*255)+dec2hex(mathUtils.clip(g,0,1)*255)+dec2hex(mathUtils.clip(b,0,1)*255);return hex},TColor.rgbToHSV=function(r,g,b,hsv){hsv===undefined&&(hsv=[]);var h=0,s=0,v=mathUtils.max(r,g,b),d=v-mathUtils.min(r,g,b);return v!==0&&(s=d/v),s!==0&&(r==v?h=(g-b)/d:g==v?h=2+(b-r)/d:h=4+(r-g)/d),h*=TColor.INV60DEGREES,h<0&&(h+=1),hsv[0]=h,hsv[1]=s,hsv[2]=v,hsv},TColor.RED=TColor.newRGB(1,0,0),TColor.RYB_WHEEL=[new Vec2D(0,0),new Vec2D(15,8),new Vec2D(30,17),new Vec2D(45,26),new Vec2D(60,34),new Vec2D(75,41),new Vec2D(90,48),new Vec2D(105,54),new Vec2D(120,60),new Vec2D(135,81),new Vec2D(150,103),new Vec2D(165,123),new Vec2D(180,138),new Vec2D(195,155),new Vec2D(210,171),new Vec2D(225,187),new Vec2D(240,204),new Vec2D(255,219),new Vec2D(270,234),new Vec2D(285,251),new Vec2D(300,267),new Vec2D(315,282),new Vec2D(330,298),new Vec2D(345,329),new Vec2D(360,0)],TColor.GREEN=TColor.newRGB(0,1,0),TColor.BLUE=TColor.newRGB(0,0,1),TColor.CYAN=TColor.newRGB(0,1,1),TColor.MAGENTA=TColor.newRGB(1,0,1),TColor.YELLOW=TColor.newRGB(1,1,0),TColor.BLACK=TColor.newRGB(0,0,0),TColor.WHITE=TColor.newRGB(1,1,1),module.exports=TColor}),define("toxi/color",["require","exports","module","./color/TColor"],function(require,exports,module){module.exports={TColor:require("./color/TColor")}}),define("toxi/geom/Matrix4x4",["require","exports","module","../math/mathUtils","./Vec3D","../internals"],function(require,exports,module){var mathUtils=require("../math/mathUtils"),internals=require("../internals"),Vec3D=require("./Vec3D"),Matrix4x4=function(v11,v12,v13,v14,v21,v22,v23,v24,v31,v32,v33,v34,v41,v42,v43,v44){this.temp=[],this.matrix=[];var self=this;if(arguments.length===0)this.matrix[0]=[1,0,0,0],this.matrix[1]=[0,1,0,0],this.matrix[2]=[0,0,1,0],this.matrix[3]=[0,0,0,1];else if(typeof v11=="number"){var m1=[v11,v12,v13,v14],m2=[v21,v22,v23,v24],m3=[v31,v32,v33,v34],m4=[v41,v42,v43,v44];this.matrix=[m1,m2,m3,m4]}else if(internals.tests.isArray(v11)){var array=v11;if(array.length!=9&&array.length!=16)throw new Error("Matrix4x4: Array length must == 9 or 16");array.length==16?(this.matrix=[],this.matrix[0]=array.slice(0,4),this.matrix[1]=array.slice(4,8),this.matrix[2]=array.slice(8,12),this.matrix[3]=array.slice(12)):(this.matrix[0]=array.slice(0,3),this.matrix[0][3]=NaN,this.matrix[1]=array.slice(3,6),this.matrix[1][3]=NaN,this.matrix[2]=array.slice(6,9),this.matrix[2][3]=NaN,this.matrix[3]=[NaN,NaN,NaN,NaN])}else if(internals.tests.isMatrix4x4(v11)){var m=v11,i=0,j=0,lenM,lenMM;if(m.matrix.length==16)for(i=0;i<4;i++)this.matrix[i]=[m.matrix[i][0],m.matrix[i][1],m.matrix[i][2],m.matrix[i][3]];else if(m.matrix.length==4){lenM=m.matrix.length;for(i=0;i<lenM;i++){lenMM=m.matrix[i].length,self.matrix[i]=[];for(j=0;j<lenMM;j++)self.matrix[i][j]=m.matrix[i][j]}}}else console.error("Matrix4x4: incorrect parameters used to construct new instance")};Matrix4x4.prototype={add:function(rhs){var result=new Matrix4x4(this);return result.addSelf(rhs)},addSelf:function(m){for(var i=0;i<4;i++){var mi=this.matrix[i],rhsm=m.matrix[i];mi[0]+=rhsm[0],mi[1]+=rhsm[1],mi[2]+=rhsm[2],mi[3]+=rhsm[3]}return this},applyTo:function(v){return this.applyToSelf(new Vec3D(v))},applyToSelf:function(v){for(var i=0;i<4;i++){var m=this.matrix[i];this.temp[i]=v.x*m[0]+v.y*m[1]+v.z*m[2]+m[3]}return v.set(this.temp[0],this.temp[1],this.temp[2]).scaleSelf(1/this.temp[3]),v},copy:function(){return new Matrix4x4(this)},getInverted:function(){return(new Matrix4x4(this)).invert()},getRotatedAroundAxis:function(axis,theta){return(new Matrix4x4(this)).rotateAroundAxis(axis,theta)},getRotatedX:function(theta){return(new Matrix4x4(this)).rotateX(theta)},getRotatedY:function(theta){return(new Matrix4x4(this)).rotateY(theta)},getRotatedZ:function(theta){return(new Matrix4x4(this)).rotateZ(theta)},getTransposed:function(){return(new Matrix4x4(this)).transpose()},identity:function(){var m=this.matrix[0];return m[1]=m[2]=m[3]=0,m=this.matrix[1],m[0]=m[2]=m[3]=0,m=this.matrix[2],m[0]=m[1]=m[3]=0,m=this.matrix[3],m[0]=m[1]=m[2]=0,this.matrix[0][0]=1,this.matrix[1][1]=1,this.matrix[2][2]=1,this.matrix[3][3]=1,this},invert:function(){var tmp=[],src=[],dst=[],mat=this.toArray(),i=0;for(i=0;i<4;i++){var i4=i<<2;src[i]=mat[i4],src[i+4]=mat[i4+1],src[i+8]=mat[i4+2],src[i+12]=mat[i4+3]}tmp[0]=src[10]*src[15],tmp[1]=src[11]*src[14],tmp[2]=src[9]*src[15],tmp[3]=src[11]*src[13],tmp[4]=src[9]*src[14],tmp[5]=src[10]*src[13],tmp[6]=src[8]*src[15],tmp[7]=src[11]*src[12],tmp[8]=src[8]*src[14],tmp[9]=src[10]*src[12],tmp[10]=src[8]*src[13],tmp[11]=src[9]*src[12];var src0=src[0],src1=src[1],src2=src[2],src3=src[3],src4=src[4],src5=src[5],src6=src[6],src7=src[7];dst[0]=tmp[0]*src5+tmp[3]*src6+tmp[4]*src7,dst[0]-=tmp[1]*src5+tmp[2]*src6+tmp[5]*src7,dst[1]=tmp[1]*src4+tmp[6]*src6+tmp[9]*src7,dst[1]-=tmp[0]*src4+tmp[7]*src6+tmp[8]*src7,dst[2]=tmp[2]*src4+tmp[7]*src5+tmp[10]*src7,dst[2]-=tmp[3]*src4+tmp[6]*src5+tmp[11]*src7,dst[3]=tmp[5]*src4+tmp[8]*src5+tmp[11]*src6,dst[3]-=tmp[4]*src4+tmp[9]*src5+tmp[10]*src6,dst[4]=tmp[1]*src1+tmp[2]*src2+tmp[5]*src3,dst[4]-=tmp[0]*src1+tmp[3]*src2+tmp[4]*src3,dst[5]=tmp[0]*src0+tmp[7]*src2+tmp[8]*src3,dst[5]-=tmp[1]*src0+tmp[6]*src2+tmp[9]*src3,dst[6]=tmp[3]*src0+tmp[6]*src1+tmp[11]*src3,dst[6]-=tmp[2]*src0+tmp[7]*src1+tmp[10]*src3,dst[7]=tmp[4]*src0+tmp[9]*src1+tmp[10]*src2,dst[7]-=tmp[5]*src0+tmp[8]*src1+tmp[11]*src2,tmp[0]=src2*src7,tmp[1]=src3*src6,tmp[2]=src1*src7,tmp[3]=src3*src5,tmp[4]=src1*src6,tmp[5]=src2*src5,tmp[6]=src0*src7,tmp[7]=src3*src4,tmp[8]=src0*src6,tmp[9]=src2*src4,tmp[10]=src0*src5,tmp[11]=src1*src4,src0=src[8],src1=src[9],src2=src[10],src3=src[11],src4=src[12],src5=src[13],src6=src[14],src7=src[15],dst[8]=tmp[0]*src5+tmp[3]*src6+tmp[4]*src7,dst[8]-=tmp[1]*src5+tmp[2]*src6+tmp[5]*src7,dst[9]=tmp[1]*src4+tmp[6]*src6+tmp[9]*src7,dst[9]-=tmp[0]*src4+tmp[7]*src6+tmp[8]*src7,dst[10]=tmp[2]*src4+tmp[7]*src5+tmp[10]*src7,dst[10]-=tmp[3]*src4+tmp[6]*src5+tmp[11]*src7,dst[11]=tmp[5]*src4+tmp[8]*src5+tmp[11]*src6,dst[11]-=tmp[4]*src4+tmp[9]*src5+tmp[10]*src6,dst[12]=tmp[2]*src2+tmp[5]*src3+tmp[1]*src1,dst[12]-=tmp[4]*src3+tmp[0]*src1+tmp[3]*src2,dst[13]=tmp[8]*src3+tmp[0]*src0+tmp[7]*src2,dst[13]-=tmp[6]*src2+tmp[9]*src3+tmp[1]*src0,dst[14]=tmp[6]*src1+tmp[11]*src3+tmp[3]*src0,dst[14]-=tmp[10]*src3+tmp[2]*src0+tmp[7]*src1,dst[15]=tmp[10]*src2+tmp[4]*src0+tmp[9]*src1,dst[15]-=tmp[8]*src1+tmp[11]*src2+tmp[5]*src0;var det=1/(src[0]*dst[0]+src[1]*dst[1]+src[2]*dst[2]+src[3]*dst[3]);for(i=0,k=0;i<4;i++){var m=this.matrix[i];for(var j=0;j<4;j++)m[j]=dst[k++]*det}return this},multiply:function(a){return typeof a=="number"?(new Matrix4x4(this)).multiply(a):(new Matrix4x4(this)).multiplySelf(a)},multiplySelf:function(a){var i=0,m;if(typeof a=="number"){for(i=0;i<4;i++)m=this.matrix[i],m[0]*=a,m[1]*=a,m[2]*=a,m[3]*=a;return this}var mm0=a.matrix[0],mm1=a.matrix[1],mm2=a.matrix[2],mm3=a.matrix[3];for(i=0;i<4;i++){m=this.matrix[i];for(var j=0;j<4;j++)this.temp[j]=m[0]*mm0[j]+m[1]*mm1[j]+m[2]*mm2[j]+m[3]*mm3[j];m[0]=this.temp[0],m[1]=this.temp[1],m[2]=this.temp[2],m[3]=this.temp[3]}return this},rotateAroundAxis:function(axis,theta){var x,y,z,s,c,t,tx,ty;return x=axis.x,y=axis.y,z=axis.z,s=Math.sin(theta),c=Math.cos(theta),t=1-c,tx=t*x,ty=t*y,_TEMP.set(tx*x+c,tx*y+s*z,tx*z-s*y,0,tx*y-s*z,ty*y+c,ty*z+s*x,0,tx*z+s*y,ty*z-s*x,t*z*z+c,0,0,0,0,1),this.multiplySelf(_TEMP)},rotateX:function(theta){return _TEMP.identity(),_TEMP.matrix[1][1]=_TEMP.matrix[2][2]=Math.cos(theta),_TEMP.matrix[2][1]=Math.sin(theta),_TEMP.matrix[1][2]=-_TEMP.matrix[2][1],this.multiplySelf(_TEMP)},rotateY:function(theta){return _TEMP.identity(),_TEMP.matrix[0][0]=_TEMP.matrix[2][2]=Math.cos(theta),_TEMP.matrix[0][2]=Math.sin(theta),_TEMP.matrix[2][0]=-_TEMP.matrix[0][2],this.multiplySelf(_TEMP)},rotateZ:function(theta){return _TEMP.identity(),_TEMP.matrix[0][0]=_TEMP.matrix[1][1]=Math.cos(theta),_TEMP.matrix[1][0]=Math.sin(theta),_TEMP.matrix[0][1]=-_TEMP.matrix[1][0],this.multiplySelf(_TEMP)},scale:function(a,b,c){return(new Matrix4x4(this)).scaleSelf(a,b,c)},scaleSelf:function(a,b,c){if(internals.tests.hasXYZ(a))b=a.y,c=a.z,a=a.x;else if(b===undefined||c===undefined)b=a,c=a;return _TEMP.identity(),_TEMP.matrix[0][0]=a,_TEMP.matrix[1][1]=b,_TEMP.matrix[2][2]=c,this.multiplySelf(_TEMP)},set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var mat;if(typeof a=="number")mat=this.matrix[0],mat[0]=a,mat[1]=b,mat[2]=c,mat[3]=d,mat=this.matrix[1],mat[0]=e,mat[1]=f,mat[2]=g,mat[3]=h,mat=this.matrix[2],mat[0]=i,mat[1]=j,mat[2]=k,mat[3]=l,mat=this.matrix[3],mat[0]=m,mat[1]=n,mat[2]=o,mat[3]=p;else for(var it_n=0;it_n<4;it_n++){mat=this.matrix[it_n];var mat_n=mat.matrix[it_n];mat[0]=mat_n[0],mat[1]=mat_n[1],mat[2]=mat_n[2],mat[3]=mat_n[3]}return this},setFrustrum:function(left,right,top,bottom,near,far){var rl=right-left,tb=top-bottom,fn=far-near;return this.set(2*near/rl,0,(left+right)/rl,0,0,2*near/tb,(top+bottom)/tb,0,0,0,-(near+far)/fn,-2*near*far/fn,0,0,-1,0)},setOrtho:function(left,right,top,bottom,near,far){var mat=[2/(right-left),0,0,(left+right)/(right-left),0,2/(top-bottom),0,(top+bottom)/(top-bottom),0,0,-2/(far-near),(far+near)/(far-near),0,0,0,1];return this.set.apply(this,mat)},setPerspective:function(fov,aspect,near,far){var y=near*Math.tan(.5*mathUtils.radians(fov)),x=aspect*y;return this.setFrustrum(-x,x,y,-y,near,far)},setPosition:function(x,y,z){return this.matrix[0][3]=x,this.matrix[1][3]=y,this.matrix[2][3]=z,this},setScale:function(sX,sY,sZ){return this.matrix[0][0]=sX,this.matrix[1][1]=sY,this.matrix[2][2]=sZ,this},sub:function(m){return(new Matrix4x4(this)).subSelf(m)},subSelf:function(mat){for(var i=0;i<4;i++){var m=this.matrix[i],n=mat.matrix[i];m[0]-=n[0],m[1]-=n[1],m[2]-=n[2],m[3]-=n[3]}return this},toArray:function(result){result===undefined&&(result=[]);for(var i=0,k=0;i<4;i++){var m=this.matrix[i];for(var j=0;j<4;j++)result[k++]=m[j]}return result},toFloatArray:function(result){return new Float32Array(this.toArray(result))},toString:function(){return"| "+this.matrix[0][0]+" "+this.matrix[0][1]+" "+this.matrix[0][2]+" "+this.matrix[0][3]+" |\n"+"| "+this.matrix[1][0]+" "+this.matrix[1][1]+" "+this.matrix[1][2]+" "+this.matrix[1][3]+" |\n"+"| "+this.matrix[2][0]+" "+this.matrix[2][1]+" "+this.matrix[2][2]+" "+this.matrix[2][3]+" |\n"+"| "+this.matrix[3][0]+" "+this.matrix[3][1]+" "+this.matrix[3][2]+" "+this.matrix[3][3]+" |"},toTransposedFloatArray:function(result){result===undefined&&(result=[]);for(var i=0,k=0;i<4;i++)for(var j=0;j<4;j++)result[k++]=this.matrix[j][i];return result},translate:function(dx,dy,dz){return(new Matrix4x4(this)).translateSelf(dx,dy,dz)},translateSelf:function(dx,dy,dz){return internals.tests.hasXYZ(dx)&&(dy=dx.y,dz=dx.z,dx=dx.x),_TEMP.identity(),_TEMP.setPosition(dx,dy,dz),this.multiplySelf(_TEMP)},transpose:function(){return this.set(this.matrix[0][0],this.matrix[1][0],this.matrix[2][0],this.matrix[3][0],this.matrix[0][1],this.matrix[1][1],this.matrix[2][1],this.matrix[3][1],this.matrix[0][2],this.matrix[1][2],this.matrix[2][2],this.matrix[3][2],this.matrix[0][3],this.matrix[1][3],this.matrix[2][3],this.matrix[3][3])}};var _TEMP=new Matrix4x4;module.exports=Matrix4x4}),define("toxi/geom/Line3D",["require","exports","module","../math/mathUtils"],function(require,exports,module){var mathUtils=require("../math/mathUtils"),Line3D=function(vec_a,vec_b){this.a=vec_a,this.b=vec_b};Line3D.prototype={closestLineTo:function(l){var p43=l.a.sub(l.b);if(p43.isZeroVector())return new Line3D.LineIntersection(Line3D.LineIntersection.Type.NON_INTERSECTING);var p21=this.b.sub(this.a);if(p21.isZeroVector())return new Line3D.LineIntersection(Line3D.LineIntersection.Type.NON_INTERSECTING);var p13=this.a.sub(l.a),d1343=p13.x*p43.x+p13.y*p43.y+p13.z*p43.z,d4321=p43.x*p21.x+p43.y*p21.y+p43.z*p21.z,d1321=p13.x*p21.x+p13.y*p21.y+p13.z*p21.z,d4343=p43.x*p43.x+p43.y*p43.y+p43.z*p43.z,d2121=p21.x*p21.x+p21.y*p21.y+p21.z*p21.z,denom=d2121*d4343-d4321*d4321;if(Math.abs(denom)<mathUtils.EPS)return new Line3D.LineIntersection(Line3D.LineIntersection.Type.NON_INTERSECTING);var numer=d1343*d4321-d1321*d4343,mua=numer/denom,mub=(d1343+d4321*mua)/d4343,pa=this.a.add(p21.scaleSelf(mua)),pb=l.a.add(p43.scaleSelf(mub));return new Line3D.LineIntersection(Line3D.LineIntersection.Type.INTERSECTING,new Line3D(pa,pb),mua,mub)},closestPointTo:function(p){var v=this.b.sub(this.a),t=p.sub(this.a).dot(v)/v.magSquared();return t<0?this.a.copy():t>1?this.b.copy():this.a.add(v.scaleSelf(t))},copy:function(){return new Line3D(this.a.copy(),this.b.copy())},equals:function(obj){return this==obj?!0:typeof obj!=Line3D?!1:(this.a.equals(obj.a)||this.a.equals(l.b))&&(this.b.equals(l.b)||this.b.equals(l.a))},getDirection:function(){return this.b.sub(this.a).normalize()},getLength:function(){return this.a.distanceTo(this.b)},getLengthSquared:function(){return this.a.distanceToSquared(this.b)},getMidPoint:function(){return this.a.add(this.b).scaleSelf(.5)},getNormal:function(){return this.b.cross(this.a)},hasEndPoint:function(p){return this.a.equals(p)||this.b.equals(p)},offsetAndGrowBy:function(offset,scale,ref){var m=this.getMidPoint(),d=this.getDirection(),n=this.a.cross(d).normalize();return ref!==undefined&&m.sub(ref).dot(n)<0&&n.invert(),n.normalizeTo(offset),this.a.addSelf(n),this.b.addSelf(n),d.scaleSelf(scale),this.a.subSelf(d),this.b.addSelf(d),this},set:function(vec_a,vec_b){return this.a=vec_a,this.b=vec_b,this},splitIntoSegments:function(segments,stepLength,addFirst){return Line3D.splitIntoSegments(this.a,this.b,stepLength,segments,addFirst)},toString:function(){return this.a.toString()+" -> "+this.b.toString()}},Line3D.splitIntoSegments=function(vec_a,vec_b,stepLength,segments,addFirst){segments===undefined&&(segments=[]),addFirst&&segments.push(vec_a.copy());var dist=vec_a.distanceTo(vec_b);if(dist>stepLength){var pos=vec_a.copy(),step=vec_b.sub(vec_a).limit(stepLength);while(dist>stepLength)pos.addSelf(step),segments.push(pos.copy()),dist-=stepLength}return segments.push(vec_b.copy()),segments},Line3D.LineIntersection=function(type,line,mua,mub){this.type=type,mua===undefined&&(mua=0),mub===undefined&&(mub=0),this.line=line,this.coeff=[mua,mub]},Line3D.LineIntersection.prototype={getCoefficient:function(){return this.coeff},getLength:function(){return this.line===undefined?undefined:this.line.getLength()},getLine:function(){return this.line===undefined?undefined:this.line.copy()},getType:function(){return this.type},isIntersectionInside:function(){return this.type==Line3D.LineIntersection.Type.INTERSECTING&&this.coeff[0]>=0&&this.coeff[0]<=1&&this.coeff[1]>=0&&this.coeff[1]<=1},toString:function(){return"type: "+this.type+" line: "+this.line}},Line3D.LineIntersection.Type={NON_INTERSECTING:0,INTERSECTING:1},module.exports=Line3D}),define("toxi/geom/Triangle3D",["require","exports","module","../math/mathUtils","./Vec3D","./Line3D","./AABB"],function(require,exports,module){var mathUtils=require("../math/mathUtils"),Vec3D=require("./Vec3D"),Line3D=require("./Line3D"),AABB=require("./AABB"),Triangle3D=function(a,b,c){this.a=a,this.b=b,this.c=c};Triangle3D.createEquilateralFrom=function(a,b){var c=a.interpolateTo(b,.5),dir=b.sub(a),n=a.cross(dir.normalize());return c.addSelf(n.normalizeTo(dir.magnitude()*mathUtils.SQRT3/2)),new Triangle3D(a,b,c)},Triangle3D.isClockwiseInXY=function(a,b,c){var determ=(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y);return determ<0},Triangle3D.isClockwiseInXZ=function(a,b,c){var determ=(b.x-a.x)*(c.z-a.z)-(c.x-a.x)*(b.z-a.z);return determ<0},Triangle3D.isClockwiseInYZ=function(a,b,c){var determ=(b.y-a.y)*(c.z-a.z)-(c.y-a.y)*(b.z-a.z);return determ<0},Triangle3D.prototype={closestPointOnSurface:function(p){var ab=this.b.sub(this.a),ac=this.c.sub(this.a),bc=this.c.sub(this.b),pa=p.sub(this.a),pb=p.sub(this.b),pc=p.sub(this.c),ap=a.sub(this.p),bp=b.sub(this.p),cp=c.sub(this.p),snom=pa.dot(ab),tnom=pa.dot(ac);if(snom<=0&&tnom<=0)return this.a;var sdenom=pb.dot(this.a.sub(this.b)),tdenom=pc.dot(this.a.sub(this.c)),unom=pb.dot(bc),udenom=pc.dot(this.b.sub(this.c));if(sdenom<=0&&unom<=0)return this.b;if(tdenom<=0&&udenom<=0)return this.c;var n=ab.cross(ac),vc=n.dot(ap.crossSelf(bp));if(vc<=0&&snom>=0&&sdenom>=0)return this.a.add(ab.scaleSelf(snom/(snom+sdenom)));var va=n.dot(bp.crossSelf(cp));if(va<=0&&unom>=0&&udenom>=0)return this.b.add(bc.scaleSelf(unom/(unom+udenom)));var vb=n.dot(cp.crossSelf(ap));if(vb<=0&&tnom>=0&&tdenom>=0)return this.a.add(ac.scaleSelf(tnom/(tnom+tdenom)));var u=va/(va+vb+vc),v=vb/(va+vb+vc),w=1-u-v;return this.a.scale(u).addSelf(this.b.scale(v)).addSelf(this.c.scale(w))},computeCentroid:function(){return this.centroid=this.a.add(this.b).addSelf(this.c).scaleSelf(1/3),this.centroid},computeNormal:function(){return this.normal=this.a.sub(this.c).crossSelf(this.a.sub(this.b)).normalize(),this.normal},containsPoint:function(p){if(p.equals(this.a)||p.equals(this.b)||p.equals(this.c))return!0;var v1=p.sub(this.a).normalize(),v2=p.sub(this.b).normalize(),v3=p.sub(this.c).normalize(),total_angles=Math.acos(v1.dot(v2));return total_angles+=Math.acos(v2.dot(v3)),total_angles+=Math.acos(v3.dot(v1)),mathUtils.abs(total_angles-mathUtils.TWO_PI)<=.005},flipVertexOrder:function(){var t=this.a;return this.a=this.c,this.c=this.t,this},fromBarycentric:function(p){return new Vec3D(this.a.x*p.x+this.b.x*p.y+this.c.x*p.z,this.a.y*p.x+this.b.y*p.y+this.c.y*p.z,this.a.z*p.x+this.b.z*p.y+this.c.z*p.z)},getBoundingBox:function(){var min=Vec3D.min(Vec3D.min(this.a,this.b),this.c),max=Vec3D.max(Vec3D.max(this.a,this.b),this.c);return AABB.fromMinMax(min,max)},getClosestPointTo:function(p){var edge=new Line3D(this.a,this.b),Rab=edge.closestPointTo(p),Rbc=edge.set(this.b,this.c).closestPointTo(p),Rca=edge.set(this.c,this.a).closestPointTo(p),dAB=p.sub(Rab).magSquared(),dBC=p.sub(Rbc).magSquared(),dCA=p.sub(Rca).magSquared(),min=dAB,result=Rab;return dBC<min&&(min=dBC,result=Rbc),dCA<min&&(result=Rca),result},isClockwiseInXY:function(){return Triangle3D.isClockwiseInXY(this.a,this.b,this.c)},isClockwiseInXZ:function(){return Triangle3D.isClockwiseInXY(this.a,this.b,this.c)},isClockwiseInYZ:function(){return Triangle3D.isClockwiseInXY(this.a,this.b,this.c)},set:function(a2,b2,c2){this.a=a2,this.b=b2,this.c=c2},toBarycentric:function(p){var e=b.sub(this.a).cross(this.c.sub(this.a)),n=e.getNormalized(),areaABC=n.dot(e),areaPBC=n.dot(this.b.sub(p).cross(this.c.sub(p))),l1=areaPBC/areaABC,areaPCA=n.dot(this.c.sub(p).cross(this.a.sub(p))),l2=areaPCA/areaABC,l3=1-l1-l2;return new Vec3D(l1,l2,l3)},toString:function(){return"Triangle: "+this.a+","+this.b+","+this.c}},module.exports=Triangle3D}),define("toxi/geom/mesh/Face",["require","exports","module","../Triangle3D"],function(require,exports,module){var Triangle3D=require("../Triangle3D"),i=0,Face=function(a,b,c,uvA,uvB,uvC){this.a=a,this.b=b,this.c=c;var aminusc=this.a.sub(this.c),aminusb=this.a.sub(this.b),cross=aminusc.crossSelf(aminusb);this.normal=cross.normalize(),this.a.addFaceNormal(this.normal),this.b.addFaceNormal(this.normal),this.c.addFaceNormal(this.normal),uvA!==undefined&&(this.uvA=uvA,this.uvB=uvB,this.uvC=uvC)};Face.prototype={computeNormal:function(){this.normal=this.a.sub(this.c).crossSelf(this.a.sub(this.b)).normalize()},flipVertexOrder:function(){var t=this.a;this.a=this.b,this.b=t,this.normal.invert()},getCentroid:function(){return this.a.add(this.b).addSelf(this.c).scale(1/3)},getClass:function(){return"Face"},getVertices:function(verts){return verts!==undefined?(verts[0]=this.a,verts[1]=this.b,verts[2]=this.c):verts=[this.a,this.b,this.c],verts},toString:function(){return this.getClass()+" "+this.a+", "+this.b+", "+this.c},toTriangle:function(){return new Triangle3D(this.a.copy(),this.b.copy(),this.c.copy())}},module.exports=Face}),define("toxi/geom/Quaternion",["require","exports","module","../math/mathUtils","./Matrix4x4"],function(require,exports,module){var mathUtils=require("../math/mathUtils"),Matrix4x4=require("./Matrix4x4"),Quaternion=function(qw,vx,y,z){arguments.length==4?(this.w=qw,this.x=vx,this.y=y,this.z=z):arguments.length==2?(this.x=vx.x,this.y=vx.y,this.z=vx.z,this.w=qw):arguments.length==1&&(this.w=q.w,this.x=q.x,this.y=q.y,this.z=q.z)};Quaternion.prototype={add:function(q){return new Quaternion(this.x+q.x,this.y+q.y,this.z+q.z,this.w+q.w)},addSelf:function(q){return this.x+=q.x,this.y+=q.y,this.z+=q.z,this},copy:function(){return new Quaternion(this.w,this.x,this.y,this.z)},dot:function(q){return this.x*q.x+this.y*q.y+this.z*q.z+this.w*q.w},getConjugate:function(){var q=new Quaternion;return q.x=-this.x,q.y=-this.y,q.z=-this.z,q.w=w,q},identity:function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},interpolateTo:function(target,t,is){return arguments.length==3?this.copy().interpolateTo(target,is.interpolate(0,1,t)):this.copy().interpolateToSelf(target,t)},interpolateToSelf:function(target,t,is){arguments.length==3&&(t=is.interpolate(0,1,t));var scale,invscale,dot=mathUtils.clip(this.dot(target),-1,1);if(1-dot>=mathUtils.EPS){var theta=Math.acos(dot),invsintheta=1/Math.sin(theta);scale=Math.sin(theta*(1-t))*invsintheta,invscale=Math.sin(theta*t)*invsintheta}else scale=1-t,invscale=t;return dot<0?(this.w=scale*this.w-invscale*target.w,this.x=scale*this.x-invscale*target.x,this.y=scale*this.y-invscale*target.y,this.z=scale*this.z-invscale*target.z):(this.w=scale*w+invscale*target.w,this.x=scale*x+invscale*target.x,this.y=scale*y+invscale*target.y,this.z=scale*z+invscale*target.z),this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},multiply:function(q2){var res=new Quaternion;return res.w=this.w*q2.w-x*q2.x-y*q2.y-z*q2.z,res.x=this.w*q2.x+x*q2.w+y*q2.z-z*q2.y,res.y=this.w*q2.y+y*q2.w+z*q2.x-x*q2.z,res.z=this.w*q2.z+z*q2.w+x*q2.y-y*q2.x,res},normalize:function(){var mag=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return mag>mathUtils.EPS&&(mag=1/mag,this.x*=mag,this.y*=mag,this.z*=mag,this.w*=mag),this},scale:function(t){return new Quaternion(this.x*t,this.y*t,this.z*t,this.w*t)},scaleSelf:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},set:function(w,x,y,z){return arguments.length==4?(this.w=w,this.x=x,this.y=y,this.z=z):arguments.length==2?(this.w=w,this.x=v.x,this.y=v.y,this.z=v.z):(this.w=q.w,this.x=q.x,this.y=q.y,this.z=q.z),this},sub:function(q){return new Quaternion(this.x-q.x,this.y-q.y,this.z-q.z,this.w-q.w)},subSelf:function(q){return this.x-=q.x,this.y-=q.y,this.z-=q.z,this.w-=q.w,this},toArray:function(){return[this.w,this.x,this.y,this.z]},toAxisAngle:function(){var res=[],sa=Math.sqrt(1-this.w*this.w);return sa<mathUtils.EPS?sa=1:sa=1/sa,res[0]=Math.acos(this.w)*2,res[1]=this.x*sa,res[2]=this.y*sa,res[3]=this.z*sa,res},toMatrix4x4:function(result){result===undefined&&(result=new Matrix4x4);var x2=this.x+this.x,y2=this.y+this.y,z2=this.z+this.z,xx=this.x*x2,xy=this.x*y2,xz=this.x*z2,yy=this.y*y2,yz=this.y*z2,zz=this.z*z2,wx=this.w*x2,wy=this.w*y2,wz=this.w*z2,st=x2+","+y2+","+z2+","+xx+","+xy+","+xz+","+yy+","+yz+","+zz+","+wx+","+wy+","+wz;return result.set(1-(yy+zz),xy-wz,xz+wy,0,xy+wz,1-(xx+zz),yz-wx,0,xz-wy,yz+wx,1-(xx+yy),0,0,0,0,1)},toString:function(){return"{axis: ["+this.x+","+this.y+","+this.z+"], w: "+this.w+"}"}},Quaternion.DOT_THRESHOLD=.9995,Quaternion.createFromAxisAngle=function(axis,angle){angle*=.5;var sin=mathUtils.sin(angle),cos=mathUtils.cos(angle),q=new Quaternion(cos,axis.getNormalizedTo(sin));return q},Quaternion.createFromEuler=function(pitch,yaw,roll){pitch*=.5,yaw*=.5,roll*=.5;var sinPitch=mathUtils.sin(pitch),cosPitch=mathUtils.cos(pitch),sinYaw=mathUtils.sin(yaw),cosYaw=mathUtils.cos(yaw),sinRoll=mathUtils.sin(roll),cosRoll=mathUtils.cos(roll),cosPitchCosYaw=cosPitch*cosYaw,sinPitchSinYaw=sinPitch*sinYaw,q=new Quaternion;return q.x=sinRoll*cosPitchCosYaw-cosRoll*sinPitchSinYaw,q.y=cosRoll*sinPitch*cosYaw+sinRoll*cosPitch*sinYaw,q.z=cosRoll*cosPitch*sinYaw-sinRoll*sinPitch*cosYaw,q.w=cosRoll*cosPitchCosYaw+sinRoll*sinPitchSinYaw,q},Quaternion.createFromMatrix=function(m){var s=0,q=[],trace=m.matrix[0][0]+m.matrix[1][1]+m.matrix[2][2];if(trace>0)s=Math.sqrt(trace+1),q[3]=s*.5,s=.5/s,q[0]=m.matrix[1][2]-m.matrix[2][1]*s,q[1]=m.matrix[2][0]-m.matrix[0][2]*s,q[2]=m.matrix[0][1]-m.matrix[1][0]*s;else{var nxt=[1,2,0],i=0,j=0,k=0;m.matrix[1][1]>m.matrix[0][0]&&(i=1),m.matrix[2][2]>m.matrix[i][i]&&(i=2),j=nxt[i],k=nxt[j],s=Math.sqrt(m.matrix[i][i]-(m.matrix[j][j]+m.matrix[k][k])+1),q[i]=s*.5,s=.5/s,q[3]=(m.matrix[j][k]-m.matrix[k][j])*s,q[j]=(m.matrix[i][j]+m.matrix[j][i])*s,q[k]=(m.matrix[i][k]+m.matrix[k][i])*s}return new Quaternion(q[3],q[0],q[1],q[2])},Quaternion.getAlignmentQuat=function(dir,forward){var target=dir.getNormalized(),axis=forward.cross(target),length=axis.magnitude()+1e-4,angle=Math.atan2(length,forward.dot(target));return this.createFromAxisAngle(axis,angle)},module.exports=Quaternion}),define("toxi/geom/mesh/Vertex",["require","exports","module","../../internals","../Vec3D"],function(require,exports,module){var extend=require("../../internals").extend,Vec3D=require("../Vec3D"),Vertex=function(v,id){Vec3D.call(this,v),this.id=id,this.normal=new Vec3D};extend(Vertex,Vec3D),Vertex.prototype.addFaceNormal=function(n){this.normal.addSelf(n)},Vertex.prototype.clearNormal=function(){this.normal.clear()},Vertex.prototype.computeNormal=function(){this.normal.normalize()},Vertex.prototype.toString=function(){return this.id+": p: "+this.parent.toString.call(this)+" n:"+this.normal.toString()},module.exports=Vertex}),define("toxi/geom/mesh/TriangleMesh",["require","exports","module","../../math/mathUtils","../Matrix4x4","./Face","../Vec3D","../Triangle3D","../Quaternion","./Vertex"],function(require,exports,module){var mathUtils=require("../../math/mathUtils"),Matrix4x4=require("../Matrix4x4"),Face=require("./Face"),Vec3D=require("../Vec3D"),Triangle3D=require("../Triangle3D"),Quaternion=require("../Quaternion"),Vertex=require("./Vertex"),TriangleMesh=function(name,numV,numF){return name===undefined&&(name="untitled"),numV===undefined&&(numV=TriangleMesh.DEFAULT_NUM_VERTICES),numF===undefined&&(numF=TriangleMesh.DEFAULT_NUM_FACES),this.setName(name),this.matrix=new Matrix4x4,this.centroid=new Vec3D,this.vertices=[],this.__verticesObject={},this.faces=[],this.numVertices=0,this.numFaces=0,this.uniqueVertexID=0,this};TriangleMesh.DEFAULT_NUM_VERTICES=1e3,TriangleMesh.DEFAULT_NUM_FACES=3e3,TriangleMesh.DEFAULT_STRIDE=4,TriangleMesh.prototype={addFace:function(a,b,c,n,uvA,uvB,uvC){arguments.length==6&&(uvC=uvB,uvB=uvA,uvA=n,n=undefined);var va=this.__checkVertex(a),vb=this.__checkVertex(b),vc=this.__checkVertex(c);if(va.id!==vb.id&&va.id!==vc.id&&vb.id!==vc.id){if(n!==undefined){var nc=va.sub(vc).crossSelf(va.sub(vb));if(n.dot(nc)<0){var t=va;va=vb,vb=t}}var f=new Face(va,vb,vc,uvA,uvB,uvC);this.faces.push(f),this.numFaces++}return this},addMesh:function(m){var l=m.getFaces().length;for(var i=0;i<l;i++){var f=m.getFaces()[i];this.addFace(f.a,f.b,f.c)}return this},center:function(origin){this.computeCentroid();var delta=origin!==undefined?origin.sub(this.centroid):this.centroid.getInverted(),l=this.vertices.length;for(var i=0;i<l;i++){var v=this.vertices[i];v.addSelf(delta)}return this.getBoundingBox(),this.bounds},__checkVertex:function(v){var vString=v.toString(),vertex=this.__verticesObject[vString];return vertex===undefined&&(vertex=this.createVertex(v,this.uniqueVertexID++),this.__verticesObject[vString]=vertex,this.vertices.push(vertex),this.numVertices++),vertex},clear:function(){return this.vertices=[],this.faces=[],this.bounds=undefined,this.numVertices=0,this.numFaces=0,this},computeCentroid:function(){this.centroid.clear();var l=this.vertices.length;for(var i=0;i<l;i++)this.centroid.addSelf(this.vertices[i]);return this.centroid.scaleSelf(1/this.numVertices).copy()},computeFaceNormals:function(){var l=this.faces.length;for(var i=0;i<l;i++)this.faces[i].computeNormal()},computeVertexNormals:function(){var l=this.vertices.length,i=0;for(i=0;i<l;i++)this.vertices[i].clearNormal();l=this.faces.length;for(i=0;i<l;i++){var f=this.faces[i];f.a.addFaceNormal(f),f.b.addFaceNormal(f),f.c.addFaceNormal(f)}l=this.vertices.length;for(i=0;i<l;i++)this.vertices[i].computeNormal();return this},copy:function(){var m=new TriangleMesh(this.name+"-copy",this.numVertices,this.numFaces),l=this.faces.length;for(var i=0;i<l;i++){var f=this.faces[i];m.addFace(f.a,f.b,f.c,f.normal,f.uvA,f.uvB,f.uvC)}return m},createVertex:function(v,id){return new Vertex(v,id)},faceOutwards:function(){this.computeCentroid();var l=this.faces.length;for(var i=0;i<l;i++){var f=this.faces[i],n=f.getCentroid().sub(this.centroid),dot=n.dot(f.normal);dot<0&&f.flipVertexOrder()}return this},flipVertexOrder:function(){var l=this.faces.length;for(var i=0;i<l;i++){var f=this.faces[i],t=f.a;f.a=f.b,f.b=t,f.normal.invert()}return this},flipYAxis:function(){return this.transform((new Matrix4x4).scaleSelf(1,-1,1)),this.flipVertexOrder(),this},getBoundingBox:function(fn){if(fn===undefined)throw new Error("getBoundingBox() is an async method, provide a callback and the AABB will be the first parameter");var self=this;require(["../AABB"],function(AABB){var minBounds=Vec3D.MAX_VALUE.copy(),maxBounds=Vec3D.MIN_VALUE.copy(),l=self.vertices.length;for(var i=0;i<l;i++){var v=self.vertices[i];minBounds.minSelf(v),maxBounds.maxSelf(v)}self.bounds=AABB.fromMinMax(minBounds,maxBounds),fn(self.bounds)})},getBoundingSphere:function(fn){if(fn===undefined)throw new Error("getBoundingSphere() is an async method, provide a callback and the Sphere will be the first parameter");var self=this;require(["../Sphere"],function(Sphere){var radius=0;self.computeCentroid();var l=self.vertices.length;for(var i=0;i<l;i++){var v=self.vertices[i];radius=mathUtils.max(radius,v.distanceToSquared(self.centroid))}var sph=new Sphere(self.centroid,Math.sqrt(radius));fn(sph)})},getClosestVertexToPoint:function(p){var closest,minDist=Number.MAX_VALUE,l=this.vertices.length;for(var i=0;i<l;i++){var v=this.vertices[i],d=v.distanceToSquared(p);d<minDist&&(closest=v,minDist=d)}return closest},getFaceNormalsAsArray:function(normals,offset,stride){if(arguments.length===0)normals=undefined,offset=0,stride=TriangleMesh.DEFAULT_STRIDE;else if(arguments.length==1&&typeof arguments[0]=="object"){var opts=arguments[0];normals=opts.normals,offset=opts.offset,stride=opts.stride}stride=mathUtils.max(stride,3),normals===undefined&&(normals=[]);var i=offset,l=this.faces.length;for(var j=0;j<l;j++){var f=this.faces[j];normals[i]=f.normal.x,normals[i+1]=f.normal.y,normals[i+2]=f.normal.z,i+=stride,normals[i]=f.normal.x,normals[i+1]=f.normal.y,normals[i+2]=f.normal.z,i+=stride,normals[i]=f.normal.x,normals[i+1]=f.normal.y,normals[i+2]=f.normal.z,i+=stride}return normals},getFaces:function(){return this.faces},getFacesAsArray:function(){var faceList=[],i=0,l=this.faces.length;for(var j=0;j<l;j++){var f=this.faces[j];faceList[i++]=f.a.id,faceList[i++]=f.b.id,faceList[i++]=f.c.id}return faceList},getIntersectionData:function(){return this.intersector.getIntersectionData()},getMeshAsVertexArray:function(verts,offset,stride){verts===undefined&&(verts=undefined),offset===undefined&&(offset=0),stride===undefined&&(stride=TriangleMesh.DEFAULT_STRIDE),stride=mathUtils.max(stride,3),verts===undefined&&(verts=[]);var i=0,l=this.faces.length;for(var j=0;j<l;++j){var f=this.faces[j];verts[i]=f.a.x,verts[i+1]=f.a.y,verts[i+2]=f.a.z,i+=stride,verts[i]=f.b.x,verts[i+1]=f.b.y,verts[i+2]=f.b.z,i+=stride,verts[i]=f.c.x,verts[i+1]=f.c.y,verts[i+2]=f.c.z,i+=stride}return verts},getNumFaces:function(){return this.numFaces},getNumVertices:function(){return this.numVertices},getRotatedAroundAxis:function(axis,theta){return this.copy().rotateAroundAxis(axis,theta)},getRotatedX:function(theta){return this.copy().rotateX(theta)},getRotatedY:function(theta){return this.copy().rotateY(theta)},getRotatedZ:function(theta){return this.copy().rotateZ(theta)},getScaled:function(scale){return this.copy().scale(scale)},getTranslated:function(trans){return this.copy().translate(trans)},getUniqueVerticesAsArray:function(){var verts=[],i=0,l=this.vertices.length;for(var j=0;i<l;j++){var v=this.vertices[j];verts[i++]=v.x,verts[i++]=v.y,verts[i++]=v.z}return verts},getVertexAtPoint:function(v){var index;for(var i=0;i<this.vertices.length;i++)this.vertices[i].equals(v)&&(index=i);return this.vertices[index]},getVertexIndex:function(vec){var index=-1,l=this.vertices.length;for(var i=0;i<l;i++){var vert=this.vertices[i];vert.equals(vec)&&(matchedVertex=i)}return matchedVertex},getVertexForID:function(id){var vertex,l=this.vertices.length;for(var i=0;i<l;i++){var v=this.vertices[i];if(v.id==id){vertex=v;break}}return vertex},getVertexNormalsAsArray:function(normals,offset,stride){offset===undefined&&(offset=0),stride===undefined&&(stride=TriangleMesh.DEFAULT_STRIDE),stride=mathUtils.max(stride,3),normals===undefined&&(normals=[]);var i=offset,l=this.faces.length;for(var j=0;j<l;j++){var f=this.faces[j];normals[i]=f.a.normal.x,normals[i+1]=f.a.normal.y,normals[i+2]=f.a.normal.z,i+=stride,normals[i]=f.b.normal.x,normals[i+1]=f.b.normal.y,normals[i+2]=f.b.normal.z,i+=stride,normals[i]=f.c.normal.x,normals[i+1]=f.c.normal.y,normals[i+2]=f.c.normal.z,i+=stride}return normals},getVertices:function(){return this.vertices},handleSaveAsSTL:function(stl,useFlippedY){console.log("TriangleMesh.handleSaveAsSTL() currently not implemented")},intersectsRay:function(ray){var tri=this.intersector.getTriangle(),l=this.faces.length;for(var i=0;i<l;i++){tri.a=f.a,tri.b=f.b,tri.c=f.c;if(this.intersector.intersectsRay(ray))return!0}return!1},perforateFace:function(f,size){var centroid=f.getCentroid(),d=1-size,a2=f.a.interpolateTo(centroid,d),b2=f.b.interpolateTo(centroid,d),c2=f.c.interpolateTo(centroid,d);return this.removeFace(f),this.addFace(f.a,b2,a2),this.addFace(f.a,f.b,b2),this.addFace(f.b,c2,b2),this.addFace(f.b,f.c,c2),this.addFace(f.c,a2,c2),this.addFace(f.c,f.a,a2),new Triangle3D(a2,b2,c2)},pointTowards:function(dir){return this.transform(Quaternion.getAlignmentQuat(dir,Vec3D.Z_AXIS).toMatrix4x4(),!0)},removeFace:function(f){var index=-1,l=this.faces.length;for(var i=0;i<l;i++)if(this.faces[i]==f){index=i;break}index>-1&&this.faces.splice(index,1)},rotateAroundAxis:function(axis,theta){return this.transform(this.matrix.identity().rotateAroundAxis(axis,theta))},rotateX:function(theta){return this.transform(this.matrix.identity().rotateX(theta))},rotateY:function(theta){return this.transform(this.matrix.identity().rotateY(theta))},rotateZ:function(theta){return this.transform(this.matrix.identity().rotateZ(theta))},saveAsOBJ:function(obj,saveNormals){saveNormals===undefined&&(saveNormals=!0);var vOffset=obj.getCurrVertexOffset()+1,nOffset=obj.getCurrNormalOffset()+1;obj.newObject(this.name);var v=0,vlen=this.vertices.length,flen=this.faces.length,face;for(v=0;v<vlen;v++)obj.vertex(this.vertices[v]);if(saveNormals){for(v=0;v<vlen;v++)obj.normal(this.vertices[v].normal);for(f=0;f<flen;f++)face=this.faces[f],obj.faceWithNormals(face.b.id+vOffset,face.a.id+vOffset,face.c.id+vOffset,face.b.id+nOffset,face.a.id+nOffset,face.c.id+nOffset)}else for(f=0;f<flen;f++)face=this.faces[f],obj.face(face.b.id+vOffset,face.a.id+vOffset,face.c.id+vOffset)},saveAsSTL:function(a,b,c){console.log("TriangleMesh.saveAsSTL() currently not implemented")},scale:function(scale){return this.transform(this.matrix.identity().scaleSelf(scale))},setName:function(name){return this.name=name,this},toString:function(){return"TriangleMesh: "+this.name+" vertices: "+this.getNumVertices()+" faces: "+this.getNumFaces()},toWEMesh:function(){console.log("TriangleMesh.toWEMesh() currently not implemented")},transform:function(mat,updateNormals){updateNormals===undefined&&(updateNormals=!0);var l=this.vertices.length;for(var i=0;i<l;i++){var v=this.vertices[i];v.set(mat.applyTo(v))}return updateNormals&&this.computeFaceNormals(),this},translate:function(x,y,z){return arguments.length==1&&(y=x.y,z=x.z,x=x.x),this.transform(this.matrix.identity().translateSelf(x,y,z))},updateVertex:function(orig,newPos){var vi=this.getVertexIndex(orig);return vi>-1&&(this.vertices.splice(v,1),this.vertices[vi].set(newPos),this.vertices.push(v)),this}},module.exports=TriangleMesh}),define("toxi/geom/AABB",["require","exports","module","../internals","./Vec3D","./Vec2D","./mesh/TriangleMesh","../math/mathUtils"],function(require,exports,module){var internals=require("../internals"),Vec3D=require("./Vec3D"),Vec2D=require("./Vec2D"),TriangleMesh=require("./mesh/TriangleMesh"),mathUtils=require("../math/mathUtils"),AABB=function(a,b){var vec,extent;a===undefined?(Vec3D.call(this),this.setExtent(new Vec3D)):typeof a=="number"?(Vec3D.call(this,new Vec3D),this.setExtent(a)):internals.tests.hasXYZ(a)&&(Vec3D.call(this,a),b===undefined&&internals.tests.isAABB(a)?this.setExtent(a.getExtent()):typeof b=="number"?this.setExtent(new Vec3D(b,b,b)):this.setExtent(b))};internals.extend(AABB,Vec3D),AABB.fromMinMax=function(min,max){var a=Vec3D.min(min,max),b=Vec3D.max(min,max);return new AABB(a.interpolateTo(b,.5),b.sub(a).scaleSelf(.5))},AABB.prototype.containsPoint=function(p){return p.isInAABB(this)},AABB.prototype.copy=function(){return new AABB(this)},AABB.prototype.getExtent=function(){return this.extent.copy()},AABB.prototype.getMax=function(){return this.max.copy()},AABB.prototype.getMin=function(){return this.min.copy()},AABB.prototype.getNormalForPoint=function(p){p=p.sub(this);var pabs=this.extent.sub(p.getAbs()),psign=p.getSignum(),normal=Vec3D.X_AXIS.scale(psign.x),minDist=pabs.x;return pabs.y<minDist&&(minDist=pabs.y,normal=Vec3D.Y_AXIS.scale(psign.y)),pabs.z<minDist&&(normal=Vec3D.Z_AXIS.scale(psign.z)),normal},AABB.prototype.includePoint=function(p){return this.min.minSelf(p),this.max.maxSelf(p),this.set(this.min.interpolateTo(this.max,.5)),this.extent.set(this.max.sub(this.min).scaleSelf(.5)),this},AABB.prototype.intersectsBox=function(box){var t=box.sub(this);return Math.abs(t.x)<=this.extent.x+box.extent.x&&Math.abs(t.y)<=this.extent.y+box.extent.y&&Math.abs(t.z)<=this.extent.z+box.extent.z},AABB.prototype.intersectsRay=function(ray,minDist,maxDist){var invDir=ray.getDirection().reciprocal(),signDirX=invDir.x<0,signDirY=invDir.y<0,signDirZ=invDir.z<0,bbox=signDirX?this.max:this.min,tmin=(bbox.x-ray.x)*invDir.x;bbox=signDirX?this.min:this.max;var tmax=(bbox.x-ray.x)*invDir.x;bbox=signDirY?this.max:this.min;var tymin=(bbox.y-ray.y)*invDir.y;bbox=signDirY?this.min:this.max;var tymax=(bbox.y-ray.y)*invDir.y;if(tmin>tymax||tymin>tmax)return null;tymin>tmin&&(tmin=tymin),tymax<tmax&&(tmax=tymax),bbox=signDirZ?max:min;var tzmin=(bbox.z-ray.z)*invDir.z;bbox=signDirZ?min:max;var tzmax=(bbox.z-ray.z)*invDir.z;return tmin>tzmax||tzmin>tmax?null:(tzmin>tmin&&(tmin=tzmin),tzmax<tmax&&(tmax=tzmax),tmin<maxDist&&tmax>minDist?ray.getPointAtDistance(tmin):undefined)},AABB.prototype.intersectsSphere=function(c,r){arguments.length==1&&(r=c.radius);var s,d=0;return c.x<this.min.x?(s=c.x-this.min.x,d=s*s):c.x>this.max.x&&(s=c.x-this.max.x,d+=s*s),c.y<this.min.y?(s=c.y-this.min.y,d+=s*s):c.y>this.max.y&&(s=c.y-this.max.y,d+=s*s),c.z<this.min.z?(s=c.z-this.min.z,d+=s*s):c.z>this.max.z&&(s=c.z-this.max.z,d+=s*s),d<=r*r},AABB.prototype.intersectsTriangle=function(tri){var v0,v1,v2,normal,e0,e1,e2,f;v0=tri.a.sub(this),v1=tri.b.sub(this),v2=tri.c.sub(this),e0=v1.sub(v0),e1=v2.sub(v1),e2=v0.sub(v2),f=e0.getAbs();if(this.testAxis(e0.z,-e0.y,f.z,f.y,v0.y,v0.z,v2.y,v2.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-e0.z,e0.x,f.z,f.x,v0.x,v0.z,v2.x,v2.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(e0.y,-e0.x,f.y,f.x,v1.x,v1.y,v2.x,v2.y,this.extent.x,this.extent.y))return!1;f=e1.getAbs();if(this.testAxis(e1.z,-e1.y,f.z,f.y,v0.y,v0.z,v2.y,v2.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-e1.z,e1.x,f.z,f.x,v0.x,v0.z,v2.x,v2.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(e1.y,-e1.x,f.y,f.x,v0.x,v0.y,v1.x,v1.y,this.extent.x,this.extent.y))return!1;f=e2.getAbs();if(this.testAxis(e2.z,-e2.y,f.z,f.y,v0.y,v0.z,v1.y,v1.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-e2.z,e2.x,f.z,f.x,v0.x,v0.z,v1.x,v1.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(e2.y,-e2.x,f.y,f.x,v1.x,v1.y,v2.x,v2.y,this.extent.x,this.extent.y))return!1;if(mathUtils.min(v0.x,v1.x,v2.x)>this.extent.x||mathUtils.max(v0.x,v1.x,v2.x)<-this.extent.x)return!1;if(mathUtils.min(v0.y,v1.y,v2.y)>this.extent.y||mathUtils.max(v0.y,v1.y,v2.y)<-this.extent.y)return!1;if(mathUtils.min(v0.z,v1.z,v2.z)>this.extent.z||mathUtils.max(v0.z,v1.z,v2.z)<-this.extent.z)return!1;normal=e0.cross(e1);var d=-normal.dot(v0);return this.planeBoxOverlap(normal,d,extent)?!0:!1},AABB.prototype.planeBoxOverlap=function(normal,d,maxbox){var vmin=new Vec3D,vmax=new Vec3D;return normal.x>0?(vmin.x=-maxbox.x,vmax.x=maxbox.x):(vmin.x=maxbox.x,vmax.x=-maxbox.x),normal.y>0?(vmin.y=-maxbox.y,vmax.y=maxbox.y):(vmin.y=maxbox.y,vmax.y=-maxbox.y),normal.z>0?(vmin.z=-maxbox.z,vmax.z=maxbox.z):(vmin.z=maxbox.z,vmax.z=-maxbox.z),normal.dot(vmin)+d>0?!1:normal.dot(vmax)+d>=0?!0:!1},AABB.prototype.set=function(a,b,c){return internals.tests.isAABB(a)?(this.extent.set(a.extent),Vec3D.set.apply(this,[a])):(internals.tests.hasXYZ(a)&&(b=a.y,c=a.z,a=a.a),this.x=a,this.y=b,this.z=c,this.updateBounds(),this)},AABB.prototype.setExtent=function(extent){return this.extent=extent.copy(),this.updateBounds()},AABB.prototype.testAxis=function(a,b,fa,fb,va,vb,wa,wb,ea,eb){var p0=a*va+b*vb,p2=a*wa+b*wb,min,max;p0<p2?(min=p0,max=p2):(min=p2,max=p0);var rad=fa*ea+fb*eb;return min>rad||max<-rad},AABB.prototype.toMesh=function(mesh){mesh===undefined&&(mesh=new TriangleMesh("aabb",8,12));var a=this.min,g=this.max,b=new Vec3D(a.x,a.y,g.z),c=new Vec3D(g.x,a.y,g.z),d=new Vec3D(g.x,a.y,a.z),e=new Vec3D(a.x,g.y,a.z),f=new Vec3D(a.x,g.y,g.z),h=new Vec3D(g.x,g.y,a.z),ua=new Vec2D(0,0),ub=new Vec2D(1,0),uc=new Vec2D(1,1),ud=new Vec2D(0,1);return mesh.addFace(a,b,f,ud,uc,ub),mesh.addFace(a,f,e,ud,ub,ua),mesh.addFace(b,c,g,ud,uc,ub),mesh.addFace(b,g,f,ud,ub,ua),mesh.addFace(c,d,h,ud,uc,ub),mesh.addFace(c,h,g,ud,ub,ua),mesh.addFace(d,a,e,ud,uc,ub),mesh.addFace(d,e,h,ud,ub,ua),mesh.addFace(e,f,h,ua,ud,ub),mesh.addFace(f,g,h,ud,uc,ub),mesh.addFace(a,d,b,ud,uc,ua),mesh.addFace(b,d,c,ua,uc,ub),mesh},AABB.prototype.toString=function(){return"<aabb> pos: "+this.parent.toString()+" ext: "+this.extent.toString()},AABB.prototype.updateBounds=function(){return this.extent!==undefined&&(this.min=this.sub(this.extent),this.max=this.add(this.extent)),this},module.exports=AABB}),define("toxi/geom/BernsteinPolynomial",["require","exports","module"],function(require,exports,module){var BernsteinPolynomial=function(res){this.resolution=res;var b0=new Array(res),b1=new Array(res),b2=new Array(res),b3=new Array(res),t=0,dt=1/(res-1);for(var i=0;i<res;i++){var t1=1-t,t12=t1*t1,t2=t*t;b0[i]=t1*t12,b1[i]=3*t*t12,b2[i]=3*t2*t1,b3[i]=t*t2,t+=dt}this.b0=b0,this.b1=b1,this.b2=b2,this.b3=b3};module.exports=BernsteinPolynomial}),define("toxi/geom/Ray2D",["require","exports","module","../internals","./Vec2D","./Line2D"],function(require,exports,module){var extend=require("../internals").extend,Vec2D=require("./Vec2D"),Line2D=require("./Line2D"),Ray2D=function(a,b,d){var o,dir;arguments.length==3?(Vec2D.apply(this,[a,b]),this.dir=d.getNormalized()):arguments.length==2?(Vec2D.apply(this,[a]),this.dir=b.getNormalized()):arguments.length===0&&(Vec2D.apply(this),this.dir=Vec2D.Y_AXIS.copy())};extend(Ray2D,Vec2D),Ray2D.prototype.getDirection=function(){return this.dir.copy()},Ray2D.prototype.getDistanceToPoint=function(p){var sp=p.sub(this);return sp.distanceTo(this.dir.scale(sp.dot(this.dir)))},Ray2D.prototype.getPointAtDistance=function(dist){return this.add(this.dir.scale(dist))},Ray2D.prototype.setDirection=function(d){return this.dir.set(d).normalize(),this},Ray2D.prototype.toLine2DWithPointAtDistance=function(dist){return new Line2D(this,this.getPointAtDistance(dist))},Ray2D.prototype.toString=function(){return"origin: "+Vec2D.prototype.toString.apply(this)+" dir: "+this.dir},module.exports=Ray2D}),define("toxi/geom/Line2D",["require","exports","module","./Ray2D","../internals"],function(require,exports,module){var Ray2D=require("./Ray2D"),internals=require("../internals"),Line2D=function(a,b){this.a=a,this.b=b};Line2D.prototype={closestPointTo:function(p){var v=this.b.sub(this.a),t=p.sub(this.a).dot(v)/v.magSquared();return t<0?this.a.copy():t>1?this.b.copy():this.a.add(v.scaleSelf(t))},copy:function(){return new Line2D(this.a.copy(),this.b.copy())},equals:function(obj){if(this==obj)return!0;if(!internals.tests.isLine2D(obj))return!1;var l=obj;return(this.a.equals(l.a)||this.a.equals(l.b))&&(this.b.equals(l.b)||this.b.equals(l.a))},getDirection:function(){return this.b.sub(this.a).normalize()},getLength:function(){return this.a.distanceTo(this.b)},getLengthSquared:function(){return this.a.distanceToSquared(this.b)},getMidPoint:function(){return this.a.add(this.b).scaleSelf(.5)},getNormal:function(){return this.b.sub(this.a).perpendicular()},getTheta:function(){return this.a.angleBetween(this.b,!0)},hasEndPoint:function(p){return this.a.equals(p)||this.b.equals(p)},intersectLine:function(l){var isec,denom=(l.b.y-l.a.y)*(this.b.x-this.a.x)-(l.b.x-l.a.x)*(this.b.y-this.a.y),na=(l.b.x-l.a.x)*(this.a.y-l.a.y)-(l.b.y-l.a.y)*(this.a.x-l.a.x),nb=(this.b.x-this.a.x)*(this.a.y-l.a.y)-(this.b.y-this.a.y)*(this.a.x-l.a.x);if(denom!==0){var ua=na/denom,ub=nb/denom;ua>=0&&ua<=1&&ub>=0&&ub<=1?isec=new Line2D.LineIntersection(Line2D.LineIntersection.Type.INTERSECTING,this.a.interpolateTo(this.b,ua)):isec=new Line2D.LineIntersection(Line2D.LineIntersection.Type.NON_INTERSECTING,undefined)}else na===0&&nb===0?isec=new Line2D.LineIntersection(Line2D.LineIntersection.Type.COINCIDENT,undefined):isec=new Line2D.LineIntersection(Line2D.LineIntersection.Type.COINCIDENT,undefined);return isec},offsetAndGrowBy:function(offset,scale,ref){var m=this.getMidPoint(),d=this.getDirection(),n=d.getPerpendicular();return ref!==undefined&&m.sub(ref).dot(n)<0&&n.invert(),n.normalizeTo(offset),this.a.addSelf(n),this.b.addSelf(n),d.scaleSelf(scale),this.a.subSelf(d),this.b.addSelf(d),this},scale:function(scale){var delta=(1-scale)*.5,newA=this.a.interpolateTo(this.b,delta);return this.b.interpolateToSelf(this.a,delta),this.a.set(newA),this},set:function(a,b){return this.a=a,this.b=b,this},splitIntoSegments:function(segments,stepLength,addFirst){return Line2D.splitIntoSegments(this.a,this.b,stepLength,segments,addFirst)},toRay2D:function(){return new Ray2D(this.a.copy(),this.b.sub(this.a).normalize())}},Line2D.splitIntoSegments=function(a,b,stepLength,segments,addFirst){segments===undefined&&(segments=[]),addFirst&&segments.push(a.copy());var dist=a.distanceTo(b);if(dist>stepLength){var pos=a.copy(),step=b.sub(a).limit(stepLength);while(dist>stepLength)pos.addSelf(step),segments.push(pos.copy()),dist-=stepLength}return segments.push(b.copy()),segments},Line2D.LineIntersection=function(type,pos){this.type=type,this.pos=pos},Line2D.LineIntersection.prototype={getPos:function(){return this.pos.copy()},getType:function(){return this.type},toString:function(){return"type: "+this.type+" pos: "+this.pos}},Line2D.LineIntersection.Type={COINCIDENT:0,PARALLEL:1,NON_INTERSECTING:2,INTERSECTING:3},module.exports=Line2D}),define("toxi/geom/Rect",["require","exports","module","../math/mathUtils","./Vec2D","./Line2D","./Polygon2D","../internals"],function(require,exports,module){var internals=require("../internals"),mathUtils=require("../math/mathUtils"),Vec2D=require("./Vec2D"),Line2D=require("./Line2D"),Polygon2D=require("./Polygon2D"),Rect=function(a,b,width,height){if(arguments.length==2){if(!internals.tests.hasXY(a))throw new Error("Rect received incorrect parameters");this.x=a.x,this.y=a.y,this.width=b.x-this.x,this.height=b.y-this.y}else if(arguments.length==4)this.x=a,this.y=b,this.width=width,this.height=height;else if(arguments.length==1){var o=arguments[0];internals.tests.hasXYWidthHeight(o)&&(this.x=o.x,this.y=o.y,this.width=o.width,this.height=o.height)}else if(arguments.length>0)throw new Error("Rect received incorrect parameters")};Rect.fromCenterExtent=function(center,extent){return new Rect(center.sub(extent),center.add(extent))},Rect.prototype={containsPoint:function(p){var px=p.x,py=p.y;return px<this.x||px>=this.x+this.width?!1:py<this.y||py>=this.y+this.height?!1:!0},copy:function(){return new Rect(this.x,this.y,this.width,this.height)},getArea:function(){return this.width*this.height},getAspect:function(){return this.width/this.height},getBottom:function(){return this.y+this.height},getBottomRight:function(){return new Vec2D(this.x+this.width,this.y+this.height)},getCentroid:function(){return new Vec2D(this.x+this.width*.5,this.y+this.height*.5)},getDimensions:function(){return new Vec2D(this.width,this.height)},getEdge:function(id){var edge;switch(id){case 0:edge=new Line2D(new Vec2D(this.x,this.y),new Vec2D(this.x+this.width,this.y));break;case 1:edge=new Line2D(new Vec2D(this.x+this.width,this.y),new Vec2D(this.x+this.width,this.y+this.height));break;case 2:edge=new Line2D(new Vec2D(this.x,this.y+this.height),new Vec2D(this.x+this.width,this.y+this.height));break;case 3:edge=new Line2D(new Vec2D(this.x,this.y),new Vec2D(this.x,this.y+this.height));break;default:throw new Error("edge ID needs to be 0...3")}return edge},getLeft:function(){return this.x},getRight:function(){return this.x+this.width},getTop:function(){return this.y},getTopLeft:function(){return new Vec2D(this.x,this.y)},intersectsRay:function(ray,minDist,maxDist){var invDir=ray.getDirection().reciprocal(),signDirX=invDir.x<0,signDirY=invDir.y<0,min=this.getTopLeft(),max=this.getBottomRight(),bbox=signDirX?max:min,tmin=(bbox.x-ray.x)*invDir.x;bbox=signDirX?min:max;var tmax=(bbox.x-ray.x)*invDir.x;bbox=signDirY?max:min;var tymin=(bbox.y-ray.y)*invDir.y;bbox=signDirY?min:max;var tymax=(bbox.y-ray.y)*invDir.y;return tmin>tymax||tymin>tmax?undefined:(tymin>tmin&&(tmin=tymin),tymax<tmax&&(tmax=tymax),tmin<maxDist&&tmax>minDist?ray.getPointAtDistance(tmin):undefined)},intersectsRect:function(r){return!(this.x>r.x+r.width||this.x+this.width<r.x||this.y>r.y+r.height||this.y+this.height<r.y)},scale:function(s){var c=this.getCentroid();return this.width*=s,this.height*=s,this.x=c.x-this.width*.5,this.y=c.y-this.height*.5,this},set:function(x,y,width,height){if(arguments.length==-1)this.y=x.y,this.width=x.width,this.height=x.height,this.x=x.x;else{if(arguments.length!==4)throw new Error("Rect set() received wrong parameters");this.x=x,this.y=y,this.width=width,this.height=height}},setDimensions:function(dim){return this.width=dim.x,this.height=dim.y,this},setPosition:function(pos){return this.x=pos.x,this.y=pos.y,this},toPolygon2D:function(){var poly=new Polygon2D;return poly.add(new Vec2D(this.x,this.y)),poly.add(new Vec2D(this.x+this.width,this.y)),poly.add(new Vec2D(this.x+this.width,this.y+this.height)),poly.add(new Vec2D(this.x,this.y+this.height)),poly},toString:function(){return"rect: {x: "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height+"}"},union:function(r){var tmp=mathUtils.max(this.x+this.width,r.x+r.width);return this.x=mathUtils.min(this.x,r.x),this.width=tmp-this.x,tmp=mathUtils.max(this.y+this.height,r.y+r.height),this.y=mathUtils.min(this.y,r.y),this.height=tmp-this.y,this}},module.exports=Rect}),define("toxi/geom/Triangle2D",["require","exports","module","./Vec2D","./Line2D","./Rect","./Circle","./Polygon2D","../math/mathUtils"],function(require,exports,module){var Vec2D=require("./Vec2D"),Line2D=require("./Line2D"),Rect=require("./Rect"),Circle=require("./Circle"),Polygon2D=require("./Polygon2D"),mathUtils=require("../math/mathUtils"),Triangle2D=function(_a,_b,_c){arguments.length===3&&(this.a=_a.copy(),this.b=_b.copy(),this.c=_c.copy())};Triangle2D.createEquilateralFrom=function(a,b){var c=a.interpolateTo(b,.5),dir=a.sub(b),n=dir.getPerpendicular();return c.addSelf(n.normalizeTo(dir.magnitude()*mathUtils.SQRT3/2)),new Triangle2D(a,b,c)},Triangle2D.isClockwise=function(a,b,c){var determ=(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y);return determ<0},Triangle2D.prototype={adjustTriangleSizeBy:function(offAB,offBC,offCA){arguments.length==1&&(offBC=offAB,offCA=offAB),this.computeCentroid();var ab=(new Line2D(this.a.copy(),this.b.copy())).offsetAndGrowBy(offAB,1e5,this.centroid),bc=(new Line2D(this.b.copy(),this.c.copy())).offsetAndGrowBy(offBC,1e5,this.centroid),ca=(new Line2D(this.c.copy(),this.a.copy())).offsetAndGrowBy(offCA,1e5,this.centroid);return this.a=ab.intersectLine(ca).getPos(),this.b=ab.intersectLine(bc).getPos(),this.c=bc.intersectLine(ca).getPos(),this.computeCentroid(),this},computeCentroid:function(){return this.centroid=this.a.add(this.b).addSelf(this.c).scaleSelf(1/3),this.centroid},containsPoint:function(_p){var v1=_p.sub(this.a).normalize(),v2=_p.sub(this.b).normalize(),v3=_p.sub(this.c).normalize(),totalAngles=Math.acos(v1.dot(v2));return totalAngles+=Math.acos(v2.dot(v3)),totalAngles+=Math.acos(v3.dot(v1)),mathUtils.abs(totalAngles-mathUtils.TWO_PI)<=.01},copy:function(){return new Triangle2D(this.a.copy(),this.b.copy(),this.c.copy())},flipVertexOrder:function(){var t=this.a;return this.a=this.c,this.c=t,this},getArea:function(){return this.b.sub(this.a).cross(this.c.sub(this.a))*.5},getBounds:function(){return new Rect(Vec2D.min(Vec2D.min(a,b),c),Vec2D.max(Vec2D.max(a,b),c))},getCircumCircle:function(){var cr=this.a.bisect(this.b).cross(this.b.bisect(this.c)),circa=new Vec2D(cr.x/cr.z,cr.y/cr.z),sa=this.a.distanceTo(this.b),sb=this.b.distanceTo(this.c),sc=this.c.distanceTo(this.a),radius=sa*sb*sc/Math.sqrt((sa+sb+sc)*(-sa+sb+sc)*(sa-sb+sc)*(sa+sb-sc));return new Circle(circa,radius)},getCircumference:function(){return this.a.distanceTo(this.b)+this.b.distanceTo(this.c)+this.c.distanceTo(this.a)},getClosestPointTo:function(_p){var edge=new Line2D(this.a,this.b),Rab=edge.closestPointTo(_p),Rbc=edge.set(this.b,this.c).closestPointTo(_p),Rca=edge.set(this.c,this.a).closestPointTo(_p),dAB=_p.sub(Rab).magSquared(),dBC=_p.sub(Rbc).magSquared(),dCA=_p.sub(Rca).magSquared(),min=dAB,result=Rab;return dBC<min&&(min=dBC,result=Rbc),dCA<min&&(result=Rca),result},intersectsTriangle:function(tri){if(this.containsPoint(tri.a)||this.containsPoint(tri.b)||this.containsPoint(tri.c))return!0;if(tri.containsPoint(this.a)||tri.containsPoint(this.b)||tri.containsPoint(this.c))return!0;var ea=[new Line2D(this.a,this.b),new Line2D(this.b,this.c),new Line2D(this.c,this.a)],eb=[new Line2D(tri.a,tri.b),new Line2D(tri.b,tri.c),new Line2D(tri.c,tri.a)];for(var i=0,eaLen=ea.length;i<eaLen;i++){var la=ea[i];for(var j=0,ebLen=eb.length;j<ebLen;j++){var lb=eb[j],type=la.intersectLine(lb).getType();if(type!=Line2D.LineIntersection.Type.NON_INTERSECTING&&type!=Line2D.LineIntersection.Type.PARALLEL)return!0}}return!1},isClockwise:function(){return Triangle2D.isClockwise(this.a,this.b,this.c)},set:function(a2,b2,c2){this.a=a2,this.b=b2,this.c=c2},toPolygon2D:function(){var poly=new Polygon2D;return poly.add(this.a.copy()),poly.add(this.b.copy()),poly.add(this.c.copy()),poly},toString:function(){return"Triangle2D: "+this.a+","+this.b+","+this.c}},module.exports=Triangle2D}),define("toxi/geom/Polygon2D",["require","exports","module","./Vec2D","./Line2D","./Triangle2D","../internals"],function(require,exports,module){var internals=require("../internals"),Vec2D=require("./Vec2D"),Line2D=require("./Line2D"),Triangle2D=require("./Triangle2D"),Polygon2D=function(){this.vertices=[];var i,l;if(arguments.length>1)for(i=0,l=arguments.length;i<l;i++)this.add(arguments[i].copy());else if(arguments.length==1){var arg=arguments[0];if(internals.tests.isArray(arg))for(i=0,l=arg.length;i<l;i++)this.add(arg[i].copy())}};Polygon2D.prototype={add:function(p){this.vertices.indexOf(p)<0&&this.vertices.push(p)},containsPoint:function(p){var num=this.vertices.length,i=0,j=num-1,oddNodes=!1,px=p.x,py=p.y;for(i=0;i<num;i++){var vi=this.vertices[i],vj=this.vertices[j];(vi.y<py&&vj.y>=py||vj.y<py&&vi.y>=py)&&vi.x+(py-vi.y)/(vj.y-vi.y)*(vj.x-vi.x)<px&&(oddNodes=!oddNodes),j=i}return oddNodes},containsPoly:function(poly){for(var i=0,num=poly.vertices.length;i<num;i++)if(!this.containsPoint(poly.vertices[i]))return!1;return!0},flipVertexOrder:function(){return this.vertices.reverse(),this},getArea:function(){var area=0,numPoints=this.vertices.length;for(var i=0;i<numPoints;i++){var a=this.vertices[i],b=this.vertices[(i+1)%numPoints];area+=a.x*b.y,area-=a.y*b.x}return area*=.5,area},getCentroid:function(){var res=new Vec2D,numPoints=this.vertices.length;for(var i=0;i<numPoints;i++){var a=this.vertices[i],b=this.vertices[(i+1)%numPoints],factor=a.x*b.y-b.x*a.y;res.x+=(a.x+b.x)*factor,res.y+=(a.y+b.y)*factor}return res.scale(1/(this.getArea()*6))},getCircumference:function(){var circ=0;for(var i=0,num=this.vertices.length;i<num;i++)circ+=this.vertices[i].distanceTo(this.vertices[(i+1)%num]);return circ},getEdges:function(){var num=this.vertices.length,edges=[];for(var i=0;i<num;i++)edges[i]=new Line2D(this.vertices[i],this.vertices[(i+1)%num]);return edges},getNumPoints:function(){return this.vertices.length},isClockwise:function(){return this.vertices.length>2?Triangle2D.isClockwise(this.vertices[0],this.vertices[1],this.vertices[2]):!1},intersectsPoly:function(poly){if(!this.containsPoly(poly)){var edges=this.getEdges(),pedges=poly.getEdges();for(var i=0,n=edges.length;i<n;i++)for(var j=0,m=pedges.length,e=edges[i];j<m;j++)if(e.intersectLine(pedges[j]).getType()==Line2D.LineIntersection.Type.INTERSECTING)return!0;return!1}return!0},rotate:function(theta){for(var i=0,num=this.vertices.length;i<num;i++)this.vertices[i].rotate(theta)},scale:function(){var x,y;if(arguments.length==1){var arg=arguments[0];internals.tests.hasXY(arg)?(x=arg.x,y=arg.y):(x=arg,y=arg)}else{if(arguments.length!=2)throw"Invalid argument(s) passed.";x=arguments[0],y=arguments[1]}for(var i=0,num=this.vertices.length;i<num;i++)this.vertices[i].scaleSelf(x,y);return this},translate:function(){var x,y;if(arguments.length==1&&internals.tests.hasXY(arguments[0]))x=arg.x,y=arg.y;else{if(arguments.length!=2)throw"Invalid argument(s) passed.";x=arguments[0],y=arguments[1]}for(var i=0,num=this.vertices.length;i<num;i++)this.vertices[i].addSelf(x,y);return this},smooth:function(amount,baseWeight){var centroid=this.getCentroid(),num=this.vertices.length,filtered=[];for(var i=0,j=num-1,k=1;i<num;i++){var a=this.vertices[i],dir=this.vertices[j].sub(a).addSelf(this.vertices[k].sub(a)).addSelf(a.sub(centroid).scaleSelf(baseWeight));filtered.push(a.add(dir.scaleSelf(amount))),j++,j==num&&(j=0),k++,k==num&&(k=0)}return this.vertices=filtered,this},toString:function(){var s="";for(var i=0;i<this.vertices.length;i++)s+=this.vertices[i],i<this.vertices.length-1&&(s+=", ");return s}},module.exports=Polygon2D}),define("toxi/geom/Ellipse",["require","exports","module","../internals","../math/mathUtils","./Vec2D","./Polygon2D"],function(require,exports,module){var internals=require("../internals"),mathUtils=require("../math/mathUtils"),Vec2D=require("./Vec2D"),Polygon2D=require("./Polygon2D"),Ellipse=function(a,b,c,d){this.radius=new Vec2D,arguments.length===0?(Vec2D.apply(this,[0,0]),this.setRadii(1,1)):internals.tests.hasXY(a)?(Vec2D.apply(this,[a.x,a.y]),internals.tests.hasXY(b)?this.setRadii(b.x,b.y):this.setRadii(b,c)):d===undefined?c===undefined?(Vec2D.apply(this,[0,0]),this.setRadii(a,b)):(Vec2D.apply(this,[a,b]),this.setRadii(c,c)):(console.log("yup"),Vec2D.apply(this,[a,b]),this.setRadii(c,d))};internals.extend(Ellipse,Vec2D),Ellipse.prototype.containsPoint=function(p){var foci=this.getFoci();return p.distanceTo(foci[0])+p.distanceTo(foci[1])<2*mathUtils.max(this.radius.x,this.radius.y)},Ellipse.prototype.getArea=function(){return mathUtils.PI*radius.x*radius.y},Ellipse.prototype.getCircumference=function(){return Math.sqrt(.5*this.radius.magSquared())*mathUtils.TWO_PI},Ellipse.prototype.getFoci=function(){var foci=[];return this.radius.x>this.radius.y?(foci[0]=this.sub(this.focus,0),foci[1]=this.add(this.focus,0)):(foci[0]=this.sub(0,this.focus),foci[1]=this.add(0,this.focus)),foci},Ellipse.prototype.getRadii=function(){return this.radius.copy()},Ellipse.prototype.setRadii=function(rx,ry){return internals.tests.hasXY(rx)&&(ry=rx.y,rx=rx.x),this.radius.set(rx,ry),this.focus=this.radius.magnitude(),this},Ellipse.prototype.toPolygon2D=function(res){var poly=new Polygon2D,step=mathUtils.TWO_PI/res;for(var i=0;i<res;i++){var v=Vec2D.fromTheta(i*step).scaleSelf(this.radius).addSelf(this);poly.add(v)}return poly},module.exports=Ellipse}),define("toxi/geom/Circle",["require","exports","module","../internals","../math/mathUtils","./Vec2D","./Ellipse"],function(require,exports,module){var internals=require("../internals"),mathUtils=require("../math/mathUtils"),Vec2D=require("./Vec2D"),Ellipse=require("./Ellipse"),Circle=function(a,b,c){arguments.length==1?internals.tests.isCircle(a)?Ellipse.apply(this,[a,a.radius.x]):Ellipse.apply(this,[0,0,a]):arguments.length==2?Ellipse.apply(this,[a,b]):Ellipse.apply(this,[a,b,c,c])};internals.extend(Circle,Ellipse),Circle.from2Points=function(p1,p2){var m=p1.interpolateTo(p2,.5),distanceTo=m.distanceTo(p1);return new Circle(m,distanceTo)},Circle.from3Points=function(p1,p2,p3){var circle,deltaA=p2.sub(p1),deltaB=p3.sub(p2),centroid,radius;if(mathUtils.abs(deltaA.x)<=1e-7&&mathUtils.abs(deltaB.y)<=1e-7)centroid=(new Vec2D(p2.x+p3.x,p1.y+p2.y)).scaleSelf(.5),radius=centroid.distanceTo(p1),circle=new Circle(centroid,radius);else{var aSlope=deltaA.y/deltaA.x,bSlope=deltaB.y/deltaB.x;if(mathUtils.abs(aSlope-bSlope)>1e-7&&aSlope!==0){var x=(aSlope*bSlope*(p1.y-p3.y)+bSlope*(p1.x+p2.x)-aSlope*(p2.x+p3.x))/(2*(bSlope-aSlope)),y=-(x-(p1.x+p2.x)/2)/aSlope+(p1.y+p2.y)/2;centroid=new Vec2D(x,y),radius=centroid.distanceTo(p1),circle=new Circle(centroid,radius)}}return circle},Circle.prototype.containsPoint=function(p){return this.distanceToSquared(p)<=this.radius.x*this.radius.x},Circle.prototype.getCircumference=function(){return mathUtils.TWO_PI*this.radius.x},Circle.prototype.getRadius=function(){return this.radius.x},Circle.prototype.getTangentPoints=function(p){var m=this.interpolateTo(p,.5);return this.intersectsCircle(new Circle(m,m.distanceTo(p)))},Circle.prototype.intersectsCircle=function(c){var res,delta=c.sub(this),d=delta.magnitude(),r1=this.radius.x,r2=c.radius.x;if(d<=r1+r2&&d>=Math.abs(r1-r2)){var a=(r1*r1-r2*r2+d*d)/(2*d);d=1/d;var p=this.add(delta.scale(a*d)),h=Math.sqrt(r1*r1-a*a);delta.perpendicular().scaleSelf(h*d);var i1=p.add(delta),i2=p.sub(delta);res=[i1,i2]}return res},Circle.prototype.setRadius=function(r){return this.setRadii(r,r),this},module.exports=Circle}),define("toxi/geom/CircleIntersector",["require","exports","module"],function(require,exports,module){var CircleIntersector=function(circle){this.circle=circle,this.isec=undefined};CircleIntersector.prototype={getIntersectionData:function(){return this.isec},intersectsRay:function(ray){this.isec.clear();var q=circle.sub(ray),distSquared=q.magSquared(),v=q.dot(ray.getDirection()),r=circle.getRadius(),d=r*r-(distSquared-v*v);return d>=0&&(this.isec.isIntersection=!0,this.isec.dist=v-Math.sqrt(d),this.isec.pos=ray.getPointAtDistance(isec.dist),this.isec.normal=this.isec.pos.sub(this.circle).normalize()),this.isec.isIntersection}},module.exports=CircleIntersector}),define("toxi/geom/Cone",["require","exports","module","../internals","./Vec3D","./mesh/TriangleMesh"],function(require,exports,module){var extend=require("../internals").extend,Vec3D=require("./Vec3D"),TriangleMesh=require("./mesh/TriangleMesh"),Cone=function(pos,dir,rNorth,rSouth,len){Vec3D.apply(this,[pos]),this.dir=dir.getNormalized(),this.radiusNorth=rNorth,this.radiusSouth=rSouth,this.length=len};extend(Cone,Vec3D),Cone.prototype.toMesh=function(args){var opts={mesh:undefined,steps:NaN,thetaOffset:0,topClosed:!0,bottomClosed:!0};if(arguments.length==1)if(typeof arguments[0]=="object"){var optionsObject=arguments[0];opts.mesh=optionsObject.mesh,opts.steps=optionsObject.steps||optionsObject.resolution||optionsObject.res,opts.thetaOffset=optionsObject.thetaOffset||opts.thetaOffset,opts.topClosed=optionsObject.topClosed||opts.topClosed,opts.bottomClosed=optionsObject.bottomClosed||opts.bottomClosed}else opts.steps=arguments[0];else arguments.length==2?(opts.steps=arguments[0],opts.thetaOffset=arguments[1]):arguments.length==5&&(opts.mesh=arguments[0],opts.steps=arguments[1],opts.thetaOffset=arguments[2],opts.topClosed=arguments[3],opts.bottomClosed=arguments[4]);var c=this.add(.01,.01,.01),n=c.cross(this.dir.getNormalized()).normalize(),halfAxis=this.dir.scale(this.length*.5),p=this.sub(halfAxis),q=this.add(halfAxis),south=[],north=[],phi=Math.PI*2/opts.steps,i=0;for(i=0;i<opts.steps;i++){var theta=i*phi+opts.thetaOffset,nr=n.getRotatedAroundAxis(this.dir,theta);south[i]=nr.scale(this.radiusSouth).addSelf(p),north[i]=nr.scale(this.radiusNorth).addSelf(q)}var numV=opts.steps*2+2,numF=opts.steps*2+(opts.topClosed?opts.steps:0)+(opts.bottomClosed?opts.steps:0),mesh=opts.mesh||new TriangleMesh("cone",numV,numF);for(i=0,j=1;i<opts.steps;i++,j++)j==opts.steps&&(j=0),mesh.addFace(south[i],north[i],south[j],undefined,undefined,undefined,undefined),mesh.addFace(south[j],north[i],north[j],undefined,undefined,undefined,undefined),opts.bottomClosed&&mesh.addFace(p,south[i],south[j],undefined,undefined,undefined,undefined),opts.topClosed&&mesh.addFace(north[i],q,north[j],undefined,undefined,undefined,undefined);return mesh},module.exports=Cone}),define("toxi/geom/IsectData2D",["require","exports","module","./Vec2D"],function(require,exports,module){var Vec2D=require("./Vec2D"),IsectData2D=function(isec){isec!==undefined?(this.isIntersection=isec.isIntersection,this.dist=isec.dist,this.pos=isec.pos.copy(),this.dir=isec.dir.copy(),this.normal=isec.normal.copy()):this.clear()};IsectData2D.prototype={clear:function(){this.isIntersection=!1,this.dist=0,this.pos=new Vec2D,this.dir=new Vec2D,this.normal=new Vec2D},toString:function(){var s="isec: "+this.isIntersection;return this.isIntersection&&(s+=" at:"+this.pos+" dist:"+this.dist+" normal:"+this.normal),s}},module.exports=IsectData2D}),define("toxi/geom/IsectData3D",["require","exports","module","./Vec3D"],function(require,exports,module){var Vec3D=require("./Vec3D"),IsectData3D=function(isec){isec!==undefined?(this.isIntersection=isec.isIntersection,this.dist=isec.dist,this.pos=isec.pos.copy(),this.dir=isec.dir.copy(),this.normal=isec.normal.copy()):this.clear()};IsectData3D.prototype={clear:function(){this.isIntersection=!1,this.dist=0,this.pos=new Vec3D,this.dir=new Vec3D,this.normal=new Vec3D},toString:function(){var s="isec: "+this.isIntersection;return this.isIntersection&&(s+=" at:"+this.pos+" dist:"+this.dist+" normal:"+this.normal),s}},module.exports=IsectData3D}),define("toxi/geom/Ray3D",["require","exports","module","../internals","./Vec3D","./Line3D"],function(require,exports,module){var extend=require("../internals").extend,Vec3D=require("./Vec3D"),Line3D=require("./Line3D"),Ray3D=function(a,b,c,d){var o,dir;arguments.length==4?(o=new Vec3D(a,b,c),dir=d):arguments.length==2?(o=a,dir=b):(o=new Vec3D,dir=Vec3D.Y_AXIS.copy()),Vec3D.apply(this,[o]),this.dir=dir};extend(Ray3D,Vec3D),Ray3D.prototype.getDirection=function(){return this.dir.copy()},Ray3D.prototype.getDistanceToPoint=function(p){var sp=p.sub(this);return sp.distanceTo(this.dir.scale(sp.dot(this.dir)))},Ray3D.prototype.getPointAtDistance=function(dist){return this.add(this.dir.scale(dist))},Ray3D.prototype.setDirection=function(d){return this.dir.set(d).normalize(),this},Ray3D.prototype.toLine3DWithPointAtDistance=function(dist){return new Line3D(this,this.getPointAtDistance(dist))},Ray3D.prototype.toString=function(){return"origin: "+this.parent.toString.call(this)+" dir: "+this.dir},module.exports=Ray3D}),define("toxi/geom/Plane",["require","exports","module","../internals","../math/mathUtils","./Ray3D","./Vec3D","./mesh/TriangleMesh"],function(require,exports,module){var extend=require("../internals").extend,mathUtils=require("../math/mathUtils"),Ray3D=require("./Ray3D"),Vec3D=require("./Vec3D"),TriangleMesh=require("./mesh/TriangleMesh"),Plane=function(tri_or_origin,norm){var origin,normal;arguments.length===0?(origin=new Vec3D,normal=Vec3D.Y_AXIS.copy()):arguments.length==1?(origin=arguments[0].computeCentroid(),normal=arguments[0].computeNormal()):(origin=arguments[0],normal=arguments[1].getNormalized()),Vec3D.apply(this,[origin]),this.normal=normal};extend(Plane,Vec3D),Plane.Classifier={FRONT:"front",BACK:"back",ON_PLANE:"on plane"},Plane.XY=new Plane(new Vec3D,Vec3D.Z_AXIS),Plane.XZ=new Plane(new Vec3D,Vec3D.Y_AXIS),Plane.YZ=new Plane(new Vec3D,Vec3D.X_AXIS),Plane.prototype.classifyPoint=function(p,tolerance){var d=this.sub(p).normalize().dot(this.normal);return d<-tolerance?Plane.Classifier.FRONT:d>tolerance?Plane.Classifier.BACK:Plane.Classifier.ON_PLANE},Plane.prototype.containsPoint=function(p){return this.classifyPoint(p,mathUtils.EPS)==Plane.Classifier.ON_PLANE},Plane.prototype.getDistanceToPoint=function(p){var sn=this.normal.dot(p.sub(this)),sd=this.normal.magSquared(),isec=p.add(this.normal.scale(sn/sd));return isec.distanceTo(p)},Plane.prototype.getIntersectionWithRay=function(r){var denom=this.normal.dot(r.getDirection()),u;return denom>mathUtils.EPS?(u=this.normal.dot(this.sub(r))/denom,r.getPointAtDistance(u)):undefined},Plane.prototype.getProjectedPoint=function(p){var dir,proj;return this.normal.dot(this.sub(p))<0?dir=this.normal.getInverted():dir=this.normal,proj=(new Ray3D(p,dir)).getPointAtDistance(this.getDistanceToPoint(p)),proj},Plane.prototype.intersectRayDistance=function(ray){var d=this.normal.dot(this),numer=this.normal.dot(ray)+d,denom=this.normal.dot(ray.dir);return mathUtils.abs(denom)<mathUtils.EPS?-1:-(numer/denom)},Plane.prototype.toMesh=function(a,b){var size,mesh,p,n,m,a,b,c,d;arguments.length==1?(size=a,mesh=new TriangleMesh("plane",4,2)):(mesh=a,size=b)},module.exports=Plane}),define("toxi/geom/Ray3DIntersector",["require","exports","module","./IsectData3D","../math/mathUtils"],function(require,exports,module){var IsectData3D=require("./IsectData3D"),mathUtils=require("../math/mathUtils");Ray3DIntersector=function(ray){this.ray=ray,this.isec=new IsectData3D},Ray3DIntersector.prototype={getIntersectionData:function(){return this.isec},intersectsRay:function(other){var n=this.ray.dir.cross(other.dir),sr=this.ray.sub(other),absX=mathUtils.abs(n.x),absY=mathUtils.abs(n.y),absZ=mathUtils.abs(n.z),t;return absZ>absX&&absZ>absY?t=(sr.x*other.dir.y-sr.y*other.dir.x)/n.z:absX>absY?t=(sr.y*other.dir.z-sr.z*other.dir.y)/n.x:t=(sr.z*other.dir.x-sr.x*other.dir.z)/n.y,this.isec.isIntersection=t<=mathUtils.EPS&&!isFinite(t),this.isec.pos=this.ray.getPointAtDistance(-t),this.isec.isIntersection}},module.exports=Ray3DIntersector}),define("toxi/geom/mesh/SphereFunction",["require","exports","module","../../math/mathUtils","../Vec3D","../Sphere"],function(require,exports,module){var mathUtils=require("../../math/mathUtils"),Vec3D=require("../Vec3D"),internals=require("../../internals"),Sphere=require("../Sphere"),SphereFunction=function(sphere_or_radius){sphere_or_radius===undefined&&(this.sphere=new Sphere(new Vec3D,1)),internals.tests.isSphere(sphere_or_radius)?this.sphere=sphere_or_radius:this.sphere=new Sphere(new Vec3D,sphere_or_radius),this.phiRange=mathUtils.PI,this.thetaRange=mathUtils.TWO_PI};SphereFunction.prototype={computeVertexFor:function(p,phi,theta){phi-=mathUtils.HALF_PI;var cosPhi=mathUtils.cos(phi),cosTheta=mathUtils.cos(theta),sinPhi=mathUtils.sin(phi),sinTheta=mathUtils.sin(theta),t=mathUtils.sign(cosPhi)*mathUtils.abs(cosPhi);return p.x=t*mathUtils.sign(cosTheta)*mathUtils.abs(cosTheta),p.y=mathUtils.sign(sinPhi)*mathUtils.abs(sinPhi),p.z=t*mathUtils.sign(sinTheta)*mathUtils.abs(sinTheta),p.scaleSelf(this.sphere.radius).addSelf(this.sphere)},getPhiRange:function(){return this.phiRange},getPhiResolutionLimit:function(res){return res},getThetaRange:function(){return this.thetaRange},getThetaResolutionLimit:function(res){return res},setMaxPhi:function(max){this.phiRange=mathUtils.min(max/2,mathUtils.PI)},setMaxTheta:function(max){this.thetaRange=mathUtils.min(max,mathUtils.TWO_PI)}},module.exports=SphereFunction}),define("toxi/geom/mesh/SurfaceMeshBuilder",["require","exports","module","./TriangleMesh","../Vec3D","../Vec2D"],function(require,exports,module){var Vec3D=require("../Vec3D"),Vec2D=require("../Vec2D"),TriangleMesh=require("./TriangleMesh"),SurfaceMeshBuilder=function(func){this.func=func};SurfaceMeshBuilder.prototype={createMesh:function(){var opts={mesh:undefined,resolution:0,size:1,isClosed:!0};if(arguments.length==1)if(typeof arguments[0]=="object"){var arg=arguments[0];opts.mesh=arg.mesh,opts.resolution=arg.res||arg.resoultion||0,arg.size!==undefined&&(opts.size=arg.size),arg.isClosed!==undefined&&(opts.isClosed=arg.isClosed)}else opts.resolution=arguments[0];else arguments.length>2&&(opts.mesh=arguments[0],opts.resolution=arguments[1],opts.size=arguments[2],arguments.length==4&&(opts.isClosed=arguments[3]));var mesh=opts.mesh;if(mesh===undefined||mesh===null)mesh=new TriangleMesh;var a=new Vec3D,b=new Vec3D,pa=new Vec3D,pb=new Vec3D,a0=new Vec3D,b0=new Vec3D,phiRes=this.func.getPhiResolutionLimit(opts.resolution),phiRange=this.func.getPhiRange(),thetaRes=this.func.getThetaResolutionLimit(opts.resolution),thetaRange=this.func.getThetaRange(),pres=1/phiRes,tres=1/thetaRes,ires=1/opts.resolution,pauv=new Vec2D,pbuv=new Vec2D,auv=new Vec2D,buv=new Vec2D;for(var p=0;p<phiRes;p++){var phi=p*phiRange*ires,phiNext=(p+1)*phiRange*ires;for(var t=0;t<=thetaRes;t++){var theta=t*thetaRange*ires,func=this.func;a=func.computeVertexFor(a,phiNext,theta).scaleSelf(opts.size),auv.set(t*tres,1-(p+1)*pres),b=func.computeVertexFor(b,phi,theta).scaleSelf(opts.size),buv.set(t*tres,1-p*pres),b.equalsWithTolerance(a,1e-4)&&b.set(a),t>0?(t==thetaRes&&opts.isClosed&&(a.set(a0),b.set(b0)),mesh.addFace(pa,pb,a,pauv.copy(),pbuv.copy(),auv.copy()),mesh.addFace(pb,b,a,pbuv.copy(),buv.copy(),auv.copy())):(a0.set(a),b0.set(b)),pa.set(a),pb.set(b),pauv.set(auv),pbuv.set(buv)}}return mesh},getFunction:function(){return this.func},setFunction:function(func){this.func=func}},exports.SurfaceMeshBuilder=SurfaceMeshBuilder,module.exports=SurfaceMeshBuilder}),define("toxi/geom/Sphere",["require","exports","module","../internals","./Vec3D","./mesh/SphereFunction","./mesh/SurfaceMeshBuilder"],function(require,exports,module){var internals=require("../internals"),SurfaceMeshBuilder=require("./mesh/SurfaceMeshBuilder"),SphereFunction=require("./mesh/SphereFunction"),Vec3D=require("./Vec3D"),Sphere=function(a,b){a===undefined?(Vec3D.apply(this,[new Vec3D]),this.radius=1):internals.tests.hasXYZ(a)?(Vec3D.apply(this,[a]),internals.tests.isSphere(a)?this.radius=a.radius:this.radius=b):(Vec3D.apply(this,[new Vec3D]),this.radius=a)};internals.extend(Sphere,Vec3D),Sphere.prototype.containsPoint=function(p){var d=this.sub(p).magSquared();return d<=this.radius*this.radius},Sphere.prototype.intersectRay=function(ray){var result,a,b,t,q=ray.sub(this),distSquared=q.magSquared(),v=-q.dot(ray.getDirection()),d=this.radius*this.radius-(distSquared-v*v);return d>=0&&(d=Math.sqrt(d),a=v+d,b=v-d,a<0&&b<0||(a>0&&b>0?a>b&&(t=a,a=b,b=t):b>0&&(t=a,a=b,b=t)),result=[a,b]),result},Sphere.prototype.intersectSphereTriangle=function(t,result){result.set(t.closestPointOnSurface(this));var v=result.sub(this);return v.magSquared()<=this.radius*this.radius},Sphere.prototype.tangentPlaneNormalAt=function(q){return this.sub(q).normalize()},Sphere.prototype.toMesh=function(){var opts={mesh:undefined,resolution:0};arguments.length===1?typeof arguments[0]=="object"?(opts.mesh=arguments[0].mesh,opts.resolution=arguments[0].res||arguments[0].resolution):opts.resolution=arguments[0]:(opts.mesh=arguments[0],opts.resolution=arguments[1]);var builder=new SurfaceMeshBuilder(new SphereFunction(this));return builder.createMesh(opts.mesh,opts.resolution,1)},module.exports=Sphere}),define("toxi/geom/Spline2D",["require","exports","module","./Vec2D","./BernsteinPolynomial"],function(require,exports,module){var Vec2D=require("./Vec2D"),BernsteinPolynomial=require("./BernsteinPolynomial"),Spline2D=function(rawPoints,bernsteinPoly){if(arguments.length===0)this.setTightness(Spline2D.DEFAULT_TIGHTNESS),this.pointList=[];else if(arguments.length>=3)this.pointList=rawPoints.slice(0),this.bernstein=bernsteinPoly,this.setTightness(tightness);else if(arguments.length==1){this.pointList=rawPoints,this.numP=rawPoints.length,this.coeffA=[],this.delta=[],this.bi=[];for(var i=0;i<this.numP;i++)this.coeffA[i]=new Vec2D,this.delta[i]=new Vec2D,this.bi[i]=0}this.numP=this.pointList.length,this.bi=[]};Spline2D.prototype={add:function(p){return this.pointList.push(p.copy()),this},computeVertices:function(res){this.updateCoefficients();if(this.bernstein===undefined||this.bernstein.resolution!=res)this.bernstein=new BernsteinPolynomial(res);var bst=this.bernstein;this.vertices=[],this.findCPoints();var deltaP=new Vec2D,deltaQ=new Vec2D;for(var i=0;i<this.numP-1;i++){var p=this.points[i],q=this.points[i+1];deltaP.set(this.delta[i]).addSelf(p),deltaQ.set(q).subSelf(this.delta[i+1]);for(var k=0;k<bst.resolution;k++){var x=p.x*bst.b0[k]+deltaP.x*bst.b1[k]+deltaQ.x*bst.b2[k]+q.x*bst.b3[k],y=p.y*bst.b0[k]+deltaP.y*bst.b1[k]+deltaQ.y*bst.b2[k]+q.y*bst.b3[k];this.vertices.push(new Vec2D(x,y))}}return this.vertices},findCPoints:function(){this.bi[1]=-0.25;var i;this.coeffA[1].set((this.points[2].x-this.points[0].x-this.delta[0].x)*this.tightness,(this.points[2].y-this.points[0].y-this.delta[0].y)*this.tightness);for(i=2;i<this.numP-1;i++)this.bi[i]=-1/(this.invTightness+this.bi[i-1]),this.coeffA[i].set(-(this.points[i+1].x-this.points[i-1].x-this.coeffA[i-1].x)*this.bi[i],-(this.points[i+1].y-this.points[i-1].y-this.coeffA[i-1].y)*this.bi[i]);for(i=this.numP-2;i>0;i--)this.delta[i].set(this.coeffA[i].x+this.delta[i+1].x*this.bi[i],this.coeffA[i].y+this.delta[i+1].y*this.bi[i])},getDecimatedVertices:function(step,doAddFinalVertex){doAddFinalVertex===undefined&&(doAddFinalVertex=!0),(this.vertices===undefined||this.vertices.length<2)&&this.computeVertices(Spline2D.DEFAULT_RES);var arcLen=this.getEstimatedArcLength(),uniform=[],delta=step/arcLen,currIdx=0;for(var t=0;t<1;t+=delta){var currT=t*arcLen;while(currT>=this.arcLenIndex[currIdx])currIdx++;var p=this.vertices[currIdx-1],q=this.vertices[currIdx],frac=(currT-this.arcLenIndex[currIdx-1])/(this.arcLenIndex[currIdx]-this.arcLenIndex[currIdx-1]),i=p.interpolateTo(q,frac);this.uniform.push(i)}return doAddFinalVertex&&uniform.push(this.vertices[this.vertices.length-1]),uniform},getEstimatedArcLength:function(){if(this.arcLenIndex===undefined||this.arcLenIndex!==undefined&&this.arcLenIndex.length!=this.vertices.length)this.arcLenIndex=[];var arcLen=0;for(var i=1;i<this.arcLenIndex.length;i++){var p=this.vertices[i-1],q=this.vertices[i];arcLen+=p.distanceTo(q),this.arcLenIndex[i]=arcLen}return arcLen},getNumPoints:function(){return this.numP},getPointList:function(){return this.pointList},getTightness:function(){return this.tightness},setPointList:function(plist){return this.pointList=plist.slice(0),this},setTightness:function(tight){return this.tightness=tight,this.invTightness=1/this.tightness,this},updateCoefficients:function(){this.numP=this.pointList.length;if(this.points===undefined||this.points!==undefined&&this.points.length!=this.numP){this.coeffA=[],this.delta=[],this.bi=[];for(var i=0;i<this.numP;i++)this.coeffA[i]=new Vec2D,this.delta[i]=new Vec2D;this.setTightness(this.tightness)}this.points=this.pointList.slice(0)}},Spline2D.DEFAULT_TIGHTNESS=.25,Spline2D.DEFAULT_RES=16,module.exports=Spline2D}),define("toxi/geom/AxisAlignedCylinder",["require","exports","module","./Cone"],function(require,exports,module){var Cone=require("./Cone"),AxisAlignedCylinder=function(pos,radius,length){this.pos=pos===undefined?undefined:pos.copy(),this.setRadius(radius),this.setLength(length)};AxisAlignedCylinder.prototype={containsPoint:function(p){throw Error("AxisAlignedCylinder.containsPoint(): not implmented")},getLength:function(){return this.length},getMajorAxis:function(){throw Error("AxisAlignedCylinder.getMajorAxis(): not implemented")},getPosition:function(){return this.pos.copy()},getRadius:function(){return this.radius},setLength:function(length){this.length=length},setPosition:function(pos){this.pos.set(pos)},setRadius:function(radius){this.radius=radius,this.radiusSquared=radius*radius},toMesh:function(a,b,c){var opts={mesh:undefined,steps:12,thetaOffset:0};if(arguments.length==1&&typeof arguments[0]=="object")for(var prop in arguments[0])opts[prop]=arguments[0][prop];else arguments.length==2&&(opts.steps=arguments[0],opts.thetaOffset=arguments[1]);var cone=new Cone(this.pos,this.getMajorAxis().getVector(),this.radius,this.radius,this.length);return cone.toMesh(opts.mesh,opts.steps,opts.thetaOffset,!0,!0)}},module.exports=AxisAlignedCylinder}),define("toxi/geom/XAxisCylinder",["require","exports","module","../internals","../math/mathUtils","./Vec3D","./AxisAlignedCylinder"],function(require,exports,module){var extend=require("../internals").extend,mathUtils=require("../math/mathUtils"),Vec3D=require("./Vec3D"),AxisAlignedCylinder=require("./AxisAlignedCylinder"),XAxisCylinder=function(pos,radius,length){AxisAlignedCylinder.apply(this,[pos,radius,length])};extend(XAxisCylinder,AxisAlignedCylinder),XAxisCylinder.prototype.containsPoint=function(p){if(mathUtils.abs(p.x-this.pos.x)<this.length*.5){var dy=p.y-this.pos.y,dz=p.z-this.pos.z;if(Math.abs(dz*dz+dy*dy)<this.radiusSquared)return!0}return!1},XAxisCylinder.prototype.getMajorAxis=function(){return Vec3D.Axis.X},module.exports=XAxisCylinder}),define("toxi/geom/YAxisCylinder",["require","exports","module","../internals","../math/mathUtils","./Vec3D","./AxisAlignedCylinder"],function(require,exports,module){var extend=require("../internals").extend,mathUtils=require("../math/mathUtils"),Vec3D=require("./Vec3D"),AxisAlignedCylinder=require("./AxisAlignedCylinder"),YAxisCylinder=function(pos,radius,length){AxisAlignedCylinder.apply(this,[pos,radius,length])};extend(YAxisCylinder,AxisAlignedCylinder),YAxisCylinder.prototype.containsPoint=function(p){if(mathUtils.abs(p.y-this.pos.y)<this.length*.5){var dx=p.x-this.pos.x,dz=p.z-this.pos.z;if(Math.abs(dz*dz+dx*dx)<this.radiusSquared)return!0}return!1},YAxisCylinder.prototype.getMajorAxis=function(){return Vec3D.Axis.Y},module.exports=YAxisCylinder}),define("toxi/geom/ZAxisCylinder",["require","exports","module","../internals","../math/mathUtils","./Vec3D","./AxisAlignedCylinder"],function(require,exports,module){var extend=require("../internals").extend,mathUtils=require("../math/mathUtils"),Vec3D=require("./Vec3D"),AxisAlignedCylinder=require("./AxisAlignedCylinder"),ZAxisCylinder=function(pos,radius,length){AxisAlignedCylinder.apply(this,[pos,radius,length])};extend(ZAxisCylinder,AxisAlignedCylinder),ZAxisCylinder.prototype.containsPoint=function(p){if(mathUtils.abs(p.z-this.pos.z)<this.length*.5){var dx=p.x-this.pos.x,dy=p.y-this.pos.y;if(Math.abs(dx*dx+dy*dy)<this.radiusSquared)return!0}return!1},ZAxisCylinder.prototype.getMajorAxis=function(){return Vec3D.Axis.Z},module.exports=ZAxisCylinder}),define("toxi/geom/mesh/BezierPatch",["require","exports","module","../Vec3D","./TriangleMesh"],function(require,exports,module){var Vec3D=require("../Vec3D"),TriangleMesh=require("./TriangleMesh"),BezierPatch=function(points){this.points=points===undefined?[]:points;for(var i=0;i<4;i++)for(var j=0;j<4;j++)this.points[i][j]=new Vec3D};BezierPatch.prototype={computePointAt:function(u,v){return this.computePointAt(u,v,this.points)},set:function(x,y,p){return this.points[y][x].set(p),this},toMesh:function(mesh_or_res,_res){var mesh,res;_res===undefined?(mesh=new TriangleMesh,res=mesh_or_res):(mesh=mesh_or_res,res=_res);var curr=new Array(res+1),prev=new Array(res+1),r1=1/res;for(var y=0;y<=res;y++){for(var x=0;x<=res;x++){var p=this.computePointAt(x*r1,y*r1,this.points);x>0&&y>0&&(mesh.addFace(p,curr[x-1],prev[x-1]),mesh.addFace(p,prev[x-1],prev[x])),curr[x]=p}var tmp=prev;prev=curr,curr=tmp}return mesh}},BezierPatch.computePointAt=function(u,v,points){var u1=1-u,u1squared=u1*u1*3*u,u1cubed=u1*u1*u1,usquared=u*u,v1=1-v,vsquared=v*v*3,v1squared=v1*v1*3,v1cubed=v1*v1*v1,vcubed=v*v*v,u1usq=u1*usquared*3,usqu=u*usquared,v1vsq=v1*vsquared,v1sqv=v1squared*v,p0=points[0],p1=points[1],p2=points[2],p3=points[3],x=u1cubed*(p0[0].x*v1cubed+p0[1].x*v1sqv+p0[2].x*v1vsq+p0[3].x*vcubed)+u1squared*(p1[0].x*v1cubed+p1[1].x*v1sqv+p1[2].x*v1vsq+p1[3].x*vcubed)+u1usq*(p2[0].x*v1cubed+p2[1].x*v1sqv+p2[2].x*v1vsq+p2[3].x*vcubed)+usqu*(p3[0].x*v1cubed+p3[1].x*v1sqv+p3[2].x*v1vsq+p3[3].x*vcubed),y=u1cubed*(p0[0].y*v1cubed+p0[1].y*v1sqv+p0[2].y*v1vsq+p0[3].y*vcubed)+u1squared*(p1[0].y*v1cubed+p1[1].y*v1sqv+p1[2].y*v1vsq+p1[3].y*vcubed)+u1usq*(p2[0].y*v1cubed+p2[1].y*v1sqv+p2[2].y*v1vsq+p2[3].y*vcubed)+usqu*(p3[0].y*v1cubed+p3[1].y*v1sqv+p3[2].y*v1vsq+p3[3].y*vcubed),z=u1cubed*(p0[0].z*v1cubed+p0[1].z*v1sqv+p0[2].z*v1vsq+p0[3].z*vcubed)+u1squared*(p1[0].z*v1cubed+p1[1].z*v1sqv+p1[2].z*v1vsq+p1[3].z*vcubed)+u1usq*(p2[0].z*v1cubed+p2[1].z*v1sqv+p2[2].z*v1vsq+p2[3].z*vcubed)+usqu*(p3[0].z*v1cubed+p3[1].z*v1sqv+p3[2].z*v1vsq+p3[3].z*vcubed);return new Vec3D(x,y,z)},module.exports=BezierPatch}),define("toxi/geom/mesh/VertexSelector",["require","exports","module"],function(require,exports,module){var VertexSelector=function(mesh){this.mesh=mesh,this.selection=[]};VertexSelector.prototype={addSelection:function(sel2){return this.checkMeshIdentity(sel2.getMesh()),this.selection.addAll(sel2.getSelection()),this},checkMeshIdentity:function(mesh2){if(mesh2!=this.mesh)throw new Error("The given selector is not using the same mesh instance")},clearSelection:function(){return this.selection.clear(),this},getMesh:function(){return this.mesh},getSelection:function(){return this.selection},invertSelection:function(){var newSel=[],vertices=mesh.getVertices(),l=vertices.length;for(var i=0;i<l;i++){var v=vertices[i];selection.contains(v)||newSel.add(v)}return this.selection=newSel,this},selectSimilar:function(points){var l=points.length;for(var i=0;i<l;i++){var v=points[i];this.selection.add(this.mesh.getClosestVertexToPoint(v))}return this},selectVertices:function(){return this},setMesh:function(mesh){this.mesh=mesh,this.clearSelection()},size:function(){return this.selection.size()},subtractSelection:function(sel2){return this.checkMeshIdentity(sel2.getMesh()),this.selection.removeAll(sel2.getSelection()),this}},module.exports=VertexSelector}),define("toxi/geom/mesh/BoxSelector",["require","exports","module","../../internals","./VertexSelector"],function(require,exports,module){var extend=require("../../internals").extend,VertexSelector=require("./VertexSelector"),BoxSelector=function(mesh,box){VertexSelector.apply(this,[mesh]),this.box=box};extend(BoxSelector,VertexSelector),BoxSelector.prototype.selectVertices=function(){this.clearSelection();var verts=this.mesh.getVertices(),l=verts.length;for(var i=0;i<l;i++){var v=verts[i];this.box.containsPoint(v)&&this.selection.add(v)}return this},module.exports=BoxSelector}),define("toxi/geom/mesh/DefaultSelector",["require","exports","module","../../internals","./VertexSelector"],function(require,exports,module){var extend=require("../../internals").extend,VertexSelector=require("./VertexSelector"),DefaultSelector=function(mesh){VertexSelector.apply(this,[mesh])};extend(DefaultSelector,VertexSelector),DefaultSelector.prototype.selectVertices=function(){return this.clearSelection(),this.selection.addAll(this.mesh.getVertices()),this},module.exports=DefaultSelector}),define("toxi/geom/mesh/OBJWriter",["../../internals"],function(internals){var StringBuffer=function(){this.buffer=[]};StringBuffer.prototype.append=function(string){return this.buffer.push(string),this},StringBuffer.prototype.toString=function(){return this.buffer.join("")};var OBJWriter=function(){this.VERSION="0.3",this.__stringBuffer=new StringBuffer,this.objStream,this.__filename="objwriter.obj",this._numVerticesWritten=0,this._numNormalsWritten=0};return OBJWriter.prototype={beginSave:function(stream){typeof stream!="string"&&internals.hasProperties(stream,["write","end","writable"]&&stream.writable)&&(this.objStream=stream),this._handleBeginSave()},endSave:function(){if(this.objStream!==undefined)try{this.objStream.destroy()}catch(e){}},face:function(a,b,c){this.__stringBuffer.append("f "+a+" "+b+" "+c+"\n")},faceList:function(){this.__stringBuffer.append("s off \n")},faceWithNormals:function(a,b,c,na,nb,nc){this.__stringBuffer.append("f "+a+"//"+na+" "+b+"//"+nb+" "+c+"//"+nc+"\n")},getCurrNormalOffset:function(){return this._numNormalsWritten},getCurrVertexOffset:function(){return this._numVerticesWritten},getOutput:function(){return this.__stringBuffer.toString()},_handleBeginSave:function(){this.numVerticesWritten=0,this.numNormalsWrittern=0,this.__stringBuffer.append("# generated by OBJExport (js) v"+this.VERSION+"\n")},newObject:function(name){this.__stringBuffer.append("o "+name+"\n")},normal:function(vecN){this.__stringBuffer.append("vn "+vecN.x+" "+vecN.y+" "+vecN.z+"\n"),this._numNormalsWritten++},vertex:function(vecV){this.__stringBuffer.append("v "+vecV.x+" "+vecV.y+" "+vecV.z+"\n"),this._numVerticesWritten++}},OBJWriter}),define("toxi/geom/mesh/PlaneSelector",["require","exports","module","../../internals","./VertexSelector"],function(require,exports,module){var extend=require("../../internals").extend,VertexSelector=require("./VertexSelector"),PlaneSelector=function(mesh,plane,classifier,tolerance){VertexSelector.apply(this,[mesh]),this.plane=plane,this.classifier=classifier,this.tolerances=tolerance===undefined?1e-4:tolerance};extend(PlaneSelector,VertexSelector),PlaneSelector.prototype.selectVertices=function(){this.clearSelection();var verts=this.mesh.getVertices(),l=verts.length;for(var i=0;i<l;i++){var v=verts[i];this.plane.classifyPoint(v,this.tolerance)==this.classifier&&this.selection.add(v)}return this},module.exports=PlaneSelector}),define("toxi/geom/mesh/SphericalHarmonics",["require","exports","module","../../math/mathUtils"],function(require,exports,module){var mathUtils=require("../../math/mathUtils"),SphericalHarmonics=function(m){this.m=m};SphericalHarmonics.prototype={computeVertexFor:function(p,phi,theta){var r=0;r+=Math.pow(mathUtils.sin(this.m[0]*theta),this.m[1]),r+=Math.pow(mathUtils.cos(this.m[2]*theta),this.m[3]),r+=Math.pow(mathUtils.sin(this.m[4]*phi),this.m[5]),r+=Math.pow(mathUtils.cos(this.m[6]*phi),this.m[7]);var sinTheta=mathUtils.sin(theta);return p.x=r*sinTheta*mathUtils.cos(phi),p.y=r*mathUtils.cos(theta),p.z=r*sinTheta*mathUtils.sin(phi),p},getPhiRange:function(){return mathUtils.TWO_PI},getPhiResolutionLimit:function(res){return res},getThetaRange:function(){return mathUtils.PI},getThetaResolutionLimit:function(res){return res}},module.exports=SphericalHarmonics}),define("toxi/geom/mesh/SuperEllipsoid",["require","exports","module","../../math/mathUtils","./TriangleMesh"],function(require,exports,module){var mathUtils=require("../../math/mathUtils"),TriangleMesh=require("./TriangleMesh"),SuperEllipsoid=function(n1,n2){this.p1=n1,this.p2=n2};SuperEllipsoid.prototype={computeVertexFor:function(p,phi,theta){phi-=mathUtils.HALF_PI;var cosPhi=mathUtils.cos(phi),cosTheta=mathUtils.cos(theta),sinPhi=mathUtils.sin(phi),sinTheta=mathUtils.sin(theta),t=mathUtils.sign(cosPhi)*Math.pow(mathUtils.abs(cosPhi),this.p1);return p.x=t*mathUtils.sign(cosTheta)*Math.pow(Math.abs(cosTheta),this.p2),p.y=mathUtils.sign(sinPhi)*Math.pow(Math.abs(sinPhi),this.p1),p.z=t*mathUtils.sign(sinTheta)*Math.pow(mathUtils.abs(sinTheta),this.p2),p},getPhiRange:function(){return mathUtils.TWO_PI},getPhiResolutionLimit:function(res){return res/2},getThetaRange:function(){return mathUtils.TWO_PI},getThetaResolutionLimit:function(res){return res}},module.exports=SuperEllipsoid}),define("toxi/math/Interpolation2D",["require","exports","module","../internals"],function(require,exports,module){var internals=require("../internals"),Interpolation2D={};Interpolation2D.bilinear=function(_x,_y,_x1,_y1,_x2,_y2,_tl,_tr,_bl,_br){var x,y,x1,y1,x2,y2,tl,tr,bl,br;internals.tests.hasXY(_x)?(x=_x.x,y=_x.y,x1=_y.x,y1=_y.y,x2=_x1.x,y2=_x1.y,tl=_y1,tr=_x2,bl=_y2,br=_tl):(x=_x,y=_y,x1=_x1,y1=_y1,x2=_x2,y2=_y2,tl=_tl,tr=_tr,bl=_bl,br=_br);var denom=1/((x2-x1)*(y2-y1)),dx1=(x-x1)*denom,dx2=(x2-x)*denom,dy1=y-y1,dy2=y2-y;return tl*dx2*dy2+tr*dx1*dy2+bl*dx2*dy1+br*dx1*dy1},module.exports=Interpolation2D}),define("toxi/geom/TriangleIntersector",["../math/mathUtils","./Triangle3D","./Vec3D","./IsectData3D"],function(mathUtils,Triangle3D,Vec3D,IsectData3D){var TriangleIntersector=function(t){this.triangle=t||new Triangle3D,this.isectData=new IsectData3D};return TriangleIntersector.prototype={getIntersectionData:function(){return this.isectData},getTriangle:function(){return this.triangle},intersectsRay:function(ray){this.isectData.isIntersection=!1;var n=this.triangle.computeNormal(),dotprod=n.dot(ray.dir);if(dotprod<0){var rt=ray.sub(this.triangle.a),t=-(n.x*rt.x+n.y*rt.y+n.z*rt.z)/(n.x*ray.dir.x+n.y*ray.dir.y+n.z*ray.dir.z);if(t>=mathUtils.EPS){var pos=ray.getPointAtDistance(t);this.triangle.containsPoint(pos)&&(this.isectData.isIntersection=!0,this.isectData.pos=pos,this.isectData.normal=n,this.isectData.dist=t,this.isectData.dir=this.isectData.pos.sub(ray).normalize())}}return this.isectData.isIntersection},setTriangle:function(tri){return this.triangle=tri,this}},TriangleIntersector}),define("toxi/geom/mesh/Terrain",["../../internals","../../math/mathUtils","../../math/Interpolation2D","../Ray3D","../TriangleIntersector","../Triangle3D","../IsectData3D","../../geom/Vec2D","../../geom/Vec3D","./TriangleMesh"],function(internals,mathUtils,Interpolation2D,Ray3D,TriangleIntersector,Triangle3D,IsectData3D,Vec2D,Vec3D,TriangleMesh){var Terrain=function(width,depth,scale){this.width=width,this._depth=depth,internals.hasProperties(scale,["x","y"])?this.scale=scale:this.scale=new Vec2D(scale,scale),this.elevation=[];var i=0,len=width*depth;for(i=0;i<len;i++)this.elevation[i]=0;this.__elevationLength=this.width*this._depth,this.vertices=[];var offset=new Vec3D(parseInt(this.width/2,10),0,parseInt(this._depth/2,10)),scaleXZ=this.scale.to3DXZ();for(var z=0,i=0;z<this._depth;z++)for(var x=0;x<this.width;x++)this.vertices[i++]=(new Vec3D(x,0,z)).subSelf(offset).scaleSelf(scaleXZ)};return Terrain.prototype={getDepth:function(){return this._depth},getElevation:function(){return this.elevation},getHeightAtCell:function(x,z){return console.log("["+x+","+z+"]"),this.elevation[this._getIndex(x,z)]},getHeightAtPoint:function(x,z){var xx=x/this.scale.x+this.width*.5,zz=z/this.scale.y+this._depth*.5,y=0,fl={xx:parseInt(xx,10),zz:parseInt(zz,10)};if(xx>=0&xx<this.width&&zz>=0&&zz<this._depth){var x2=parseInt(mathUtils.min(xx+1,this.width-1),10),z2=parseInt(mathUtils.min(zz+1,this._depth-1),10),a=this.getHeightAtCell(fl.xx,fl.zz),b=this.getHeightAtCell(x2,fl.zz),c=this.getHeightAtCell(fl.xx,z2),d=this.getHeightAtCell(x2,z2);y=Interpolation2D.bilinear(xx,zz,fl.xx,fl.zz,x2,z2,a,b,c,d)}return y},_getIndex:function(x,z){var idx=z*this.width+x;if(idx<0||idx>this.__elevationLength)throw new Error("the given terrain cell is invalid: "+x+";"+z);return idx},getScale:function(){return this.scale},getVertexAtCell:function(x,z){return this.vertices[this._getIndex(x,z)]},getWidth:function(){return this.width},intersectAtPoint:function(x,z){var xx=x/this.scale.x+this.width*.5,zz=z/this.scale.y+this._depth*.5,isec=new IsectData3D;if(xx>=0&&xx<this.width&&zz>=0&&zz<this._depth){var x2=parseInt(mathUtils.min(xx+1,this.width-1),10),z2=parseInt(mathUtils.min(zz+1,this._depth-1),10),fl={xx:parseInt(xx,10),zz:parseInt(zz,10)},a=this.getVertexAtCell(fl.xx,fl.zz),b=this.getVertexAtCell(x2,fl.zz),c=this.getVertexAtCell(x2,z2),d=this.getVertexAtCell(fl.xx,z2),r=new Ray3D(new Vec3D(x,1e4,z),new Vec3D(0,-1,0)),i=new TriangleIntersector(new Triangle3D(a,b,d));console.log("ray",r),console.log("intersector",i),i.intersectsRay(r)?isec=i.getIntersectionData():(i.setTriangle(new Triangle3D(b,c,d)),i.intersectsRay(r),isec=i.getIntersectionData())}return isec},setElevation:function(elevation){if(this.__elevationLength!=elevation.length)throw new Error("the given elevation array size does not match terrain");for(var i=0,len=elevation.length;i<len;i++)this.vertices[i].y=this.elevation[i]=elevation[i];return this},setHeightAtCell:function(x,z,h){var index=this._getIndex(x,z);return this.elevation[index]=h,this.vertices[index].y=h,this},setScale:function(scale){internals.hasProperties(scale,["x","y"])?this.scale=scale:this.scale=new Vec2D(scale,scale)},toMesh:function(){var opts={mesh:undefined,minX:0,minZ:0,maxX:this.width,maxZ:this._depth},v=this.vertices,w=this.width,d=this._depth;if(arguments.length==1&&typeof arguments[0]=="object"){var args=arguments[0];opts.mesh=args.mesh||new TriangleMesh("terrain"),opts.minX=args.minX||opts.minX,opts.minZ=args.minZ||opts.minZ,opts.maxX=args.maxX||opts.maxX,opts.maxZ=args.maxZ||opts.maxZ}else arguments.length>=5&&(opts.mesh=arguments[0],opts.minX=arguments[1],opts.minZ=arguments[2],opts.maxX=arguments[3],opts.maxZ=arguments[4]);opts.mesh=opts.mesh||new TriangleMesh("terrain"),opts.minX=mathUtils.clip(opts.minX,0,w-1),opts.maxX=mathUtils.clip(opts.maxX,0,w),opts.minZ=mathUtils.clip(opts.minZ,0,d-1),opts.maxZ=mathUtils.clip(opts.maxZ,0,d),opts.minX++,opts.minZ++;for(var z=opts.minZ,idx=opts.minX*w;z<opts.maxZ;z++,idx+=w)for(var x=opts.minX;x<opts.maxX;x++)opts.mesh.addFace(v[idx-w+x-1],v[idx-w+x],v[idx+x-1]),opts.mesh.addFace(v[idx-w+x],v[idx+x],v[idx+x-1]);return opts.mesh}},Terrain}),define("toxi/geom/mesh",["require","exports","module","./mesh/BezierPatch","./mesh/BoxSelector","./mesh/DefaultSelector","./mesh/Face","./mesh/OBJWriter","./mesh/PlaneSelector","./mesh/SphereFunction","./mesh/SphericalHarmonics","./mesh/SurfaceMeshBuilder","./mesh/SuperEllipsoid","./mesh/TriangleMesh","./mesh/Vertex","./mesh/VertexSelector","./mesh/Terrain"],function(require,exports,module){module.exports={BezierPatch:require("./mesh/BezierPatch"),BoxSelector:require("./mesh/BoxSelector"),DefaultSelector:require("./mesh/DefaultSelector"),Face:require("./mesh/Face"),OBJWriter:require("./mesh/OBJWriter"),PlaneSelector:require("./mesh/PlaneSelector"),SphereFunction:require("./mesh/SphereFunction"),SphericalHarmonics:require("./mesh/SphericalHarmonics"),SurfaceMeshBuilder:require("./mesh/SurfaceMeshBuilder"),SuperEllipsoid:require("./mesh/SuperEllipsoid"),Terrain:require("./mesh/Terrain"),TriangleMesh:require("./mesh/TriangleMesh"),Vertex:require("./mesh/Vertex"),VertexSelector:require("./mesh/VertexSelector")}}),define("toxi/geom",["require","exports","module","./geom/AABB","./geom/BernsteinPolynomial","./geom/Circle","./geom/CircleIntersector","./geom/Cone","./geom/Ellipse","./geom/IsectData2D","./geom/IsectData3D","./geom/Line2D","./geom/Line3D","./geom/Matrix4x4","./geom/Plane","./geom/Polygon2D","./geom/Quaternion","./geom/Ray2D","./geom/Ray3D","./geom/Ray3DIntersector","./geom/Rect","./geom/Sphere","./geom/Spline2D","./geom/Triangle2D","./geom/Triangle3D","./geom/Vec2D","./geom/Vec3D","./geom/XAxisCylinder","./geom/YAxisCylinder","./geom/ZAxisCylinder","./geom/mesh"],function(require,exports,module){module.exports={AABB:require("./geom/AABB"),BernsteinPolynomial:require("./geom/BernsteinPolynomial"),Circle:require("./geom/Circle"),CircleIntersector:require("./geom/CircleIntersector"),Cone:require("./geom/Cone"),Ellipse:require("./geom/Ellipse"),IsectData2D:require("./geom/IsectData2D"),IsectData3D:require("./geom/IsectData3D"),Line2D:require("./geom/Line2D"),Line3D:require("./geom/Line3D"),Matrix4x4:require("./geom/Matrix4x4"),Plane:require("./geom/Plane"),Polygon2D:require("./geom/Polygon2D"),Quaternion:require("./geom/Quaternion"),Ray2D:require("./geom/Ray2D"),Ray3D:require("./geom/Ray3D"),Ray3DIntersector:require("./geom/Ray3DIntersector"),Rect:require("./geom/Rect"),Sphere:require("./geom/Sphere"),Spline2D:require("./geom/Spline2D"),Triangle2D:require("./geom/Triangle2D"),Triangle3D:require("./geom/Triangle3D"),Vec2D:require("./geom/Vec2D"),Vec3D:require("./geom/Vec3D"),XAxisCylinder:require("./geom/XAxisCylinder"),YAxisCylinder:require("./geom/YAxisCylinder"),ZAxisCylinder:require("./geom/ZAxisCylinder")},module.exports.mesh=require("./geom/mesh")}),define("toxi/math/BezierInterpolation",["require","exports","module"],function(require,exports,module){var BezierInterpolation=function(h1,h2){this.c1=h1,this.c2=h2};BezierInterpolation.prototype={interpolate:function(a,b,t){var tSquared=t*t,invT=1-t,invTSquared=invT*invT;return a*invTSquared*invT+3*(this.c1*(b-a)+a)*t*invTSquared+3*(this.c2*(b-a)+b)*tSquared*invT+b*tSquared*t},setCoefficients:function(a,b){this.c1=a,this.c2=b}},module.exports=BezierInterpolation}),define("toxi/math/CircularInterpolation",["require","exports","module"],function(require,exports,module){var CircularInterpolation=function(isFlipped){isFlipped===undefined&&(this.isFlipped=!1)};CircularInterpolation.prototype={interpolate:function(a,b,f){return this.isFlipped?a-(b-a)*(Math.sqrt(1-f*f)-1):(f=1-f,a+(b-a)*Math.sqrt(1-f*f))},setFlipped:function(isFlipped){this.isFlipped=isFlipped}},module.exports=CircularInterpolation}),define("toxi/math/CosineInterpolation",["require","exports","module"],function(require,exports,module){var CosineInterpolation=function(){};CosineInterpolation.prototype={interpolate:function(a,b,f){return b+(a-b)*(.5+.5*Math.cos(f*Math.PI))}},module.exports=CosineInterpolation}),define("toxi/math/LinearInterpolation",["require","exports","module"],function(require,exports,module){var LinearInterpolation=function(){};LinearInterpolation.prototype={interpolate:function(a,b,f){return a+(b-a)*f}},module.exports=LinearInterpolation}),define("toxi/math/DecimatedInterpolation",["require","exports","module","./LinearInterpolation"],function(require,exports,module){var LinearInterpolation=require("./LinearInterpolation"),DecimatedInterpolation=function(steps,strategy){if(steps===undefined)throw new Error("steps was not passed to constructor");this.numSteps=steps,this.strategy=strategy===undefined?new LinearInterpolation:strategy};DecimatedInterpolation.prototype={interpolate:function(a,b,f){var fd=Math.floor(f*this.numSteps)/this.numSteps;return this.strategy.interpolate(a,b,fd)}},module.exports=DecimatedInterpolation}),define("toxi/math/ExponentialInterpolation",["require","exports","module"],function(require,exports,module){var ExponentialInterpolation=function(exp){this.exponent=exp===undefined?2:exp};ExponentialInterpolation.prototype={interpolate:function(a,b,f){return a+(b-a)*Math.pow(f,this.exponent)}},module.exports=ExponentialInterpolation}),define("toxi/math/ScaleMap",["require","exports","module","./mathUtils","./LinearInterpolation"],function(require,exports,module){var mathUtils=require("./mathUtils"),LinearInterpolation=require("./LinearInterpolation"),_Range=function(min,max){this.min=min,this.max=max};_Range.prototype.toString=function(){return"{ min: "+this.min+", max: "+this.max+"}"};var ScaleMap=function(minIn,maxIn,minOut,maxOut){if(arguments.length==1&&arguments[0].input!==undefined&&arguments[0].output!==undefined){var arg=arguments[0];minOut=arg.output.min,maxOut=arg.output.max,maxIn=arg.input.max,minIn=arg.input.min}this.mapFunction=new LinearInterpolation,this.setInputRange(minIn,maxIn),this.setOutputRange(minOut,maxOut)};ScaleMap.prototype={getClippedValueFor:function(val){var t=mathUtils.clipNormalized((val-this._in.min)/this._interval);return this.mapFunction.interpolate(0,this.mapRange,t)+this._out.min},getInputMedian:function(){return(this._in.min+this._in.max)*.5},getInputRange:function(){return this._in},getMappedMedian:function(){return this.getMappedValueFor(.5)},getMappedValueFor:function(val){var t=(val-this._in.min)/this._interval;return this.mapFunction.interpolate(0,this.mapRange,t)+this._out.min},getOutputMedian:function(){return(this._out.min+this._out.max)*.5},getOutputRange:function(){return this._out},setInputRange:function(min,max){this._in=new _Range(min,max),this._interval=max-min},setMapFunction:function(func){this.mapFunction=func},setOutputRange:function(min,max){this._out=new _Range(min,max),this.mapRange=max-min},toString:function(){return"ScaleMap, inputRange: "+this._in.toString()+" outputRange: "+this._out.toString()}},module.exports=ScaleMap}),define("toxi/math/SigmoidInterpolation",["require","exports","module"],function(require,exports,module){var SigmoidInterpolation=function(s){s===undefined&&(s=2),this.setSharpness(s)};SigmoidInterpolation.prototype={getSharpness:function(){return this.sharpness},interpolate:function(a,b,f){return f=(f*2-1)*this.sharpPremult,f=1/(1+Math.exp(-f)),a+(b-a)*f},setSharpness:function(s){this.sharpness=s,this.sharpPremult=5*s}},module.exports=SigmoidInterpolation}),define("toxi/math/SinCosLUT",["require","exports","module","./mathUtils"],function(require,exports,module){var mathUtils=require("./mathUtils"),SinCosLUT=function(precision){precision||(precision=SinCosLUT.DEFAULT_PRECISION),this.precision=precision,this.period=360/this.precision,this.quadrant=this.period>>2,this.deg2rad=Math.PI/180*this.precision,this.rad2deg=180/Math.PI/this.precision,this.sinLUT=[];for(var i=0;i<this.period;i++)this.sinLUT[i]=Math.sin(i*this.deg2rad)};SinCosLUT.prototype={cos:function(theta){while(theta<0)theta+=mathUtils.TWO_PI;return this.sinLUT[(theta*this.rad2deg+this.quadrant)%this.period]},getPeriod:function(){return this.period},getPrecision:function(){return this.precision},getSinLUT:function(){return this.sinLUT},sin:function(theta){while(theta<0)theta+=mathUtils.TWO_PI;return this.sinLUT[theta*this.rad2deg%this.period]}},SinCosLUT.DEFAULT_PRECISION=.25,SinCosLUT.DEFAULT_INSTANCE=undefined,SinCosLUT.getDefaultInstance=function(){return SinCosLUT.DEFAULT_INSTANCE===undefined&&(SinCosLUT.DEFAULT_INSTANCE=new SinCosLUT),SinCosLUT.DEFAULT_INSTANCE},module.exports=SinCosLUT}),define("toxi/math/ThresholdInterpolation",["require","exports","module"],function(require,exports,module){var ThresholdInterpolation=function(threshold){this.threshold=threshold};ThresholdInterpolation.prototype={interpolate:function(a,b,f){return f<this.threshold?a:b}},module.exports=ThresholdInterpolation}),define("toxi/math/ZoomLensInterpolation",["require","exports","module","./mathUtils","./CircularInterpolation"],function(require,exports,module){var mathUtils=require("./mathUtils"),CircularInterpolation=require("./CircularInterpolation"),ZoomLensInterpolation=function(lensPos,lensStrength){this.leftImpl=new CircularInterpolation,this.rightImpl=new CircularInterpolation,this.lensPos=lensPos||.5,this.lensStrength=lensStrength||1,this.absStrength=Math.abs(this.lensStrength),this.leftImpl.setFlipped(this.lensStrength>0),this.rightImpl.setFlipped(this.lensStrength<0)};ZoomLensInterpolation.prototype={interpolate:function(min,max,t){var val=min+(max-min)*t;return t<this.lensPos?val+=(this.leftImpl.interpolate(min,min+(max-min)*this.lensPos,t/this.lensPos)-val)*this.absStrength:val+=(this.rightImpl.interpolate(min+(max-min)*this.lensPos,max,(t-this.lensPos)/(1-this.lensPos))-val)*this.absStrength,val},setLensPos:function(pos,smooth){this.lensPos+=(mathUtils.clipNormalized(pos)-this.lensPos)*smooth},setLensStrength:function(str,smooth){this.lensStrength+=(mathUtils.clip(str,-1,1)-this.lensStrength)*smooth,this.absStrength=mathUtils.abs(this.lensStrength),this.leftImpl.setFlipped(this.lensStrength>0),this.rightImpl.setFlipped(this.lensStrength<0)}},module.exports=ZoomLensInterpolation}),define("toxi/math/noise/PerlinNoise",["require","exports","module","../SinCosLUT"],function(require,exports,module){var SinCosLUT=require("../SinCosLUT"),internalMath={};internalMath.pow=Math.pow,internalMath.random=Math.random,function(pool,math,width,chunks,significance,overflow,startdenom){function ARC4(key){var t,u,me=this,keylen=key.length,i=0,j=me.i=me.j=me.m=0;me.S=[],me.c=[],keylen||(key=[keylen++]);while(i<width)me.S[i]=i++;for(i=0;i<width;i++)t=me.S[i],j=lowbits(j+t+key[i%keylen]),u=me.S[j],me.S[i]=u,me.S[j]=t;me.g=function(count){var s=me.S,i=lowbits(me.i+1),t=s[i],j=lowbits(me.j+t),u=s[j];s[i]=u,s[j]=t;var r=s[lowbits(t+u)];while(--count)i=lowbits(i+1),t=s[i],j=lowbits(j+t),u=s[j],s[i]=u,s[j]=t,r=r*width+s[lowbits(t+u)];return me.i=i,me.j=j,r},me.g(width)}function flatten(obj,depth,result,prop,typ){result=[],typ=typeof obj;if(depth&&typ=="object")for(prop in obj)if(prop.indexOf("S")<5)try{result.push(flatten(obj[prop],depth-1))}catch(e){}return result.length?result:obj+(typ!="string"?"\0":"")}function mixkey(seed,key,smear,j){seed+="",smear=0;for(j=0;j<seed.length;j++)key[lowbits(j)]=lowbits((smear^=key[lowbits(j)]*19)+seed.charCodeAt(j));seed="";for(j in key)seed+=String.fromCharCode(key[j]);return seed}function lowbits(n){return n&width-1}math.seedrandom=function(seed,use_entropy){var key=[],arc4;return seed=mixkey(flatten(use_entropy?[seed,pool]:arguments.length?seed:[(new Date).getTime(),pool,window],3),key),arc4=new ARC4(key),mixkey(arc4.S,pool),math.random=function(){var n=arc4.g(chunks),d=startdenom,x=0;while(n<significance)n=(n+x)*width,d*=width,x=arc4.g(1);while(n>=overflow)n/=2,d/=2,x>>>=1;return(n+x)/d},seed},startdenom=math.pow(width,chunks),significance=math.pow(2,significance),overflow=significance*2,mixkey(math.random(),pool)}([],internalMath,256,6,52);var PERLIN_YWRAPB=4,PERLIN_YWRAP=1<<PERLIN_YWRAPB,PERLIN_ZWRAPB=8,PERLIN_ZWRAP=1<<PERLIN_ZWRAPB,PERLIN_SIZE=4095,PERLIN_MIN_AMPLITUDE=.001,_noise_fsc=function(self,i){var index=(i+.5)*self._perlin_PI%self._perlin_TWOPI;return.5*(1-self._perlin_cosTable[index])},PerlinNoise=function(){this._perlin_octaves=4,this._perlin_amp_falloff=.5};PerlinNoise.prototype={noise:function(x,y,z){var i=0,x=x||0,y=y||0,z=z||0;if(!this._perlin){this._perlin=[];var length=PERLIN_SIZE-1;for(i=0;i<PERLIN_SIZE+1;i++)this._perlin[i]=internalMath.random()}this._perlin_cosTable=SinCosLUT.getDefaultInstance().getSinLUT(),this._perlin_TWOPI=this._perlin_PI=SinCosLUT.getDefaultInstance().getPeriod(),this._perlin_PI>>=1,x<0&&(x=-x),y<0&&(y=-y),z<0&&(z=-z);var xi=x,yi=y,zi=z,xf=x-xi,yf=y-yi,zf=z-zi,rxf,ryf,r=0,ampl=.5,n1,n2,n3,of;for(i=0;i<this._perlin_octaves;i++){of=xi+(yi<<PERLIN_YWRAPB)+(zi<<PERLIN_ZWRAPB),rxf=_noise_fsc(this,xf),ryf=_noise_fsc(this,yf),n1=this._perlin[of&PERLIN_SIZE],n1+=rxf*(this._perlin[of+1&PERLIN_SIZE]-n1),n2=this._perlin[of+PERLIN_YWRAP&PERLIN_SIZE],n2+=rxf*(this._perlin[of+PERLIN_YWRAP+1&PERLIN_SIZE]-n2),n1+=ryf*(n2-n1),of+=PERLIN_ZWRAP,n2=this._perlin[of&PERLIN_SIZE],n2+=rxf*(this._perlin[of+1&PERLIN_SIZE]-n2),n3=this._perlin[of+PERLIN_YWRAP&PERLIN_SIZE],n3+=rxf*(this._perlin[of+PERLIN_YWRAP+1&PERLIN_SIZE]-n3),n2+=ryf*(n3-n2),n1+=_noise_fsc(this,zf)*(n2-n1),r+=n1*ampl,ampl*=this._perlin_amp_falloff;if(ampl<PERLIN_MIN_AMPLITUDE)break;xi<<=1,xf*=2,yi<<=1,yf*=2,zi<<=1,zf*=2,xf>=1&&(xi++,xf--),yf>=1&&(yi++,yf--),zf>=1&&(zi++,zf--)}return r},noiseDetail:function(lod,falloff){lod>0&&(this._perlin_octaves=lod),falloff&&falloff>0&&(this._perlin_amp_falloff=falloff)},noiseSeed:function(what){internalMath.seedrandom(what)}},module.exports=PerlinNoise}),define("toxi/math/noise/simplexNoise",["require","exports","module","../../internals"],function(require,exports,module){var Int32Array=require("../../internals").Int32Array,numFrame=0,_SQRT3=Math.sqrt(3),_SQRT5=Math.sqrt(5),_F2=.5*(_SQRT3-1),_G2=(3-_SQRT3)/6,_G22=_G2*2-1,_F3=1/3,_G3=1/6,_F4=(_SQRT5-1)/4,_G4=(5-_SQRT5)/20,_G42=_G4*2,_G43=_G4*3,_G44=_G4*4-1,_grad3=[new Int32Array([1,1,0]),new Int32Array([-1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([-1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,-1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,-1])],_grad4=[new Int32Array([0,1,1,1]),new Int32Array([0,1,1,-1]),new Int32Array([0,1,-1,1]),new Int32Array([0,1,-1,-1]),new Int32Array([0,-1,1,1]),new Int32Array([0,-1,1,-1]),new Int32Array([0,-1,-1,1]),new Int32Array([0,-1,-1,-1]),new Int32Array([1,0,1,1]),new Int32Array([1,0,1,-1]),new Int32Array([1,0,-1,1]),new Int32Array([1,0,-1,-1]),new Int32Array([-1,0,1,1]),new Int32Array([-1,0,1,-1]),new Int32Array([-1,0,-1,1]),new Int32Array([-1,0,-1,-1]),new Int32Array([1,1,0,1]),new Int32Array([1,1,0,-1]),new Int32Array([1,-1,0,1]),new Int32Array([1,-1,0,-1]),new Int32Array([-1,1,0,1]),new Int32Array([-1,1,0,-1]),new Int32Array([-1,-1,0,1]),new Int32Array([-1,-1,0,-1]),new Int32Array([1,1,1,0]),new Int32Array([1,1,-1,0]),new Int32Array([1,-1,1,0]),new Int32Array([1,-1,-1,0]),new Int32Array([-1,1,1,0]),new Int32Array([-1,1,-1,0]),new Int32Array([-1,-1,1,0]),new Int32Array([-1,-1,-1,0])],_p=new Int32Array([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),_perm=function(){var _per=new Int32Array(512);for(var i=0;i<512;i++)_per[i]=_p[i&255];return _per}(),_simplex=[new Int32Array([0,1,2,3]),new Int32Array([0,1,3,2]),new Int32Array([0,0,0,0]),new Int32Array([0,2,3,1]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([1,2,3,0]),new Int32Array([0,2,1,3]),new Int32Array([0,0,0,0]),new Int32Array([0,3,1,2]),new Int32Array([0,3,2,1]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([1,3,2,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([1,2,0,3]),new Int32Array([0,0,0,0]),new Int32Array([1,3,0,2]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([2,3,0,1]),new Int32Array([2,3,1,0]),new Int32Array([1,0,2,3]),new Int32Array([1,0,3,2]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([2,0,3,1]),new Int32Array([0,0,0,0]),new Int32Array([2,1,3,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([2,0,1,3]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([3,0,1,2]),new Int32Array([3,0,2,1]),new Int32Array([0,0,0,0]),new Int32Array([3,1,2,0]),new Int32Array([2,1,0,3]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([0,0,0,0]),new Int32Array([3,1,0,2]),new Int32Array([0,0,0,0]),new Int32Array([3,2,0,1]),new Int32Array([3,2,1,0])],_dot=function(g,x,y,z,w){var n=g[0]*x+g[1]*y;return z&&(n+=g[2]*z,w&&(n+=g[3]*w)),n},_fastfloor=function(x){return x>=0?Math.floor(x):Math.floor(x-1)},SimplexNoise={noise:function(x,y,z,w){var numArgs=arguments.length,n0=0,n1=0,n2=0,n3=0,n4=0,s=function(){switch(numArgs){case 2:return(x+y)*_F2;case 3:return(x+y+z)*_F3;case 4:return(x+y+z+w)*_F4;default:throw new Error("Wrong arguments supplied to SimplexNoise.noise()")}}(),i=_fastfloor(x+s),j=_fastfloor(y+s),k=z!==undefined?_fastfloor(z+s):undefined,l=w!==undefined?_fastfloor(w+s):undefined,t=function(){switch(numArgs){case 2:return(i+j)*_G2;case 3:return(i+j+k)*_G3;case 4:return(i+j+k+l)*_G4}}(),x0=x-(i-t),y0=y-(j-t),z0=z!==undefined?z-(k-t):undefined,w0=w!==undefined?w-(l-t):undefined;return numArgs==2?function(){var i1,j1,x1,y1,x2,y2,ii,jj,t0,gi0,gi1,gi2,t2;return x0>y0?(i1=1,j1=0):(i1=0,j1=1),x1=x0-i1+_G2,y1=y0-j1+_G2,x2=x0+_G22,y2=y0+_G22,ii=i&255,jj=j&255,t0=.5-x0*x0-y0*y0,t0>0&&(t0*=t0,gi0=_perm[ii+_perm[jj]]%12,n0=t0*t0*_dot(_grad3[gi0],x0,y0)),t1=.5-x1*x1-y1*y1,t1>0&&(t1*=t1,gi1=_perm[ii+i1+_perm[jj+j1]]%12,n1=t1*t1*_dot(_grad3[gi1],x1,y1)),t2=.5-x2*x2-y2*y2,t2>0&&(t2*=t2,gi2=_perm[ii+1+_perm[jj+1]]%12,n2=t2*t2*_dot(_grad3[gi2],x2,y2)),70*(n0+n1+n2)}():numArgs==3?function(){var i1,j1,k1,i2,j2,k2,x1,y1,z1,x2,y2,z2,x3,y3,z3,ii,jj,kk,t0,gi0,t1,gi1,t2,gi2,t3,gi3;return x0>=y0?y0>=z0?(i1=1,j1=0,k1=0,i2=1,j2=1,k2=0):x0>=z0?(i1=1,j1=0,k1=0,i2=1,j2=0,k2=1):(i1=0,j1=0,k1=1,i2=1,j2=0,k2=1):y0<z0?(i1=0,j1=0,k1=1,i2=0,j2=1,k2=1):x0<z0?(i1=0,j1=1,k1=0,i2=0,j2=1,k2=1):(i1=0,j1=1,k1=0,i2=1,j2=1,k2=0),x1=x0-i1+_G3,y1=y0-j1+_G3,z1=z0-k1+_G3,x2=x0-i2+_F3,y2=y0-j2+_F3,z2=z0-k2+_F3,x3=x0-.5,y3=y0-.5,z3=z0-.5,ii=i&255,jj=j&255,kk=k&255,t0=.6-x0*x0-y0*y0-z0*z0,t0>0&&(t0*=t0,gi0=_perm[ii+_perm[jj+_perm[kk]]]%12,n0=t0*t0*_dot(_grad3[gi0],x0,y0,z0)),t1=.6-x1*x1-y1*y1-z1*z1,t1>0&&(t1*=t1,gi1=_perm[ii+i1+_perm[jj+j1+_perm[kk+k1]]]%12,n1=t1*t1*_dot(_grad3[gi1],x1,y1,z1)),t2=.6-x2*x2-y2*y2-z2*z2,t2>0&&(t2*=t2,gi2=_perm[ii+i2+_perm[jj+j2+_perm[kk+k2]]]%12,n2=t2*t2*_dot(_grad3[gi2],x2,y2,z2)),t3=.6-x3*x3-y3*y3-z3*z3,t3>0&&(t3*=t3,gi3=_perm[ii+1+_perm[jj+1+_perm[kk+1]]]%12,n3=t3*t3*_dot(_grad3[gi3],x3,y3,z3)),32*(n0+n1+n2+n3)}():function(){var i1,j1,k1,l1,i2,j2,k2,l2,i3,j3,k3,l3,sc=_simplex[function(){var c=0;return x0>y0&&(c=32),x0>z0&&(c|=16),y0>z0&&(c|=8),x0>w0&&(c|=4),y0>w0&&(c|=2),z0>w0&&(c|=1),c}()],x1,y1,z1,w1,x2,y2,z2,w2,x3,y3,z3,w3,x4,y4,z4,w4,ii,jj,kk,ll,t0,gi0,t1,gi1,t2,gi2,t3,gi3,t4,gi4;return i1=sc[0]>=3?1:0,j1=sc[1]>=3?1:0,k1=sc[2]>=3?1:0,l1=sc[3]>=3?1:0,i2=sc[0]>=2?1:0,j2=sc[1]>=2?1:0,k2=sc[2]>=2?1:0,l2=sc[3]>=2?1:0,i3=sc[0]>=1?1:0,j3=sc[1]>=1?1:0,k3=sc[2]>=1?1:0,l3=sc[3]>=1?1:0,x1=x0-i1+_G4,y1=y0-j1+_G4,z1=z0-k1+_G4,w1=w0-l1+_G4,x2=x0-i2+_G42,y2=y0-j2+_G42,z2=z0-k2+_G42,w2=w0-l2+_G42,x3=x0-i3+_G43,y3=y0-j3+_G43,z3=z0-k3+_G43,w3=w0-l3+_G43,x4=x0+_G44,y4=y0+_G44,z4=z0+_G44,w4=w0+_G44,ii=i&255,jj=j&255,kk=k&255,ll=l&255,t0=.6-x0*x0-y0*y0-z0*z0-w0*w0,t0>0&&(t0*=t0,gi0=_perm[ii+_perm[jj+_perm[kk+_perm[ll]]]]%32,n0=t0*t0*_dot(_grad4[gi0],x0,y0,z0,w0)),t1=.6-x1*x1-y1*y1-z1*z1-w1*w1,t1>0&&(t1*=t1,gi1=_perm[ii+i1+_perm[jj+j1+_perm[kk+k1+_perm[ll+l1]]]]%32,n1=t1*t1*_dot(_grad4[gi1],x1,y1,z1,w1)),t2=.6-x2*x2-y2*y2-z2*z2-w2*w2,t2>0&&(t2*=t2,gi2=_perm[ii+i2+_perm[jj+j2+_perm[kk+k2+_perm[ll+l2]]]]%32,n2=t2*t2*_dot(_grad4[gi2],x2,y2,z2,w2)),t3=.6-x3*x3-y3*y3-z3*z3-w3*w3,t3>0&&(t3*=t3,gi3=_perm[ii+i3+_perm[jj+j3+_perm[kk+k3+_perm[ll+l3]]]]%32,n3=t3*t3*_dot(_grad4[gi3],x3,y3,z3,w3)),t4=.6-x4*x4-y4*y4-z4*z4-w4*w4,t4>0&&(t4*=t4,gi4=_perm[ii+1+_perm[jj+1+_perm[kk+1+_perm[ll+1]]]]%32,n4=t4*t4*_dot(_grad4[gi4],x4,y4,z4,w4)),27*(n0+n1+n2+n3+n4)}()}};module.exports=SimplexNoise}),define("toxi/math/noise",["require","exports","module","./noise/PerlinNoise","./noise/simplexNoise"],function(require,exports,module){module.exports={PerlinNoise:require("./noise/PerlinNoise"),simplexNoise:require("./noise/simplexNoise")}}),define("toxi/math/waves/WaveState",["require","exports","module"],function(require,exports,module){var WaveState=function(phase,frequency,amp,offset){this.phase=phase,this.frequency=frequency,this.amp=amp,this.offset=offset};module.exports=WaveState}),define("toxi/math/waves/AbstractWave",["require","exports","module","./WaveState"],function(require,exports,module){var WaveState=require("./WaveState"),AbstractWave=function(phase,freq,amp,offset){if(phase!==undefined||freq!==undefined||amp!==undefined||offset!==undefined)this.setPhase(phase),this.frequency=freq,amp===undefined&&(amp=1),offset===undefined&&(offset=1),this.amp=amp,this.offset=offset};AbstractWave.prototype={cyclePhase:function(freq){return freq===undefined&&(freq=0),this.phase=(this.phase+freq)%AbstractWave.TWO_PI,this.phase<0&&(this.phase+=AbstractWave.TWO_PI),this.phase},getClass:function(){return"AbstractWave"},pop:function(){if(this.stateStack===undefined||this.stateStack!==undefined&&this.stateStack.length<=0)console.log(this.toString()),console.log("no wave states on stack");else{var s=this.stateStack.pop();this.phase=s.phase,this.frequency=s.frequency,this.amp=s.amp,this.offset=s.offset}},push:function(){this.stateStack===undefined&&(this.stateStack=[]),this.stateStack.push(new WaveState(this.phase,this.frequency,this.amp,this.offset))},reset:function(){this.phase=this.origPhase},setPhase:function(phase){this.phase=phase,this.cyclePhase(),this.origPhase=phase},toString:function(){return this.getClass()+" phase:"+this.phase+" frequency: "+this.frequency+" amp: "+this.amp+" offset: "+this.offset},update:function(){console.log(this.getClass()+" this should be overridden")}},AbstractWave.PI=3.141592653589793,AbstractWave.TWO_PI=2*AbstractWave.PI,AbstractWave.hertzToRadians=function(hz,sampleRate){return hz/sampleRate*AbstractWave.TWO_PI},AbstractWave.radiansToHertz=function(f,sampleRate){return f/AbstractWave.TWO_PI*sampleRate},module.exports=AbstractWave}),define("toxi/math/waves/AMFMSineWave",["require","exports","module","../../internals","./AbstractWave"],function(require,exports,module){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),AMFMSineWave=function(a,b,c,d,e){typeof c=="number"?(AbstractWave.apply(this,[a,b,1,c]),this.amod=d,this.fmod=e):(AbstractWave.apply(this,[a,b]),this.amod=c,this.fmod=d)};extend(AMFMSineWave,AbstractWave),AMFMSineWave.prototype.getClass=function(){return"AMFMSineWave"},AMFMSineWave.prototype.pop=function(){this.parent.pop.call(this),this.amod.pop(),this.fmod.pop()},AMFMSineWave.prototype.push=function(){this.parent.push.call(this),this.amod.push(),this.fmod.push()},AMFMSineWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset(),this.amod.reset()},AMFMSineWave.prototype.update=function(){return this.amp=this.amod.update(),this.value=this.amp*Math.sin(this.phase)+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=AMFMSineWave}),define("toxi/math/waves/ConstantWave",["require","exports","module","../../internals","./AbstractWave"],function(require,exports,module){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),ConstantWave=function(value){AbstractWave.apply(this),this.value=value};extend(ConstantWave,AbstractWave),ConstantWave.prototype.getClass=function(){return"ConstantWave"},ConstantWave.prototype.update=function(){return this.value},module.exports=ConstantWave}),define("toxi/math/waves/FMHarmonicSquareWave",["require","exports","module","../../internals","./AbstractWave"],function(require,exports,module){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),FMHarmonicSquareWave=function(a,b,c,d,e){this.maxHarmonics=3,typeof c=="number"?(e===undefined&&(e=new ConstantWave(0)),AbstractWave.apply(this,[a,b,c,d]),this.fmod=e):(AbstractWave.apply(this,[a,b]),this.fmod=c)};extend(FMHarmonicSquareWave,AbstractWave),FMHarmonicSquareWave.prototype.getClass=function(){return"FMHarmonicSquareWave"},FMHarmonicSquareWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMHarmonicSquareWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMHarmonicSquareWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMHarmonicSquareWave.prototype.update=function(){this.value=0;for(var i=1;i<=this.maxHarmonics;i+=2)this.value+=1/i*Math.sin(i*this.phase);return this.value*=this.amp,this.value+=this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMHarmonicSquareWave}),define("toxi/math/waves/FMSawtoothWave",["require","exports","module","../../internals","./AbstractWave"],function(require,exports,module){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),FMSawtoothWave=function(a,b,c,d,e){typeof c=="number"?(AbstractWave.apply(this,[a,b,c,d]),this.fmod=e):(AbstractWave.apply(this,[a,b]),this.fmod=c)};extend(FMSawtoothWave,AbstractWave),FMSawtoothWave.prototype.getClass=function(){return"FMSawtoothWave"},FMSawtoothWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMSawtoothWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMSawtoothWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMSawtoothWave.prototype.update=function(){return this.value=(this.phase/AbstractWave.TWO_PI*2-1)*this.amp+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMSawtoothWave}),define("toxi/math/waves/FMSineWave",["require","exports","module","../../internals","./AbstractWave"],function(require,exports,module){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),FMSineWave=function(a,b,c,d,e){typeof c=="number"?(AbstractWave.apply(this,[a,b,c,d]),this.fmod=e):(AbstractWave.apply(this,[a,b]),this.fmod=c)};extend(FMSineWave,AbstractWave),FMSineWave.prototype.getClass=function(){return"FMSineWave"},FMSineWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMSineWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMSineWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMSineWave.prototype.update=function(){return this.value=Math.sin(this.phase)*this.amp+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMSineWave}),define("toxi/math/waves/FMSquareWave",["require","exports","module","../../internals","./AbstractWave","./ConstantWave"],function(require,exports,module){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),ConstantWave=require("./ConstantWave"),FMSquareWave=function(a,b,c,d,e){typeof c=="number"?e===undefined?AbstractWave.apply(this,[a,b,c,d,new ConstantWave(0)]):(AbstractWave.apply(this,[a,b,c,d]),this.fmod=e):(AbstractWave.apply(this,[a,b]),this.fmod=c)};extend(FMSquareWave,AbstractWave),FMSquareWave.prototype.getClass=function(){return"FMSquareWave"},FMSquareWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMSquareWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMSquareWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMSquareWave.prototype.update=function(){return this.value=(this.phase/AbstractWave.TWO_PI<.5?1:-1)*this.amp+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMSquareWave}),define("toxi/math/waves/FMTriangleWave",["require","exports","module","../../internals","../mathUtils","./AbstractWave","./ConstantWave"],function(require,exports,module){var extend=require("../../internals").extend,mathUtils=require("../mathUtils"),AbstractWave=require("./AbstractWave"),ConstantWave=require("./ConstantWave"),FMTriangleWave=function(a,b,c,d,e){typeof c=="number"?e!==undefined?(AbstractWave.apply(this,[a,b,c,d]),this.fmod=e):AbstractWave.apply(this,[a,b,c,d,new ConstantWave(0)]):AbstractWave.apply(this,[a,b,1,0])};extend(FMTriangleWave,AbstractWave),FMTriangleWave.prototype.getClass=function(){return"FMTriangleWave"},FMTriangleWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMTriangleWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMTriangleWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMTriangleWave.prototype.update=function(){return this.value=2*this.amp*(Math.abs(AbstractWave.PI-this.phase)*mathUtils.INV_PI-.5)+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMTriangleWave}),define("toxi/math/waves/SineWave",["require","exports","module","../../internals","./AbstractWave"],function(require,exports,module){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),SineWave=function(phase,freq,amp,offset){AbstractWave.apply(this,[phase,freq,amp,offset])};extend(SineWave,AbstractWave),SineWave.prototype.getClass=function(){return"SineWave"},SineWave.prototype.pop=function(){this.parent.pop.call(this)},SineWave.prototype.push=function(){this.parent.push.call(this)},SineWave.prototype.update=function(){return this.value=Math.sin(this.phase)*this.amp+this.offset,this.cyclePhase(this.frequency),this.value},module.exports=SineWave}),define("toxi/math/waves",["require","exports","module","./waves/AbstractWave","./waves/AMFMSineWave","./waves/ConstantWave","./waves/FMHarmonicSquareWave","./waves/FMSawtoothWave","./waves/FMSineWave","./waves/FMSquareWave","./waves/FMTriangleWave","./waves/SineWave","./waves/WaveState"],function(require,exports,module){module.exports={AbstractWave:require("./waves/AbstractWave"),AMFMSineWave:require("./waves/AMFMSineWave"),ConstantWave:require("./waves/ConstantWave"),FMHarmonicSquareWave:require("./waves/FMHarmonicSquareWave"),FMSawtoothWave:require("./waves/FMSawtoothWave"),FMSineWave:require("./waves/FMSineWave"),FMSquareWave:require("./waves/FMSquareWave"),FMTriangleWave:require("./waves/FMTriangleWave"),SineWave:require("./waves/SineWave"),WaveState:require("./waves/WaveState")}}),define("toxi/math",["require","exports","module","./math/BezierInterpolation","./math/CircularInterpolation","./math/CosineInterpolation","./math/DecimatedInterpolation","./math/ExponentialInterpolation","./math/Interpolation2D","./math/LinearInterpolation","./math/mathUtils","./math/mathUtils","./math/ScaleMap","./math/SigmoidInterpolation","./math/SinCosLUT","./math/ThresholdInterpolation","./math/ZoomLensInterpolation","./math/noise","./math/waves"],function(require,exports,module){module.exports={BezierInterpolation:require("./math/BezierInterpolation"),CircularInterpolation:require("./math/CircularInterpolation"),CosineInterpolation:require("./math/CosineInterpolation"),DecimatedInterpolation:require("./math/DecimatedInterpolation"),ExponentialInterpolation:require("./math/ExponentialInterpolation"),Interpolation2D:require("./math/Interpolation2D"),LinearInterpolation:require("./math/LinearInterpolation"),mathUtils:require("./math/mathUtils"),MathUtils:require("./math/mathUtils"),ScaleMap:require("./math/ScaleMap"),SigmoidInterpolation:require("./math/SigmoidInterpolation"),SinCosLUT:require("./math/SinCosLUT"),ThresholdInterpolation:require("./math/ThresholdInterpolation"),ZoomLensInterpolation:require("./math/ZoomLensInterpolation")},module.exports.noise=require("./math/noise"),module.exports.waves=require("./math/waves")}),define("toxi/physics2d/ParticlePath2D",["require","exports","module","../internals","../geom/Spline2D"],function(require,exports,module){var internals=require("../internals"),Spline2D=require("../geom/Spline2D"),ParticlePath2D=function(points){toxi.Spline2D.call(this,points),this.particles=[]};internals.extend(ParticlePath2D,Spline2D);var _createSingleParticle=function(pos,mass){return new VerletParticle2D(pos,mass)};ParticlePath2D.prototype.createParticles=function(physics,subDiv,step,mass){this.particles=[],this.computeVertices(subDiv);var i=0,dv=this.getDecimatedVertices(step,!0);for(i=0;i<dv;i++){var p=_createSingleParticle(v,mass);this.particles.push(p),physics.addParticle(p)}return this.particles},module.exports=ParticlePath2D}),define("toxi/physics2d/VerletParticle2D",["require","exports","module","../internals","../geom/Vec2D"],function(require,exports,module){var internals=require("../internals"),Vec2D=require("../geom/Vec2D"),VerletParticle2D=function(x,y,w){this.force=new Vec2D,internals.tests.hasXY(x)&&(internals.tests.isVerletParticle2D(x)?(y=x.y,w=x.weight,x=x.x,this.isLocked=x.isLocked):y===undefined?(y=x.y,w=1,x=x.x):(w=y,y=x.y,x=x.x)),Vec2D.apply(this,[x,y]),this.isLocked=!1,this.prev=new Vec2D(this),this.temp=new Vec2D,w=w||1,this.setWeight(w)};internals.extend(VerletParticle2D,Vec2D),VerletParticle2D.prototype.addBehavior=function(behavior,timeStep){this.behaviors===undefined&&(this.behaviors=[]);if(behavior===undefined)throw{name:"TypeError",message:"behavior was undefined"};return timeStep=timeStep===undefined?1:timeStep,behavior.configure(timeStep),this.behaviors.push(behavior),this},VerletParticle2D.prototype.addConstraint=function(c){return this.constraints===undefined&&(this.constraints=[]),this.constraints.push(c),this},VerletParticle2D.prototype.addForce=function(f){return this.force.addSelf(f),this},VerletParticle2D.prototype.addVelocity=function(v){return this.prev.subSelf(v),this},VerletParticle2D.prototype.applyBehaviors=function(){if(this.behaviors!==undefined){var i=0;for(i=0;i<this.behaviors.length;i++)this.behaviors[i].applyBehavior(this)}},VerletParticle2D.prototype.applyConstraints=function(){if(this.constraints!==undefined){var i=0;for(i=0;i<this.constraints.length;i++)this.constraints[i].applyConstraint(this)}},VerletParticle2D.prototype.clearForce=function(){return this.force.clear(),this},VerletParticle2D.prototype.clearVelocity=function(){return this.prev.set(this),this},VerletParticle2D.prototype.getInvWeight=function(){return this.invWeight},VerletParticle2D.prototype.getPreviousPosition=function(){return this.prev},VerletParticle2D.prototype.getVelocity=function(){return this.sub(this.prev)},VerletParticle2D.prototype.getWeight=function(){return this.weight},VerletParticle2D.prototype.lock=function(){return this.isLocked=!0,this},VerletParticle2D.prototype.removeAllBehaviors=function(){return this.behaviors=[],this},VerletParticle2D.prototype.removeAllConstraints=function(){return this.constraints=[],this},VerletParticle2D.prototype.removeBehavior=function(b){return internals.removeItemFrom(b,this.behaviors)},VerletParticle2D.prototype.removeConstraint=function(c){return internals.removeItemFrom(c,this.constraints)},VerletParticle2D.prototype.scaleVelocity=function(scl){return this.prev.interpolateToSelf(this,1-scl),this},VerletParticle2D.prototype.setPreviousPosition=function(p){return this.prev.set(p),this},VerletParticle2D.prototype.setWeight=function(w){this.weight=w,this.invWeight=w!==0?1/w:0},VerletParticle2D.prototype.unlock=function(){return this.clearVelocity(),this.isLocked=!1,this},VerletParticle2D.prototype.update=function(){if(!this.isLocked){var that=this;this.applyBehaviors(),function(){that.temp.set(that),that.addSelf(that.sub(that.prev).addSelf(that.force.scale(that.weight))),that.prev.set(that.temp),that.force.clear()}(),this.applyConstraints()}},module.exports=VerletParticle2D}),define("toxi/physics2d/VerletSpring2D",["require","exports","module"],function(require,exports,module){var VerletSpring2D=function(a,b,len,str){this.a=a,this.b=b,this.restLength=len,this.strength=str};VerletSpring2D.EPS=1e-6,VerletSpring2D.prototype={getRestLength:function(){return this.restLength},getStrength:function(){return this.strength},lockA:function(s){return this.isALocked=s,this},lockB:function(s){return this.isALocked=s,this},setRestLength:function(len){return this.restLength=len,this.restLengthSquared=len*len,this},setStrength:function(strength){return this.strength=strength,this},update:function(applyConstraints){var delta=this.b.sub(this.a),dist=delta.magnitude()+VerletSpring2D.EPS,normDistStrength=(dist-this.restLength)/(dist*(this.a.invWeight+this.b.invWeight))*this.strength;!this.a.isLocked&&!this.isALocked&&(this.a.addSelf(delta.scale(normDistStrength*this.a.invWeight)),applyConstraints&&this.a.applyConstraints()),!this.b.isLocked&&!this.isBLocked&&(this.b.addSelf(delta.scale(-normDistStrength*this.b.invWeight)),applyConstraints&&this.b.applyConstraints())}},module.exports=VerletSpring2D}),define("toxi/physics2d/ParticleString2D",["require","exports","module","./VerletParticle2D","./VerletSpring2D"],function(require,exports,module){var VerletParticle2D=require("./VerletParticle2D"),VerletSpring2D=require("./VerletSpring2D"),ParticleString2D=function(){var opts={physics:undefined,plist:undefined,pos:undefined,step:undefined,num:undefined,mass:undefined,strength:undefined},is6ParamConstructor=!1;if(arguments.length===0)throw new Error("Incorrect Parameters");if(arguments.length==1){var arg=arguments[0];for(var prop in arg)opts[prop]=arg[prop]}else opts.physics=arguments[0],arguments.length==6?(opts.pos=arguments[1],opts.step=arguments[2],opts.num=arguments[3],opts.mass=arguments[4],opts.strength=arguments[5]):(opts.plist=arguments[1],opts.strength=arguments[2]);opts.num!==undefined&&opts.pos!==undefined&&opts.step!==undefined&&opts.mass!==undefined&&(is6ParamConstructor=!0);if(!is6ParamConstructor&&opts.plist===undefined)throw new Error("Incorrect Parameters, please supply plist or num, pos, step & mass");this.physics=opts.physics,this.links=[];var prev,p,s,strength,i=0;if(is6ParamConstructor){var pos=opts.pos.copy(),step=opts.step,mass=opts.mass,len=step.magnitude();this.particles=[],strength=opts.strength;for(i=0;i<opts.num;i++)p=new VerletParticle2D(pos.copy(),mass),this.particles.push(p),this.physics.particles.push(p),prev!==undefined&&(s=this.createSpring(prev,p,len,strength),this.links.push(s),this.physics.addSpring(s)),prev=p,pos.addSelf(step)}else{strength=opts.strength,this.particles=opts.plist||[];for(i=0;i<this.particles.length;i++)p=this.particles[i],this.physics.addParticle(p),prev!==undefined&&(s=this.createSpring(prev,p,prev.distanceTo(p),strength),this.links.push(s),this.physics.addSpring(s)),prev=p}};ParticleString2D.prototype={clear:function(){for(var i=0,len=this.links.length;i<len;i++)this.physics.removeSpringElements(this.links[i]);this.particles=[],this.links=[]},createSpring:function(a,b,len,strength){return new VerletSpring2D(a,b,len,strength)},getHead:function(){return this.particles[0]},getNumParticles:function(){return this.particles.length},getTail:function(){return this.particles[this.particles.length-1]}},module.exports=ParticleString2D}),define("toxi/physics2d/PullBackString2D",["require","exports","module","../internals","./VerletSpring2D"],function(require,exports,module){var internals=require("../internals"),VerletSpring2D=require("./VerletSpring2D"),PullBackString2D=function(a,b,strength){VerletSpring2D.apply(this,[a,b,0,strength]),a.lock(),this.setRestLength(.5)};internals.extend(PullBackString2D,VerletSpring2D),PullBackString2D.prototype.update=function(applyConstraints){this.b.distanceToSquared(this.a)>this.restLengthSquared&&this.parent.update.call(this,applyConstraints)},module.exports=PullBackString2D}),define("toxi/physics2d/VerletConstrainedSpring2D",["require","exports","module","../internals","./VerletSpring2D"],function(require,exports,module){var internals=require("../internals"),VerletSpring2D=require("./VerletSpring2D"),VerletConstrainedSpring2D=function(particleA,particleB,len,str,limit){VerletSpring2D.call(this,particleA,particleB,len,str),this.limit=limit===undefined?Number.MAX_VALUE:limit};internals.extend(VerletConstrainedSpring2D,VerletSpring2D),VerletConstrainedSpring2D.update=function(applyConstraints){var delta=this.b.sub(this.a),dist=delta.magnitude()+VerletSpring2D.EPS,normDistStrength=(dist-this.restLength)/(dist*(this.a.invWeight+this.b.invWeight))*this.strength;!this.a.isLocked&&!this.isALocked&&(this.a.addSelf(delta.scale(normDistStrength*this.a.invWeight).limit(this.limit)),applyConstraints&&this.a.applyConstraints()),!this.b.isLocked&&!this.isBLocked&&(this.b.subSelf(delta.scale(normDistStrength*this.b.invWeight).limit(this.limit)),applyConstraints&&this.b.applyConstraints())},module.exports=VerletConstrainedSpring2D}),define("toxi/physics2d/VerletMinDistanceSpring2D",["require","exports","module","../internals","./VerletSpring2D"],function(require,exports,module){var internals=require("../internals"),VerletSpring2D=require("./VerletSpring2D"),VerletMinDistanceSpring2D=function(particleA,particleB,len,str){VerletSpring2D.call(this,particleA,particleB,len,str),this.setRestLength(len)};internals.extend(VerletMinDistanceSpring2D,VerletSpring2D),VerletMinDistanceSpring2D.prototype.update=function(applyConstraints){this.b.distanceToSquared(this.a)<this.restLengthSquared&&this.parent.update.call(this,applyConstraints)},module.exports=VerletMinDistanceSpring2D}),define("toxi/physics2d/behaviors/ConstantForceBehavior",["require","exports","module","../../geom/Vec2D"],function(require,exports,module){var Vec2D=require("../../geom/Vec2D"),ConstantForceBehavior=function(force){this.force=force,this.scaleForce=new Vec2D,this.timeStep=0};ConstantForceBehavior.prototype={applyBehavior:function(p){p.addForce(this.scaledForce)},configure:function(timeStep){this.timeStep=timeStep,this.setForce(this.force)},getForce:function(){return this.force},setForce:function(forceVec){this.force=forceVec,this.scaledForce=this.force.scale(this.timeStep)},toString:function(){return"behavior force: "+this.force+" scaledForce: "+this.scaledForce+" timeStep: "+this.timeStep}},module.exports=ConstantForceBehavior}),define("toxi/physics2d/behaviors/GravityBehavior",["require","exports","module","../../internals","./ConstantForceBehavior"],function(require,exports,module){var lib=require("../../internals"),ConstantForceBehavior=require("./ConstantForceBehavior"),GravityBehavior=function(gravityVec){ConstantForceBehavior.apply(this,[gravityVec])};lib.extend(GravityBehavior,ConstantForceBehavior),GravityBehavior.prototype.configure=function(timeStep){this.timeStep=timeStep,this.scaledForce=this.force.scale(timeStep*timeStep)},module.exports=GravityBehavior}),define("toxi/physics2d/VerletPhysics2D",["require","exports","module","../internals","./behaviors/GravityBehavior","../geom/Rect","../geom/Vec2D"],function(require,exports,module){var internals=require("../internals"),GravityBehavior=require("./behaviors/GravityBehavior"),Rect=require("../geom/Rect"),Vec2D=require("../geom/Vec2D"),VerletPhysics2D=function(gravity,numIterations,drag,timeStep){var opts={numIterations:50,drag:0,timeStep:1},args;arguments.length==1&&(arguments[0].gravity||arguments[0].numIterations||arguments[0].timeStep||arguments[0].drag)&&(args=arguments[0],args.gravity!==undefined&&(gravity=args.gravity),args.numIterations!==undefined&&(opts.numIterations=args.gravity),args.drag!==undefined&&(opts.drag=args.drag),args.timeStep!==undefined&&(opts.timeStep=args.timeStep)),this.behaviors=[],this.particles=[],this.springs=[],this.numIterations=opts.numIterations,this.timeStep=opts.timeStep,this.setDrag(opts.drag),gravity&&(internals.tests.isParticleBehavior(gravity)?this.addBehavior(gravity):internals.tests.hasXY(gravity)&&this.addBehavior(new GravityBehavior(new Vec2D(gravity))))};VerletPhysics2D.addConstraintToAll=function(c,list){for(var i=0;i<list.length;i++)list[i].addConstraint(c)},VerletPhysics2D.removeConstraintFromAll=function(c,list){for(var i=0;i<list.length;i++)list[i].removeConstraint(c)},VerletPhysics2D.prototype={addBehavior:function(behavior){behavior.configure(this.timeStep),this.behaviors.push(behavior)},addParticle:function(p){return this.particles.push(p),this},addSpring:function(s){return this.getSpring(s.a,s.b)===undefined&&this.springs.push(s),this},clear:function(){return this.particles=[],this.springs=[],this},constrainToBounds:function(){var p,i=0;for(i=0;i<this.particles.length;i++)p=this.particles[i],p.bounds!==undefined&&p.constrain(p.bounds);if(this.worldBounds!==undefined)for(i=0;i<this.particles.length;i++)p=this.particles[i],p.constrain(this.worldBounds)},getCurrentBounds:function(){var min=new Vec2D(Number.MAX_VALUE,Number.MAX_VALUE),max=new Vec2D(Number.MIN_VALUE,Number.MIN_VALUE),i=0,p;for(i=0;i<this.particles.length;i++)p=this.particles[i],min.minSelf(p),max.maxSelf(p);return new Rect(min,max)},getDrag:function(){return 1-this.drag},getNumIterations:function(){return this.numIterations},getSpring:function(a,b){var i=0;for(i=0;i<this.springs.length;i++){var s=this.springs[i];if(s.a===a&&s.b===b||s.a===b&&s.b===b)return s}return undefined},getTimeStep:function(){return this.timeStep},getWorldBounds:function(){return this.worldBounds},removeBehavior:function(c){return internals.removeItemFrom(c,this.behaviors)},removeParticle:function(p){return internals.removeItemFrom(p,this.particles)},removeSpring:function(s){return internals.removeItemFrom(s,this.springs)},removeSpringElements:function(s){return this.removeSpring(s)!==undefined?this.removeParticle(s.a)&&this.removeParticle(s.b):!1},setDrag:function(drag){this.drag=1-drag},setNumIterations:function(numIterations){this.numIterations=numIterations},setTimeStep:function(timeStep){this.timeStep=timeStep;var i=0;for(i=0;i<this.behaviors.length;i++){var b=this.behaviors[i];b.configure(timeStep)}},setWorldBounds:function(world){return this.worldBounds=world,this},update:function(){return this.updateParticles(),this.updateSprings(),this.constrainToBounds(),this},updateParticles:function(){var i=0,j=0,b,p;for(i=0;i<this.behaviors.length;i++){b=this.behaviors[i];for(j=0;j<this.particles.length;j++)p=this.particles[j],b.applyBehavior(p)}for(j=0;j<this.particles.length;j++)p=this.particles[j],p.scaleVelocity(this.drag),p.update()},updateSprings:function(){var i=0,j=0;for(i=this.numIterations;i>0;i--)for(j=0;j<this.springs.length;j++){var s=this.springs[j];s.update(i===1)}}},module.exports=VerletPhysics2D}),define("toxi/physics2d/behaviors/AttractionBehavior",["require","exports","module"],function(require,exports,module){var AttractionBehavior=function(attractor,radius,strength,jitter){if(arguments.length<3)throw{name:"IncorrectParameters",message:"Constructor received incorrect Parameters"};this.jitter=jitter||0,this.attractor=attractor,this.strength=strength,this.setRadius(radius)};AttractionBehavior.prototype={applyBehavior:function(p){var delta=this.attractor.sub(p),dist=delta.magSquared();if(dist<this.radiusSquared){var f=delta.normalizeTo(1-dist/this.radiusSquared).jitter(this.jitter).scaleSelf(this.attrStrength);p.addForce(f)}},configure:function(timeStep){this.timeStep=timeStep,this.setStrength(this.strength)},getAttractor:function(){return this.attractor},getJitter:function(){return this.jitter},getRadius:function(){return this.radius},getStrength:function(){return this.strength},setAttractor:function(attractor){this.attractor=attractor},setJitter:function(jitter){this.jitter=jitter},setRadius:function(r){this.radius=r,this.radiusSquared=r*r},setStrength:function(strength){this.strength=strength,this.attrStrength=strength*this.timeStep}},module.exports=AttractionBehavior}),define("toxi/physics2d/behaviors",["require","exports","module","./behaviors/AttractionBehavior","./behaviors/ConstantForceBehavior","./behaviors/GravityBehavior"],function(require,exports,module){module.exports={AttractionBehavior:require("./behaviors/AttractionBehavior"),ConstantForceBehavior:require("./behaviors/ConstantForceBehavior"),GravityBehavior:require("./behaviors/GravityBehavior")}}),define("toxi/physics2d/constraints/AngularConstraint",["require","exports","module","../../math/mathUtils","../../geom/Vec2D"],function(require,exports,module){var mathUtils=require("../../math/mathUtils"),Vec2D=require("../../geom/Vec2D"),AngularConstraint=function(theta_p,theta){if(arguments.length>1){var p=theta_p;this.theta=theta,this.rootPos=new Vec2D(p)}else this.rootPos=new Vec2D,this.theta=theta_p;parseInt(this.theta,10)!=this.theta&&(this.theta=mathUtils.radians(this.theta))};AngularConstraint.prototype.applyConstraint=function(p){var delta=p.sub(this.rootPos),heading=toxi.MathUtils.floor(delta.heading()/this.theta)*this.theta;p.set(this.rootPos.add(toxi.Vec2D.fromTheta(heading).scaleSelf(delta.magnitude())))},module.exports=AngularConstraint}),define("toxi/physics2d/constraints/AxisConstraint",["require","exports","module"],function(require,exports,module){var AxisConstraint=function(axis,constraintAmount){this.axis=axis,this.constraint=constraintAmount};AxisConstraint.prototype.applyConstraint=function(p){p.setComponent(this.axis,this.constraint)},module.exports=AxisConstraint}),define("toxi/physics2d/constraints/CircularConstraint",["require","exports","module"],function(require,exports,module){var CircularConstraint=function(a,b){arguments.length==1?this.circle=a:(console.log("a: "+a),this.circle=new toxi.Circle(a,b))};CircularConstraint.prototype.applyConstraint=function(p){this.circle.containsPoint(p)&&p.set(this.circle.add(p.sub(this.circle).normalizeTo(this.circle.getRadius())))},module.exports=CircularConstraint}),define("toxi/physics2d/constraints/MaxConstraint",["require","exports","module"],function(require,exports,module){var MaxConstraint=function(axis,threshold){this.axis=axis,this.threshold=threshold};MaxConstraint.prototype.applyConstraint=function(p){p.getComponent(this.axis)>this.threshold&&p.setComponent(this.axis,this.threshold)},module.exports=MaxConstraint}),define("toxi/physics2d/constraints/MinConstraint",["require","exports","module"],function(require,exports,module){var MinConstraint=function(axis,threshold){this.axis=axis,this.threshold=threshold};MinConstraint.prototype.applyConstraint=function(p){p.getComponent(this.axis)<this.threshold&&p.setComponent(this.axis,this.threshold)},module.exports=MinConstraint}),define("toxi/physics2d/constraints/RectConstraint",["require","exports","module"],function(require,exports,module){var RectConstraint=function(a,b){arguments.length==1?this.rect=a.copy():arguments.length>1&&(this.rect=new toxi.Rect(a,b)),this.intersectRay=new toxi.Ray2D(this.rect.getCentroid(),new toxi.Vec2D)};RectConstraint.prototype={applyConstraint:function(p){this.rect.containsPoint(p)&&p.set(this.rect.intersectsRay(this.intersectRay.setDirection(this.intersectRay.sub(p)),0,Number.MAX_VALUE))},getBox:function(){return this.rect.copy()},setBox:function(rect){this.rect=rect.copy(),this.intersectRay.set(this.rect.getCentroid())}},module.exports=RectConstraint}),define("toxi/physics2d/constraints",["require","exports","module","./constraints/AngularConstraint","./constraints/AxisConstraint","./constraints/CircularConstraint","./constraints/MaxConstraint","./constraints/MinConstraint","./constraints/RectConstraint"],function(require,exports,module){module.exports={AngularConstraint:require("./constraints/AngularConstraint"),AxisConstraint:require("./constraints/AxisConstraint"),CircularConstraint:require("./constraints/CircularConstraint"),MaxConstraint:require("./constraints/MaxConstraint"),MinConstraint:require("./constraints/MinConstraint"),RectConstraint:require("./constraints/RectConstraint")}}),define("toxi/physics2d",["require","exports","module","./physics2d/ParticlePath2D","./physics2d/ParticleString2D","./physics2d/PullBackString2D","./physics2d/VerletConstrainedSpring2D","./physics2d/VerletMinDistanceSpring2D","./physics2d/VerletParticle2D","./physics2d/VerletPhysics2D","./physics2d/VerletSpring2D","./physics2d/behaviors","./physics2d/constraints"],function(require,exports,module){module.exports={ParticlePath2D:require("./physics2d/ParticlePath2D"),ParticleString2D:require("./physics2d/ParticleString2D"),PullBackString2D:require("./physics2d/PullBackString2D"),VerletConstrainedSpring2D:require("./physics2d/VerletConstrainedSpring2D"),VerletMinDistanceSpring2D:require("./physics2d/VerletMinDistanceSpring2D"),VerletParticle2D:require("./physics2d/VerletParticle2D"),VerletPhysics2D:require("./physics2d/VerletPhysics2D"),VerletSpring2D:require("./physics2d/VerletSpring2D")},module.exports.behaviors=require("./physics2d/behaviors"),module.exports.constraints=require("./physics2d/constraints")}),define("toxi/processing/ToxiclibsSupport",["require","exports","module","../geom/Matrix4x4","../geom/Vec3D","../geom/mesh/TriangleMesh"],function(require,exports,module){var Matrix4x4=require("../geom/Matrix4x4"),Vec3D=require("../geom/Vec3D"),TriangleMesh=require("../geom/mesh/TriangleMesh"),ToxiclibsSupport=function(processing,optional_gfx){if(typeof Processing=="undefined")throw new Error("Processing.js has not been loaded");this.sketch=processing,this.app=processing,optional_gfx!==undefined?this.gfx=processing:this.gfx=this.app,this._normalMap=(new Matrix4x4).translateSelf(128,128,128).scaleSelf(127)};ToxiclibsSupport.prototype={box:function(aabb,smooth){var mesh=aabb.toMesh();smooth===undefined&&(smooth=!1),smooth&&mesh.computeVertexNormals(),this.mesh(mesh,smooth,0)},circle:function(p,radius){this.gfx.ellipse(p.x,p.y,radius,radius)},cone:function(){var cone=arguments[0],res=6,thetaOffset=0,topClosed=!0,bottomClosed=!0,smooth=!1;arguments.length==5?(res=arguments[1],topClosed=arguments[2],bottomClosed=arguments[3],smooth=arguments[4]):arguments.length==3&&(res=arguments[1],smooth=arguments[2]);var mesh=cone.toMesh({mesh:new TriangleMesh,steps:res,thetaOffset:thetaOffset,topClosed:topClosed,bottomClosed:bottomClosed});smooth&&mesh.computeVertexNormals(),window.mesh=mesh,this.mesh(mesh,smooth,0)},cylinder:function(cyl,res,smooth){if(arguments.length==1)this.mesh(cyl.toMesh(),!1,0);else{var mesh=cyl.toMesh(res,0);smooth===undefined&&(smooth=!1),smooth&&mesh.computeVertexNormals(),this.mesh(mesh,smooth,0)}},ellipse:function(e,ellipseMode){var r=e.getRadii();ellipseMode===undefined&&(ellipseMode=this.app.CENTER),ellipseMode===this.app.CENTER?this.gfx.ellipse(e.x,e.y,r.x*2,r.y*2):ellipseMode===this.app.RADIUS?this.gfx.ellipse(e.x,e.y,r.x*2,r.y*2):(ellipseMode===this.app.CORNER||this.gfx.ellipseMode===this.app.CORNERS)&&this.gfx.ellipse(e.x-r.x,e.y-r.y,r.x*2,r.y*2)},getGraphics:function(){return this.gfx},line:function(){var a,b;if(arguments.length==1){var line=arguments[0];a=line.a,b=line.b}else a=arguments[0],b=arguments[1];a.z===undefined?this.gfx.line(a.x,a.y,b.x,b.y):this.gfx.line(a.x,a.y,a.z,b.x,b.y,b.z)},lineStrip2D:function(points){this.processVertices2D(points,this.app.POLYGON,!1)},lineStrip3D:function(points){this.processVertices3D(points,this.app.POLYGON,!1)},mesh:function(mesh,smooth,normalLength){smooth===undefined&&(smooth=!1),normalLength===undefined&&(normalLength=0),this.gfx.beginShape(this.app.TRIANGLES);var i=0,len=mesh.faces.length;if(smooth)for(i=0;i<len;i++){var f=mesh.faces[i];this.gfx.normal(f.a.normal.x,f.a.normal.y,f.a.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.normal(f.b.normal.x,f.b.normal.y,f.b.normal.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.normal(f.c.normal.x,f.c.normal.y,f.c.normal.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z)}else for(var i=0;i<len;i++){var f=mesh.faces[i];this.gfx.normal(f.normal.x,f.normal.y,f.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z)}this.gfx.endShape();if(normalLength>0){var strokeCol=0,isStroked=this.gfx.stroke;isStroked&&(strokeCol=this.gfx.strokeColor),len=mesh.vertices.length;if(smooth)for(i=0;i<len;i++){var v=mesh.vertices[i],w=v.add(v.normal.scale(normalLength));n=v.normal.scale(127),this.gfx.stroke(n.x+128,n.y+128,n.z+128),this.gfx.line(v.x,v.y,v.z,w.x,w.y,w.z)}else{var third=1/3;len=mesh.faces.length;for(i=0;i<len;i++){var f=mesh.faces[i],c=f.a.add(f.b).addSelf(f.c).scaleSelf(third),d=c.add(f.normal.scale(normalLength)),n=f.normal.scale(127);this.gfx.stroke(n.x+128,n.y+128,n.z+128),this.gfx.line(c.x,c.y,c.z,d.x,d.y,d.z)}}isStroked?this.gfx.stroke(strokeCol):this.gfx.noStroke()}},meshNormalMapped:function(mesh,vertexNormals,normalLength){this.gfx.beginShape(this.app.TRIANGLES);var i=0,len=mesh.faces.length;if(vertexNormals)for(i=0;i<len;i++){var f=mesh.faces[i],n=this._normalMap.applyTo(f.a.normal);this.gfx.fill(n.x,n.y,n.z),this.gfx.normal(f.a.normal.x,f.a.normal.y,f.a.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z),n=this._normalMap.applyTo(f.b.normal),this.gfx.fill(n.x,n.y,n.z),this.gfx.normal(f.b.normal.x,f.b.normal.y,f.b.normal.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),n=this._normalMap.applyTo(f.c.nromal),this.gfx.fil(n.x,n.y,n.z),this.gfx.normal(f.c.normal.x,f.c.normal.y,f.c.normal.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z)}else for(i=0;i<len;i++){var f=mesh.faces[i];this.gfx.normal(f.normal.x,f.normal.y,f.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z)}this.gfx.endShape();if(normalLength>0)if(vertexNormals){len=mesh.vertices.length;for(i=0;i<len;i++){var v=mesh.vertices[i],w=v.add(v.normal.scale(normalLength)),n=v.normal.scale(127);this.gfx.stroke(n.x+128,n.y+128,n.z+128),this.gfx.line(v.x,v.y,v.z,w.x,w.y,w.z)}}else{len=mesh.faces.length;for(i=0;i<len;i++){var f=mesh.faces[i],c=f.getCentroid(),d=c.add(f.normal.scale(normalLength)),n=f.normal.scale(127);this.gfx.stroke(n.x+128,n.y+128,n.z+128),this.gfx.line(c.x,c.y,c.z,d.x,d.y,d.z)}}},origin:function(){var o=undefined,len=undefined;arguments.length==1?(len=arguments[0],o=Vec3D.ZERO):(o=arguments[0],len=arguments[1]),this.gfx.stroke(255,0,0),this.gfx.line(o.x,o.y,o.z,o.x+len,o.y,o.z),this.gfx.stroke(0,255,0),this.gfx.line(o.x,o.y,o.z,o.x,o.y+len,o.z),this.gfx.stroke(0,0,255),this.gfx.line(o.x,o.y,o.z,o.x,o.y,o.z+len)},plane:function(plane,size){this.mesh(plane.toMesh(size),!1,0)},point:function(p){p.z===undefined?this.gfx.point(p.x,p.y):this.gfx.point(p.x,p.y,p.z)},points2D:function(points){this.processVertices2D(points,this.app.POINTS,!1)},points3D:function(points){this.processVertices3D(points,this.app.POINTS,!1)},polygon2D:function(poly){this.processVertices2D(poly.vertices,this.app.POLYGON,!1)},processVertices2D:function(iterator,shapeID,closed){if(iterator.hasNext===undefined||iterator.next===undefined)iterator=new this.app.ObjectIterator(iterator);this.gfx.beginShape(shapeID);for(var v=void 0;iterator.hasNext()&&((v=iterator.next())||!0);)this.gfx.vertex(v.x,v.y);closed?this.gfx.endShape(this.app.CLOSE):this.gfx.endShape()},processVertices3D:function(iterator,shapeID,closed){if(iterator.hasNext===undefined||iterator.next===undefined)iterator=new this.app.ObjectIterator(iterator);this.gfx.beginShape(shapeID);for(var v=void 0;iterator.hasNext()&&((v=iterator.next())||!0);)this.gfx.vertex(v.x,v.y,v.z);closed?this.gfx.endShape(this.app.CLOSE):this.gfx.endShape()},ray:function(ray,length){var e=ray.getPointAtDistance(length);ray.z===undefined?this.gfx.line(ray.x,ray.y,e.x,e.y):this.gfx.line(ray.x,ray.y,ray.z,e.x,e.y,e.z)},rect:function(r,rectMode){rectMode===undefined&&(rectMode=this.app.CORNER);if(rectMode===this.app.CORNER)this.gfx.rect(r.x,r.y,r.width,r.height);else if(rectMode===this.app.CORNERS)this.gfx.rect(r.x,r.y,r.x+r.width,r.y+r.height);else if(rectMode===this.app.CENTER)this.gfx.rect(r.x+r.widt*.5,r.y+r.height*.5,r.width,r.height);else if(rectMode===this.app.RADIUS){var rw=r.width*.5,rh=r.height*.5;this.gfx.rect(r.x+rw,r.y+rh,rw,rh)}},setGraphics:function(gfx){this.gfx=gfx},sphere:function(sphere,res,smooth){this.mesh(sphere.toMesh(res),smooth)},texturedMesh:function(mesh,tex,smooth){this.gfx.beginShape(this.app.TRIANGLES),this.gfx.texture(tex);var i=0,len=mesh.faces.length;if(smooth)for(i=0;i<len;i++){var f=mesh.faces[i];f.uvA!==undefined&&f.uvB!==undefined&&f.uvC!==undefined?(this.gfx.normal(f.a.normal.x,f.a.normal.y,f.a.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z,f.uvA.x,f.uvA.y),this.gfx.normal(f.b.normal.x,f.b.normal.y,f.b.normal.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z,f.uvB.x,f.uvB.y),this.gfx.normal(f.c.normal.x,f.c.normal.y,f.c.normal.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z,f.uvC.x,f.uvC.y)):(this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z))}else for(i=0;i<len;i++){var f=mesh.faces[i];this.gfx.normal(f.normal.x,f.normal.y,f.normal.z),f.uvA!==undefined&&f.uvB!==undefined&&f.uvC!==undefined?(this.gfx.vertex(f.a.x,f.a.y,f.a.z,f.uvA.x,f.uvA.y),this.gfx.vertex(f.b.x,f.b.y,f.b.z,f.uvB.x,f.uvB.y),this.gfx.vertex(f.c.x,f.c.y,f.c.z,f.uvC.x,f.uvC.y)):(this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z))}this.gfx.endShape()},triangle:function(tri,isFullShape){var isTriangle=function(){return tri.a!==undefined&&tri.b!==undefined&&tri.c!==undefined?tri.a.x!==undefined:!1},isTriangle3D=function(){return isTriangle()?tri.a.z!==undefined:!1};(isFullShape||isFullShape===undefined)&&this.gfx.beginShape(this.app.TRIANGLES);if(isTriangle3D()){var n=tri.computeNormal();this.gfx.normal(n.x,n.y,n.z),this.gfx.vertex(tri.a.x,tri.a.y,tri.a.z),this.gfx.vertex(tri.b.x,tri.b.y,tri.b.z),this.gfx.vertex(tri.c.x,tri.c.y,tri.c.z)}else this.gfx.vertex(tri.a.x,tri.a.y),this.gfx.vertex(tri.b.x,tri.b.y),this.gfx.vertex(tri.c.x,tri.c.y);(isFullShape||isFullShape===undefined)&&this.gfx.endShape()},vertex:function(v){v.z===undefined?this.gfx.vertex(v.x,v.y):this.gfx.vertex(v.x,v.y,v.z)}},module.exports=ToxiclibsSupport}),define("toxi/processing",["require","exports","module","./processing/ToxiclibsSupport"],function(require,exports,module){module.exports={ToxiclibsSupport:require("./processing/ToxiclibsSupport")}}),define("toxi/THREE/ToxiclibsSupport",["require","exports","module","../internals"],function(require,exports,module){var internals=require("../internals"),ToxiclibsSupport=function(scene){if(THREE===undefined)throw new Error("THREE.js has not been loaded");this.scene=scene,this.objectDictionary={}},f3=function(geometry,i1,i2,i3){geometry.faces.push(new THREE.Face3(i1,i2,i3))},v3=function(geometry,a){var threeV=new THREE.Vector3(a.x,a.y,a.z);geometry.vertices.push(new THREE.Vertex(threeV))};ToxiclibsSupport.createLineGeometry=function(line3d){var geometry=new THREE.Geometry;return v3(geometry,line3d.a),v3(geometry,line3d.b),geometry.computeCentroids(),geometry.computeFaceNormals(),geometry.computeVertexNormals(),geometry},ToxiclibsSupport.createMeshGeometry=function(triangleMesh){var geometry=new THREE.Geometry,addFace=function(f){var vectors=[f.a,f.b,f.c],startIndex=geometry.vertices.length,i=0,len=3;for(i=0;i<len;i++){var toxiV=vectors[i];v3(geometry,toxiV)}f3(geometry,startIndex,startIndex+1,startIndex+2)};for(var j=0,flen=triangleMesh.faces.length;j<flen;j++)addFace(triangleMesh.faces[j]);return geometry.computeCentroids(),geometry.computeFaceNormals(),geometry.computeVertexNormals(),geometry},ToxiclibsSupport.createMesh=function(triangleMesh,material){material===undefined&&(material=new THREE.MeshBasicMaterial);var geometry=ToxiclibsSupport.createMeshGeometry(triangleMesh);return new THREE.Mesh(geometry,material)},ToxiclibsSupport.createParticle=function(position,materials){var particle=new THREE.Particle(materials);return particle.position.x=position.x,particle.position.y=position.y,particle.position.z=position.z,particle},ToxiclibsSupport.prototype={addLine:function(line3d,material,holdInDictionary){material===undefined&&(material=new THREE.LineBasicMaterial),holdInDictionary===undefined&&(holdInDictionary=!0);var geom=ToxiclibsSupport.createLineGeometry(line3d),line=new THREE.Line(geom,material);return holdInDictionary&&(this.objectDictionary[line3d]=line),this.scene.add(line),line},addMesh:function(obj_or_toxiTriangleMesh,threeMaterials,holdInDictionary){var toxiTriangleMesh=undefined;arguments.length==1?(toxiTriangleMesh==obj_or_toxiTriangleMesh.geometry,threeMaterials=obj_or_toxiTriangleMesh.materials,holdInDictionary=obj_or_toxiTriangleMesh.holdInDictionary):toxiTriangleMesh=obj_or_toxiTriangleMesh,holdInDictionary===undefined&&(holdInDictionary=!0);var threeMesh=this.createMesh(toxiTriangleMesh,threeMaterials);return holdInDictionary&&(this.objectDictionary[toxiTriangleMesh]=threeMesh),this.scene.add(threeMesh),threeMesh},addParticles:function(positions,material,holdInDictionary){material===undefined&&(material=new THREE.ParticleBasicMaterial),positions=internals.tests.isArray(positions)?positions:[positions];var particle=new THREE.Geometry;for(var i=0,len=positions.length;i<len;i++)v3(particle,positions[i]);holdInDictionary&&(this.objectDictionary[position]=particle);var particleSystem=new THREE.ParticleSystem(particle,material);return this.scene.add(particleSystem),particle},createMeshGeometry:function(triangleMesh){return ToxiclibsSupport.createMeshGeometry(triangleMesh)},createMesh:function(triangleMesh,material){return ToxiclibsSupport.createMesh(triangleMesh,material)},removeObject:function(toxiObject){var threeMesh=this.objectDictionary[toxiObject];scene.removeObject(threeMesh),delete this.objectDictionary[toxiObject]}},module.exports=ToxiclibsSupport}),define("toxi/THREE",["require","exports","module","./THREE/ToxiclibsSupport"],function(require,exports,module){module.exports={ToxiclibsSupport:require("./THREE/ToxiclibsSupport")}}),define("toxi/utils/datatypes/ArraySet",["require","exports","module","../../internals"],function(require,exports,module){var internals=require("../../internals"),ArraySet=function(collection){Array.apply(this);if(arguments.length>=1)for(var i=0,len=collection.length;i<len;i++){var item=collection[i];this.indexOf(item)<0&&this.push(item)}};internals.extend(ArraySet,Array),internals.mixin(ArraySet.prototype,{add:function(item){return this.contains(item)?!1:(this.push(item),!0)},addAll:function(collection){var self=this;for(var i=0,len=collection.length;i<len;i++)this.push(collection[i])},clear:function(){this.retainAll([])},clone:function(){return new ArraySet(this)},contains:function(item){return this.indexOf(item)>=0},containsAll:function(collection){for(var i=0,len=collection.length;i<len;i++){var val=collection[i];if(!this.contains(val))return!1}return!0},containsAny:function(collection){for(var i=0,len=collection.length;i<len;i++)if(this.contains(collection[i]))return!0;return!1},equals:function(object){return this===object},get:function(index){return this[index]},iterator:function(){return new internals.Iterator(this)},isEmpty:function(){return this.length<1},remove:function(o){var i=this.indexOf(o);return i>=0?(this.splice(i,1),!0):!1},removeAll:function(){this.retainAll([])},retainAll:function(collection){var self=this,changed=!1;for(var i=0;i<this.length;i++){var val=this[i];collection.indexOf(val)<0&&(this.splice(i,1),changed=!0,i--)}return changed},size:function(){return this.length},toArray:function(arr){arr=arr||[];for(var i=0;i<this.length;i++)this.hasOwnProperty()&&(arr[i]=this[i]);return arr}}),module.exports=ArraySet}),define("toxi/utils/datatypes/FloatRange",["require","exports","module","../../math/mathUtils"],function(require,exports,module){var mathUtils=require("../../math/mathUtils"),FloatRange=function(min,max){min=min||.1,max=max||1;if(min>max){var t=max;max=min,min=t}this.min=min,this.max=max,this.currValue=min};FloatRange.prototype={adjustCurrentBy:function(val){return this.setCurrent(this.currValue+val)},copy:function(){var range=new FloatRange(this.min,this.max);return range.currValue=this.currValue,range},getAt:function(perc){return this.min+(this.max-this.min-mathUtils.EPS)*perc},getCurrent:function(){return this.currValue},getMedian:function(){return(this.min+this.max)*.5},getRange:function(){return this.max-this.min},isValueInRange:function(val){return val>=this.min&&val<=this.max},pickRandom:function(){return this.currValue=mathUtils.random(min,max),this.currValue},toArray:function(step){var range=[],v=this.min;while(v<this.max)range.push(v),v+=step;return range},toString:function(){return"FloatRange: "+this.min+" -> "+this.max}},module.exports=FloatRange}),define("toxi/utils/datatypes/UndirectedGraph",["require","exports","module","./ArraySet"],function(require,exports,module){var ArraySet=require("./ArraySet"),UndirectedGraph=function(){this._nodeLinks={},this._nodeIDs=[]};UndirectedGraph.prototype={add:function(node){if(this._nodeLinks[node]!==undefined)return;this._nodeLinks[node]=new ArraySet,this._nodeIDs.push(node)},connect:function(nodeA,nodeB){if(this._nodeLinks[nodeA]===undefined)throw new Error("nodeA has not been added");if(this._nodeLinks[nodeB]===undefined)throw new Error("nodeB has not been added");this._nodeLinks[nodeA].push(nodeB),this._nodeLinks[nodeB].push(nodeA)},disconnect:function(nodeA,nodeB){if(this._nodeLinks[nodeA]===undefined)throw new Error("nodeA has not been added");if(this._nodeLinks[nodeB]===undefined)throw new Error("nodeB has not been added");this._nodeLinks[nodeA].splice(this._nodeLinks[nodeA].indexOf(nodeB),1),this._nodeLinks[nodeB].splice(this._nodeLinks[nodeB].indexOf(nodeA),1)},getConnectedNodesFor:function(node){if(this._nodeLinks[node]===undefined)throw new Error("node has not been added");return this._nodeLinks[node]},getNodes:function(){return this._nodeIDs},remove:function(node){var connections=this._nodeLinks[node];if(connections===undefined)return;for(var i=0,len=connections.length;i<len;i++){var neighbor=connections[i],nodeI=neighbor.indexOf(node);neighbor.splice(nodeI,1)}delete this._nodeLinks[node];var i=this._nodeIDs.indexOf(node);this._nodeIDs.splice(node,1)}},module.exports=UndirectedGraph}),define("toxi/utils/datatypes",["require","exports","module","./datatypes/ArraySet","./datatypes/FloatRange","./datatypes/UndirectedGraph"],function(require,exports,module){module.exports={ArraySet:require("./datatypes/ArraySet"),FloatRange:require("./datatypes/FloatRange"),UndirectedGraph:require("./datatypes/UndirectedGraph")}}),define("toxi/utils",["require","exports","module","./utils/datatypes"],function(require,exports,module){module.exports={},module.exports.datatypes=require("./utils/datatypes")}),define("toxi/main",["./color","./geom","./internals","./math","./physics2d","./processing","./THREE","./utils"],function(color,geom,internals,math,physics2d,processing,THREE,utils){return{color:color,geom:geom,internals:internals,math:math,physics2d:physics2d,processing:processing,THREE:THREE,utils:utils}}),define("toxi",["./toxi/main"],function(toxi){return toxi}),toxi=require("toxi")})()